(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"+0pD":function(e,t){var i="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function a(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function n(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=i?a:n).supported=a,t.unsupported=n},"06eB":function(e,t,i){var a=Array.prototype.slice,n=i("kgfz"),s=i("+0pD"),r=e.exports=function(e,t,i){return i||(i={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?i.strict?e===t:e==t:function(e,t,i){var l,d;if(o(e)||o(t))return!1;if(e.prototype!==t.prototype)return!1;if(s(e))return!!s(t)&&(e=a.call(e),t=a.call(t),r(e,t,i));if(c(e)){if(!c(t))return!1;if(e.length!==t.length)return!1;for(l=0;l<e.length;l++)if(e[l]!==t[l])return!1;return!0}try{var h=n(e),p=n(t)}catch(e){return!1}if(h.length!=p.length)return!1;for(h.sort(),p.sort(),l=h.length-1;l>=0;l--)if(h[l]!=p[l])return!1;for(l=h.length-1;l>=0;l--)if(d=h[l],!r(e[d],t[d],i))return!1;return typeof e==typeof t}(e,t,i))};function o(e){return null==e}function c(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}},"180P":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));const a=e=>{const t=(JSON.stringify(e)||"").split("");t.sort();const i=t.join("");return n(i,0).toString()},n=(e,t)=>{const i="string"==typeof e?e:String(e);let a=t;for(let e=0;e<i.length;e++){a=(a<<5)-a+i.charCodeAt(e),a&=a}return a}},"33Kz":function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return r}));i("kYxP");const a=e=>e.getArrayValue("dm_reactions_config_active_reactions"),n=e=>{const t=e.getArrayValue("dm_reactions_config_inactive_reactions");return[...a(e),...t]},s=(e,t)=>{const i=n(t).find((t=>t.endsWith(e)));if(i)return i.split(":")[0]},r=(e,t={includeInactive:!1})=>t.includeInactive?n(e).map((e=>e.split(":")[1])):a(e).map((e=>e.split(":")[1]))},"3AAD":function(e,t,i){"use strict";const a={...i("7n04").a,pinToNewestWhenAtNewest:!0};t.a=a},"4AMG":function(e,t,i){"use strict";i.d(t,"a",(function(){return dr}));var a=i("ejT/"),n=i("ERkP"),s=i.n(n),r=i("7n04"),o=i("Myq3"),c=i("VPAj");const l=(e,t)=>e.getForItem(t).doesIntersectWith(e.getForViewport()),d=e=>e.getForList().getBottom()-e.getForViewport().getBottom();var h=({isOwnMessage:e,typingIndicatorId:t})=>{const i=e=>Object(o.a)(e.getList(),(e=>e.id!==t));return{...r.a,initialScrollHeadroom:Object(c.a)(0),scrollHeadroom:Object(c.a)(0),offsetCorrection:(a,n)=>{const s=i(a),o=i(n),c=o&&(!s||s.id!==o.id),h=o&&e(o.data.data),p=s&&l(a,s.id);return c&&(h||p)||p&&((e,i)=>{const a=e.getForItem(t),n=i.getForItem(t);return!a||n&&n.getHeight()>a.getHeight()})(a,n)?Math.max(0,d(n)):r.a.offsetCorrection(a,n)}}},p=(i("kYxP"),i("gbD7")),u=i("X/yg"),m=i("b9JY");var g=(e,t)=>{if(e&&e.message_data&&t&&t.message_data&&Object(m.b)(e)&&Object(m.b)(t)){const{sender_id:i,time:a}=e.message_data,{sender_id:n,time:s}=t.message_data,r=parseInt(s,10)-parseInt(a,10);return i===n&&r>=0&&r<=6e4}return!1},_=i("jat/"),b=i("MMRb"),f=i("v6aA"),v=i("XnpN"),y=i("LhSm"),E=i("I4+6"),S=i("rHpw"),R=i("PbQQ"),C=i("cm6r"),w=i("jV+4"),x=i("pBrB"),A=i("wCd/");const T=(e,t)=>{const i=Object(v.a)(e,t).map((({user:e})=>e)),a=i&&i[0];return{userDescription:a.description,userEntities:a.entities,userWithheldDescription:a.withheld_description,userWithheldEntities:a.withheld_entities,userFollowerCount:a&&a.followers_count,userFriendsCount:a&&a.friends_count,userIdStr:a&&a.id_str,userJoinDate:a&&a.created_at,userName:a&&a.name,userScreenName:a&&a.screen_name,userIsVerified:a&&a.verified}},I=S.a.create((e=>({root:{flexDirection:"column",alignItems:"center",marginBottom:e.spaces.space16,paddingVertical:e.spaces.space20,paddingHorizontal:e.spaces.space16,borderRadius:e.borderRadii.xSmall},profileInfoItemMargin:{marginBottom:e.spaces.space4},borderBottom:{borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid"},description:{width:"100%",textAlign:"center"}})));var O=({conversation:e,withBottomBorder:t=!0})=>{const{loggedInUserId:i}=s.a.useContext(f.a);if(!e)return null;const{userDescription:a,userEntities:n,userFollowerCount:r,userFriendsCount:o,userIdStr:c,userIsVerified:l,userJoinDate:d,userName:h,userScreenName:p,userWithheldDescription:u,userWithheldEntities:m}=T(e,i||""),g=!!(h&&p&&(r&&o||d)),_=E.a.generate({color:S.a.theme.colors.text,backgroundColor:S.a.theme.colors.transparent,customFocusBackgroundColor:S.a.theme.colors.gray0,customHoverBackgroundColor:S.a.theme.colors.gray0,customPressedBackgroundColor:S.a.theme.colors.activeFaintGray});return s.a.createElement(R.a.Consumer,null,(e=>s.a.createElement(C.a,{interactiveStyles:_,link:e.withAnchorless(`https://twitter.com/${p||""}`),style:[I.root,t&&g&&I.borderBottom]},s.a.createElement(w.a,{isVerified:l,name:h,screenName:p,style:I.profileInfoItemMargin,weight:"bold",withHoverCard:!0,withLink:!0}),a&&n&&c?s.a.createElement(x.a,{description:a,entities:n,style:[I.profileInfoItemMargin,I.description],userId:c,withheldDescription:u,withheldEntities:m}):null,r&&o?s.a.createElement(A.a,{followersCount:r,friendsCount:o,screenName:p||"",style:I.profileInfoItemMargin,withLink:!1}):null,d?s.a.createElement(y.a,{joinDate:d}):null)))},M=i("V/6K"),k=i("cFyg"),P=i("g54k"),D=i("aA19"),L=i("aWyx"),F=i("mN6z"),B=i("MWbm"),N=i("t62R"),j=i("jhWN"),U=i("MAI/"),H=i("zQEV");const W=({children:e,link:t,style:i})=>s.a.createElement(N.b,{align:"center",color:"gray700",link:t,size:"subtext2",style:i},e);class V extends s.a.Component{constructor(...e){super(...e),this._renderContents=()=>{const{conversation:e,entry:t,entryType:i,perspective:a,users:n}=this.props,r=Object(H.a)(t,i,a,n);switch(i){case L.b.CONVERSATION_AVATAR_UPDATE:{const i=e.avatar_image_https===t.conversation_avatar_image_https;return s.a.createElement(s.a.Fragment,null,this._isValidImageSource(e.avatar_image_https)&&i?s.a.createElement(B.a,{style:z.conversationAvatarContainer},s.a.createElement(D.a,{conversation:e,perspective:a})):null,s.a.createElement(W,null,r))}case L.b.JOIN_CONVERSATION:{const e=this._getAddedYouMessageWithProfileInfo(r),t=this._getParticipantsFromEntry(),i=s.a.createElement(N.b,{align:"center",color:"gray700",size:"subtext2"},this._getParticipantsFromEntryText(t)),a=this._getJoinConversationDetailsWithFacepile(t,i);return s.a.createElement(s.a.Fragment,null,e,a)}default:return s.a.createElement(W,null,r)}},this._getAddedYouMessageWithProfileInfo=e=>{const{entry:t,users:i}=this.props,a=t.sender_id?i[t.sender_id]:void 0,n=a?{pathname:`https://twitter.com/${a.screen_name}`}:void 0;return s.a.createElement(C.a,{interactiveStyles:null,link:n,style:z.userAddedYouContainer},a?s.a.createElement(j.a,{accessibilityLabel:a.screen_name,screenName:a.screen_name,size:"medium",uri:a.profile_image_url_https,withHoverCard:!0,withLink:!0}):null,s.a.createElement(W,{link:n,style:z.userAddedYouText},e))},this._getJoinConversationDetailsWithFacepile=(e,t)=>{const{conversation:i}=this.props,a=e.slice(0,20).map((({profile_image_url_https:e})=>e));return s.a.createElement(C.a,{interactiveStyles:null,link:{pathname:`/messages/${i.conversation_id}/participants`},style:z.joinConversationDetails},t,s.a.createElement(U.a,{style:z.userAvatarFacepile,userAvatarSize:"xLarge",userAvatarUrls:a}))}}shouldComponentUpdate(e){return!Object(F.a)(this.props,e)}render(){return s.a.createElement(B.a,{style:z.root},this._renderContents())}_isValidImageSource(e){return e&&""!==e&&e.indexOf("MEDIA_NOT_FOUND")<0}_getParticipantsFromEntry(){const{entry:e,perspective:t,users:i}=this.props;return e.participants?e.participants.filter((({user_id:e})=>t!==e)).map((({user_id:e})=>i[e])).filter(Boolean):[]}_getParticipantsFromEntryText(e){const{conversation:{conversation_id:t}}=this.props;return Object(H.b)(e.length,t)}}const z=S.a.create((e=>({root:{paddingBottom:e.spaces.space20},conversationAvatarContainer:{alignSelf:"center",height:e.spaces.space64,marginBottom:e.spaces.space12,width:e.spaces.space64},userAddedYouContainer:{flexDirection:"row",justifyContent:"center"},userAddedYouText:{flexShrink:1,marginLeft:e.spaces.space12},joinConversationDetails:{marginTop:e.spaces.space4},userAvatarList:{marginTop:e.spaces.space4},userAvatarFacepile:{marginTop:e.spaces.space4,justifyContent:"center"}})));var q=Object(P.a)(V),G=i("oQhu");var Y=Object(G.a)((function(e){const t=S.a.theme.spacesPx.space40;return{DMUserAvatarSizeType:"xLarge",DMUserAvatarSizePx:t,DMUserAvatarSpacerPx:t+S.a.theme.spacesPx.space12}})),$=i("shC7"),K=i("38/B");const Q=function(e){return X(e,K.a.reducedMotionEnabled)},X=Object(G.a)((function(e,t){const i=function(){const{DMUserAvatarSizePx:e,DMUserAvatarSpacerPx:t}=Y(S.a.theme.scale),i=ee[S.a.theme.scale],a=J/i,n=Z/e,s=Z/2,r=Z-s,o=Z-s-t;return{cssTransition:K.a.reducedMotionEnabled?{}:{transition:`transform ${ie}, opacity ${ie}`},messageContainer:{base:{transform:[{translateX:0}]},active:{sent:{transform:[{translateX:($.a.getConstants().isRTL?1:-1)*r}]},received:{transform:[{translateX:($.a.getConstants().isRTL?-1:1)*o}]}}},actionsContainer:{base:{transform:[{translateX:0}]},active:{sent:{transform:[{translateX:($.a.getConstants().isRTL?1:-1)*te[S.a.theme.scale]}]},received:{transform:[{translateX:($.a.getConstants().isRTL?-1:1)*(te[S.a.theme.scale]+o)-s}]}}},voiceMessage:{container:{base:{height:i},active:{height:J}},base:{height:i,transform:[{scale:1}]},active:{base:{transform:[{scale:a}]},sent:{paddingRight:s/a,transformOrigin:$.a.getConstants().isRTL?"bottom left":"bottom right"},received:{paddingLeft:s/a,transformOrigin:$.a.getConstants().isRTL?"bottom right":"bottom left"}}},userAvatar:{base:{transform:[{scale:1}]},sent:{transformOrigin:$.a.getConstants().isRTL?"bottom left":"bottom right"},received:{transformOrigin:$.a.getConstants().isRTL?"bottom right":"bottom left"},active:{opacity:1,pointerEvents:"all",transform:[{scale:n}]},visuallyHidden:{opacity:0,pointerEvents:"none"}}}}();return{actionsContainer:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.actionsContainer.base];return t&&a.push(e?i.actionsContainer.active.sent:i.actionsContainer.active.received),a},messageContainer:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.messageContainer.base];return t&&a.push(e?i.messageContainer.active.sent:i.messageContainer.active.received),a},voiceMessageContainer:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.voiceMessage.container.base];return t&&a.push(i.voiceMessage.container.active),a},voiceMessage:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.voiceMessage.base];return t&&(a.push(i.voiceMessage.active.base),a.push(e?i.voiceMessage.active.sent:i.voiceMessage.active.received)),a},userAvatar:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.userAvatar.base,e?i.userAvatar.sent:i.userAvatar.received];return t?a.push(i.userAvatar.active):e&&a.push(i.userAvatar.visuallyHidden),a}}}));const J=60,Z=J,ee={xSmall:42,small:42,normal:47,large:47,xLarge:47},te={xSmall:72.26,small:165.61-89.3,normal:158.22-94.4,large:166.64-100.58,xLarge:181.55-111.81},ie="0.2s 0s ease-in-out";var ae=i("+Kfv"),ne=i("hqKg"),se=i("oEGd"),re=i("zh9S"),oe=i("Yatk"),ce=i("G6rE"),le=i("P1r1");const de={scribeAction:re.c},he=Object(ne.createSelector)(((e,t)=>ce.e.select(e,t.senderId)),le.k,le.q,((e,t,i)=>({user:Object(oe.a)(e),displaySensitiveMedia:t,isDmNsfwMediaFilterEnabled:i})));var pe=Object(se.f)(he,de),ue=(i("MvUL"),i("1YZw")),me=i("rxPX"),ge=i("0KEI"),_e=i("RqPI");var be=Object(me.a)().propsFromState((()=>({reporterCountry:_e.y,reporterLanguage:_e.o}))).propsFromActions((()=>({addToast:ue.b,createLocalApiErrorHandler:Object(ge.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_OVERFLOW_ACTIONS"),deleteEntry:b.deleteEntry}))).withAnalytics(),fe=i("k49u"),ve=i("LVU8"),ye=i("3XMw"),Ee=i.n(ye);const Se=Ee.a.f58dff33,Re=Ee.a.ad5a8e8e,Ce={[fe.a.MissingParameter]:{toast:Object(ve.a)(Se)},[fe.a.DirectMessageDestroyPermissionsError]:{toast:{text:Re}},showToast:!0};var we=i("xCUF"),xe=i("uKEd");const Ae=[],Te=Object(ne.createSelector)((e=>Object(xe.l)(e).entries),((e,t)=>Object(xe.p)(e,t.entry.id)||Ae),((e,t)=>t.perspective),((e,t,i)=>({selectedReactions:t.filter((t=>{const a=e[t]&&e[t].data;return a&&a.sender_id===i})).map((t=>e[t].data.reaction_key))}))),Ie={createReaction:xe.d,createLocalApiErrorHandler:Object(ge.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTIONS_POPOVER"),fetchUpdatesIfNeeded:we.d,removeReaction:xe.k};var Oe=Object(se.f)(Te,Ie),Me=i("33Kz"),ke=i("wTX1");var Pe=({accessibilityLabelFormatter:e,count:t,emojiSize:i,emotion:a,enableHoverStyle:n,focusable:r,onPress:o,style:c})=>{const{featureSwitches:l}=s.a.useContext(f.a),d=Object(Me.b)(a,l),h=e&&d?e({emoji:d,count:t}):void 0,p=E.a.generate({backgroundColor:S.a.theme.colors.gray50,color:S.a.theme.colors.gray700});return s.a.createElement(C.a,{accessibilityLabel:h,focusable:r,interactiveStyles:n?p:null,onPress:o,style:[De.container,...c||[]]},s.a.createElement(N.b,{size:i,style:De.unsetLineHeight},d),t?s.a.createElement(ke.a,{color:"gray700",containerStyle:De.count,count:t,size:"subtext3"},t):null)};const De=S.a.create((e=>({container:{flexDirection:"row"},count:{alignSelf:"center",minWidth:e.spaces.space16,paddingLeft:e.spaces.space2},unsetLineHeight:{lineHeight:"unset"}})));var Le=i("pHkl"),Fe=i("Irs7");const Be=Ee.a.ca7a2214,Ne=Ee.a.fc0e94b7;class je extends s.a.Component{constructor(...e){super(...e),this._handleReactionScribing=(e,t)=>{const{analytics:i,entry:a,isGroupDM:n,participantsCount:s}=this.props,r=t?"delete_reaction":"create_reaction",o=Object(u.c)(a);i.scribe({section:"twitter_service",component:"direct_messages",element:r,action:"success",data:{conversation_id:a.conversation_id,conversation_participant_count:s,conversation_type:n?Le.i.GROUP:Le.i.ONE_TO_ONE,message_type:o,reaction_emotion:e}})},this._reactionClickHandler=(e,t)=>()=>{const{createLocalApiErrorHandler:i,createReaction:a,dismiss:n,entry:s,fetchUpdatesIfNeeded:r,perspective:o,removeReaction:c}=this.props,l={reaction_key:e,conversation_id:s.conversation_id,dm_id:s.id,perspective:o};(t?c:a)(l).then(this._handleReactionScribing(e,t)).then((()=>r())).catch(i()),n()}}render(){const{selectedReactions:e}=this.props,t=Object(Me.a)(this.context.featureSwitches).map((t=>{const i=e.includes(t);return s.a.createElement(Pe,{accessibilityLabelFormatter:i?Be:Ne,emojiSize:"title4",emotion:t,enableHoverStyle:!0,focusable:!0,key:t,onPress:this._reactionClickHandler(t,i),style:[He.reaction,i&&He.selectedReaction]})}));return s.a.createElement(B.a,{style:He.reactions},t)}}je.contextType=f.a;var Ue=Object(Fe.a)(Oe(je));const He=S.a.create((e=>({reactions:{cursor:"pointer",flexDirection:"row",padding:e.spaces.space12},reaction:{borderRadius:e.borderRadii.small,padding:e.spaces.space4},selectedReaction:{backgroundColor:e.colors.gray50}})));var We=i("OiMc");class Ve extends s.a.Component{constructor(...e){super(...e),this._renderDMReactionPickerContent=e=>{const{entry:t,isGroupDM:i,participantsCount:a,perspective:n}=this.props;return s.a.createElement(Ue,{dismiss:e,entry:t,isGroupDM:i,participantsCount:a,perspective:n})}}render(){const{children:e,onDismiss:t}=this.props;return s.a.createElement(We.a,{enableEnterKeyToggle:!0,onDismiss:t,preferredVerticalOrientation:"up",renderContent:this._renderDMReactionPickerContent,withArrow:!0,withFixedPosition:this.context.isDrawer},e)}}Ve.contextType=M.a;var ze=i("TnY3"),qe=i("mjJ+"),Ge=i("Q0VY"),Ye=i("eb3s"),$e=i("/yvb"),Ke=i("ZToW"),Qe=i("CaKu"),Xe=i("i4Oy"),Je=i("4w6w");const Ze=(e,t)=>{if(null==e)return!1;const[i,a]=t||[0,0];return!((0===i||1===i)&&e.length===a)},et=e=>{const{message_data:t}=e;if(!t)return!1;const{attachment:i}=t;if(!i)return!0;if(i.sticker)return!1;const a=i.tweet||i.photo||i.animated_gif||i.video||void 0;if(a)return Ze(t.text,a.indices);if(i.card){var n;const e=((null==(n=t.entities)?void 0:n.urls)||[]).find((e=>e.url===i.card));return Ze(t.text,e&&e.indices)}return!0},tt=e=>{var t;const i=null==e||null==(t=e.message_data)?void 0:t.attachment;return!(!i||!(i.card||i.tweet||i.photo||i.animated_gif||i.video))},it=e=>{var t;const i=null==e||null==(t=e.message_data)?void 0:t.attachment;return!(!i||!i.fleet)},at=(e,t,i)=>{const a=1.25*S.a.theme.fontSizesPx.body;return{compositeRendered:e?void 0!==t&&void 0!==i:void 0!==t,isTextSquared:void 0!==t&&void 0!==i&&(i===t||i<=t-a),isAttachmentSquared:void 0!==i&&void 0!==t&&(t===i||t<=i-a)}};var nt=i("hiGS"),st=i("zIWA"),rt=i("Lsrn"),ot=i("k/Ka");const ct=(e={})=>Object(ot.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[rt.a.root,e.style],viewBox:"0 0 24 24"},s.a.createElement("g",null,s.a.createElement("path",{d:"M16.925 9.5H14.5V7.075c0-.414-.336-.75-.75-.75s-.75.336-.75.75V9.5h-2.425c-.414 0-.75.336-.75.75s.336.75.75.75H13v2.425c0 .414.336.75.75.75s.75-.336.75-.75V11h2.425c.414 0 .75-.336.75-.75s-.336-.75-.75-.75zm-.3 11H4.25c-.413 0-.75-.337-.75-.75V8.402c0-.414-.336-.75-.75-.75s-.75.336-.75.75V19.75C2 20.99 3.01 22 4.25 22h12.375c.414 0 .75-.336.75-.75s-.336-.75-.75-.75z"}),s.a.createElement("path",{d:"M19.75 2h-12C6.51 2 5.5 3.01 5.5 4.25v12c0 1.24 1.01 2.25 2.25 2.25h12c1.24 0 2.25-1.01 2.25-2.25v-12C22 3.01 20.99 2 19.75 2zm.75 14.25c0 .413-.337.75-.75.75h-12c-.413 0-.75-.337-.75-.75v-12c0-.413.337-.75.75-.75h12c.413 0 .75.337.75.75v12z"})));ct.metadata={width:24,height:24};var lt=ct,dt=i("DlVf"),ht=i("ACHU"),pt=i("UgB4"),ut=i("fz3c");const mt=Ee.a.ba60339a,gt=Ee.a.j4bfee22,_t=Ee.a.d96cf7cd,bt=Ee.a.faddd3a2,ft=Ee.a.eb497e08,vt=Ee.a.b170974a,yt=Ee.a.i202bd22,Et=Ee.a.f2e5491a,St=Ee.a.f88553c8,Rt=Ee.a.ifea3114,Ct=Ee.a.cac14829,wt=Ee.a.h63a5c3b;class xt extends s.a.Component{constructor(e,t){super(e,t),this._renderOverflowMenu=e=>{const{analytics:t,entry:i,featureSwitches:a,isSent:n,reporterCountry:r,reporterLanguage:o}=this.props,c=ut.a.DMMessage,l=t.contextualScribeNamespace,d=[{text:mt,Icon:nt.a,isEmphasized:!0,onClick:this._handleShowDeleteConfirmation(e)}];if(!n)if(Object(ut.g)(a,c,r,o)){var h;const e=Object(ut.d)({clientReferer:window.location.pathname,isMedia:!1,isPromoted:!1,reportType:c,reportedConversationId:i.conversation_id,reportedMessageId:i.id,reportedUser:null==(h=i.message_data)?void 0:h.sender_id,scribeNamespace:t.contextualScribeNamespace});d.push({text:yt,Icon:st.a,link:{pathname:"/i/safety/report_story_start",state:{input:{requested_variant:JSON.stringify(e)}}},onClick:this.props.onReportMessage})}else d.push({text:yt,Icon:st.a,link:{pathname:`/i/report/${c}/${i.id}`,state:{clientReferer:window.location.pathname,conversationId:i.conversation_id,scribeNamespace:l}},onClick:this.props.onReportMessage});return Qe.a.isAvailable()&&d.push({text:Et,Icon:lt,onClick:this._handleCopyMessageText}),s.a.createElement(qe.a,{isFixed:this.context.isDrawer,items:d,onCloseRequested:this._handleHideActionsAndMenus(e),preferredHorizontalOrientation:"right"})},this._handleCopyMessageText=e=>{const{addToast:t}=this.props,i=this._replaceMessageUrls();i&&(Qe.a.setString(i),t({text:St})),e&&e()},this._handleForwardButton=()=>{var e,t;const{entry:i,history:a}=this.props;if(null!=i&&null!=(e=i.message_data)&&null!=(t=e.attachment)&&t.tweet){const{tweet:e}=i.message_data.attachment;a.push({pathname:"/messages/compose",state:{tweetAttachment:{...e,id_str:e.status}}})}},this._handleSetActionsActive=()=>{const{setShouldFreezeUpdates:e}=this.props;this.setState({actionsAreActive:!0}),e(!0)},this._handleDelete=()=>{const{analytics:e,createLocalApiErrorHandler:t,deleteEntry:i,entry:a,inboxType:n,isGroupDM:s,participantsCount:r}=this.props,o=Object(u.c)(a);e.scribe({action:"delete",data:{conversation_id:a.conversation_id,conversation_type:s?Le.i.GROUP:Le.i.ONE_TO_ONE,conversation_participant_count:r,message_type:o,inbox_type:Object(u.i)(n)}}),i({conversationId:a.conversation_id,id:a.id}).catch(t(Ce))},this._handleHideDeleteConfirmation=()=>{this.setState({showDeleteConfirmation:!1})},this._handleHideActionsAndMenus=e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e&&e(),this.setState({actionsAreActive:!1}),t(!1)},this._handlePressReactionPickerButton=()=>{const{analytics:e,entry:t}=this.props;e.scribe({component:"reaction_button",element:Object(u.c)(t),action:"click"}),this._handleSetActionsActive()},this._handleShowDeleteConfirmation=e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e(),this.setState({actionsAreActive:!1,showDeleteConfirmation:!0}),t(!1)},this._replaceMessageUrls=()=>{const{entry:e}=this.props,t=e&&e.message_data&&e.message_data.entities;let i=e&&e.message_data&&e.message_data.text||"";return Ge.a.tweetTextParts(i,[0,i.length],t).forEach((e=>{"url"===e.entityType&&(i=i.replace(e.url,e.expandedUrl))})),i},this.state={actionsAreActive:!1,showDeleteConfirmation:!1},this._hasMedia=tt(this.props.entry),this._isNarrow=Xe.a.get("screen").width<S.a.theme.breakpoints.xSmall}render(){var e,t;const{entry:i,isSent:a,shouldShowReactionButton:n,style:r,withVDLRefresh:o}=this.props,c=this._areActionsVisible();return s.a.createElement(B.a,{pointerEvents:c?"auto":"none",style:[Tt.messageActions,a?Tt.messageActionsLeft:Tt.messageActionsRight,c?Tt.visible:Tt.invisible,o&&Tt.vdlMessageActions,this._isNarrow&&(this._hasMedia?Tt.messageActionsMediaNarrow:Tt.messageActionsNarrow),r]},(null==i||null==(e=i.message_data)||null==(t=e.attachment)?void 0:t.tweet)&&o&&this._renderForwardButton(),n&&this._renderReactionButton(),this._renderOverflowButton(),this._renderDeleteConfirmation())}_renderDeleteConfirmation(){return this.state.showDeleteConfirmation?s.a.createElement(Ye.a,{confirmButtonLabel:_t,confirmButtonType:"destructiveFilled",headline:gt,onCancel:this._handleHideDeleteConfirmation,onConfirm:this._handleDelete,text:bt}):null}_renderForwardButton(){return s.a.createElement($e.a,{accessibilityLabel:Rt,hoverLabel:{label:Rt},icon:It,onPress:this._handleForwardButton,size:this._isNarrow?"small":"medium",type:"brandText"})}_renderReactionButton(){const{entry:e,isGroupDM:t,participantsCount:i,perspective:a,withVDLRefresh:n}=this.props,{actionsAreActive:r}=this.state,o=s.a.createElement(dt.a,{style:n?Tt.vdlActionIcon:Tt.actionIcon});return s.a.createElement(Ve,{entry:e,isGroupDM:t,onDismiss:this._handleHideActionsAndMenus(),participantsCount:i,perspective:a},s.a.createElement($e.a,{accessibilityExpanded:!!r,accessibilityHasPopup:"menu",accessibilityLabel:vt,hoverLabel:{label:Ct},icon:o,onPress:this._handlePressReactionPickerButton,size:this._isNarrow?"small":"medium",type:"brandText"}))}_renderOverflowButton(){const{withVDLRefresh:e}=this.props,t=s.a.createElement(ht.a,{style:e?Tt.vdlActionIcon:Tt.actionIcon});return s.a.createElement($e.a,{accessibilityLabel:ft,hoverLabel:{label:wt},icon:t,onPress:this._handleSetActionsActive,renderMenu:this._renderOverflowMenu,size:this._isNarrow?"small":"medium",type:"brandText"})}_areActionsVisible(){const{containerIsActive:e,containerIsFocused:t,containerIsHovered:i,isDraft:a}=this.props,{actionsAreActive:n}=this.state,s=(r=this.props.entry,!et(r)&&tt(r)&&!Ke.a.isEnabled);var r;return!a&&(s||e&&!Ke.a.isEnabled||t||i||n)}}xt.contextType=M.a;var At=Object(ze.a)(be(xt));const Tt=S.a.create((e=>({invisible:{opacity:0},messageActions:{alignSelf:"flex-end",flexDirection:"row"},messageActionsMediaNarrow:{flexDirection:"column"},messageActionsNarrow:{flexShrink:1,flexWrap:"wrap",minWidth:e.spaces.space32},messageActionsLeft:{justifyContent:"flex-end",paddingRight:e.spaces.space4},messageActionsRight:{justifyContent:"flex-start",paddingLeft:e.spaces.space4},vdlMessageActions:{alignSelf:"center"},actionIcon:{color:e.colors.gray700},vdlActionIcon:{color:e.colors.gray600},visible:{opacity:1}}))),It=s.a.createElement(pt.a,{style:Tt.vdlActionIcon});var Ot=i("97Jx"),Mt=i.n(Ot),kt=i("CDB5");var Pt=Object(me.a)().propsFromActions((()=>({createLocalApiErrorHandler:Object(ge.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_CONVERSATION"),removeEntry:b.removeEntry,sendMessage:kt.m}))).withAnalytics();const Dt="87.5%";var Lt=i("wrlS");const Ft=[],Bt=(e,t)=>Object(xe.p)(e,t.entryId)||Ft,Nt=e=>Object(xe.l)(e).entries,jt={createLocalApiErrorHandler:Object(ge.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTIONS")};var Ut=Object(se.e)((()=>Object(ne.createSelector)(Nt,Bt,_e.q,Lt.d,((e,t,i,a)=>{const n=Object(Me.a)(a,{includeInactive:!0});let s,r=0;return{reactionsWithCounts:t.reduceRight(((t,a)=>{const o=e[a]&&e[a].data;if(!o)return t;if(!n.includes(o.reaction_key))return t;const c=(t.get(o.reaction_key)||0)+1;return t.set(o.reaction_key,c),(null==o?void 0:o.sender_id)===i&&(s=o.reaction_key),r+=1,t}),new Map),selectedReactionKey:s,totalReactionCount:r}}))),jt);const Ht=[],Wt=(e,t)=>t.entryId,Vt=e=>Object(xe.l)(e).entries,zt=(e,t)=>Object(xe.p)(e,Wt(0,t))||Ht,qt=(e,t)=>ce.e.selectMany(e,((e,t)=>Object(xe.q)(e,Wt(0,t)))(e,t)),Gt={removeReaction:xe.k,fetchUpdatesIfNeeded:we.d,createLocalApiErrorHandler:Object(ge.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTION_SUMMARY_CONTEXT")};var Yt=Object(se.e)((()=>Object(ne.createSelector)(Vt,zt,_e.q,qt,Lt.d,((e,t,i,a,n)=>{const s=Object(Me.a)(n,{includeInactive:!0}),r=[];t.forEach((t=>{const n=e[t]&&e[t].data;if(!(n&&s.includes(n.reaction_key)))return;const o=a.find((e=>e&&e.id_str===n.sender_id)),c=o&&{avatarUri:o.profile_image_url_https,userId:o.id_str,reactionKey:n.reaction_key,isLoggedInUser:o.id_str===i,screenName:o.screen_name,name:o.name,isProtected:o.protected,isVerified:o.verified,time:n.time};c&&r.push(c)})),r.sort(((e,t)=>t.time-e.time));const o=r.findIndex((e=>e.userId===i));return o>-1&&r.push(...r.splice(0,o)),{loggedInUserId:i,usersWithReactions:r}}))),Gt),$t=i("TIdA"),Kt=i("htQn");const Qt=Ee.a.gf5e9ea6,Xt=Ee.a.a2d48778,Jt=$t.a.createLayoutCache();const Zt=S.a.create((e=>({bodyColumn:{flexShrink:1,flexGrow:1,justifyContent:"center",marginHorizontal:e.spaces.space4},body:{alignItems:"center",flexDirection:"row",justifyContent:"space-between"},bottomBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small},column:{alignItems:"center",justifyContent:"center",marginRight:e.spaces.space4},reactionColumn:{alignItems:"center",justifyContent:"center",marginRight:e.componentDimensions.gutterHorizontal},root:{flexDirection:"row",minHeight:"56px",paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.componentDimensions.gutterVertical}})));var ei=function(e){const{featureSwitches:t}=s.a.useContext(f.a),{onUndoPress:i,renderUndo:a,user:n,withBottomBorder:r}=e,{avatarUri:o,isProtected:c,isVerified:l,name:d,screenName:h}=n,p=s.a.useMemo((()=>function(e){e.stopPropagation(),i()}),[i]),u=s.a.createElement(j.a,{imageLayoutCache:Jt,screenName:h,size:"xxLarge",uri:o}),m=s.a.createElement(Pe,{emojiSize:"title4",emotion:n.reactionKey,focusable:!1}),g=s.a.createElement(w.a,{badgeContext:"content",isProtected:c,isVerified:l,name:d,screenName:h,withHoverCard:!0,withStackedLayout:!0});return s.a.createElement(Kt.a,{link:{pathname:`/${h}`,anchorless:!0},style:[Zt.root,r&&Zt.bottomBorder]},s.a.createElement(B.a,{style:Zt.reactionColumn},m),s.a.createElement(B.a,{style:Zt.column},u),s.a.createElement(B.a,{style:Zt.bodyColumn},s.a.createElement(B.a,{style:Zt.body},g)),a?s.a.createElement(B.a,{style:Zt.column},s.a.createElement($e.a,{accessibilityLabel:Xt({emoji:Object(Me.b)(n.reactionKey,t)}),onClick:p,size:"small",type:"brandText"},Qt)):null)},ti=i("xKuM"),ii=i("efqG");const ai=Ee.a.b772cd65,ni=Ee.a.c0098d49,si=Ee.a.j85999eb;class ri extends s.a.PureComponent{constructor(...e){super(...e),this._renderContent=(e,t)=>s.a.createElement(B.a,null,this._renderHeader(e,t),this._renderUsers(e,t),this._renderDoneButton(e,t)),this._renderHeader=(e,t)=>"sheet"===t?s.a.createElement(ti.a,{title:ni}):s.a.createElement(N.b,{visuallyHidden:!0},ni),this._renderUsers=(e,t)=>s.a.createElement(B.a,{accessibilityLabel:si,style:[oi.container,"sheet"===t?oi.sheet:oi.popover]},this._renderUserCells(e)),this._renderDoneButton=(e,t)=>"sheet"===t&&s.a.createElement($e.a,{key:"button_done",onPress:e,style:oi.cancelButton,type:"primaryOutlined"},ai),this._renderUserCells=e=>this.props.usersWithReactions.filter(Boolean).map(((t,i)=>s.a.createElement(ei,{history:this.props.history,key:t.userId,onUndoPress:this._reactionUndoHandler(t.reactionKey,e),renderUndo:t.isLoggedInUser,user:t,withBottomBorder:i!==this.props.usersWithReactions.length-1}))),this._reactionUndoHandler=(e,t)=>()=>{const{conversationId:i,createLocalApiErrorHandler:a,entryId:n,fetchUpdatesIfNeeded:s,loggedInUserId:r,removeReaction:o}=this.props,c={reaction_key:e,conversation_id:i,dm_id:n,perspective:r};t(),o(c).then(this._handleScribeRemoveReaction(e)).then(s).catch(a())},this._handleScribeRemoveReaction=e=>()=>{const{analytics:t}=this.props;t.scribe({page:"app",section:"twitter_service",component:"direct_messages",element:"delete_reaction",action:"success",data:{reaction_emotion:e}})}}render(){const{children:e}=this.props;return s.a.createElement(ii.a,{renderContent:this._renderContent,withFixedPosition:this.context.isDrawer},e)}}ri.contextType=M.a;const oi=S.a.create((e=>({cancelButton:{marginHorizontal:e.spaces.space12,marginVertical:e.spaces.space12},container:{overflowY:"auto",paddingVertical:e.spaces.space12},popover:{maxHeight:"35vh",minWidth:"320px"},sheet:{maxHeight:"65vh"}})));var ci=Object(ze.a)(Object(Fe.a)(Yt(ri)));const li=Ee.a.h95f9e76;class di extends s.a.PureComponent{constructor(e){super(e),this._handleScribeDMReactionSummary=()=>{const{analytics:e}=this.props;e.scribe({component:"dm_reaction_summary",action:"show"})},this._onSetReactionsNode=e=>{this._measureWidths(e||void 0)},this._renderReactions=({isHovered:e})=>{const{reactionsWithCounts:t,selectedReactionKey:i}=this.props,a=this.state.emojiSize||"headline1",n=t.size-1;return Array.from(t,(([t,r],o)=>s.a.createElement(Pe,{count:r,emojiSize:a,emotion:t,enableHoverStyle:!1,focusable:!0,key:t,style:[o===n&&hi.rightPadding,hi.elementPadding,i===t?hi.selfSelect:null,e&&hi.isHoveredDMReaction]})))},this.state={emojiSize:void 0}}render(){const{conversationId:e,entryId:t,isEndOfDM:i,isSent:a,totalReactionCount:n}=this.props,{emojiSize:r}=this.state;if(0===n)return null;const o=E.a.generate({backgroundColor:S.a.theme.colors.gray50,color:S.a.theme.colors.gray700}),c=li({reactionCount:n});return s.a.createElement(B.a,{style:[hi.container,i?hi.marginShort:hi.marginLong,a?hi.alignRight:hi.alignLeft,r?hi.visible:hi.invisible]},s.a.createElement(ci,{conversationId:e,entryId:t},s.a.createElement(C.a,{accessibilityLabel:c,focusable:!0,interactiveStyles:o,onPress:this._handleScribeDMReactionSummary,ref:this._onSetReactionsNode,style:hi.content},this._renderReactions)))}_measureWidths(e){const t=e&&e.parentElement,i={emojiSize:"headline1"};if(t){const{width:a}=t.getBoundingClientRect(),{width:n=0}=e?e.getBoundingClientRect():{};n>a&&(i.emojiSize="subtext2")}this.setState({...i})}}const hi=S.a.create((e=>({container:{boxSizing:"border-box"},content:{borderRadius:e.borderRadii.infinite,display:"flex",flexDirection:"row"},rightPadding:{paddingRight:e.spaces.space2},elementPadding:{borderColor:e.colors.transparent,borderWidth:e.borderWidths.small,paddingBottom:e.spaces.space2,paddingTop:e.spaces.space2,paddingLeft:`calc(${e.spaces.space2} * 2)`},selfSelect:{borderColor:S.a.theme.colors.gray50,borderRadius:e.borderRadii.infinite},alignLeft:{alignSelf:"flex-start"},alignRight:{alignSelf:"flex-end"},invisible:{opacity:0},visible:{opacity:1},marginShort:{marginBottom:e.spaces.space4},marginLong:{marginBottom:e.spaces.space12},isHoveredDMReaction:{borderColor:e.colors.transparent,cursor:"pointer"}})));var pi=Object(Fe.a)(Ut(di)),ui=i("Xrkv");const mi=Ee.a.icd0bf34,gi=Ee.a.e8bd8fec,_i=Ee.a.b2d32fad,bi=Ee.a.a763d33e;class fi extends s.a.PureComponent{constructor(e){super(e),this._handlePress=e=>{e.stopPropagation(),this.setState({showFullList:!0})},this.state={showFullList:!1}}render(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:i}=this.props;return s.a.createElement(B.a,{style:vi.root},s.a.createElement(N.b,{align:"right",color:"gray700",size:"subtext2",style:vi.seenLabel},this._renderSeenLabel()),!t&&e&&i.length?this._renderNameList():null)}_renderSeenLabel(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:i}=this.props;return t?e?_i:mi:i.length?bi({count:i.length}):gi}_renderNameList(){let{namesToDisplay:e}=this.props;const{showFullList:t}=this.state,i=!t&&e.length>10,a=e.length-10,n=({namesList:e,othersCount:t})=>s.a.createElement(Ee.a.I18NFormatMessage,{$i18n:"f6464106"},s.a.createElement(N.b,null,e),s.a.createElement(N.b,{color:"link",onPress:this._handlePress},Ee.a.d7a0722f({othersCount:t})));i&&(e=e.slice(0,10));const r=Object(ui.a)(e,i);return s.a.createElement(N.b,{align:"right",color:"gray700",size:"subtext2",style:vi.namesList},i?s.a.createElement(n,{namesList:r,othersCount:a}):s.a.createElement(N.b,null,r))}}const vi=S.a.create((e=>({root:{alignItems:"flex-end",width:`calc(100% - ${e.spaces.space2})`},seenLabel:{cursor:"pointer"},namesList:{marginBottom:e.spaces.space2,whiteSpace:"pre-line"}})));var yi=fi,Ei=i("t0aI");const Si=({entryId:e,participants:t,user:i})=>{const a=Ri({entryId:e,participants:t,user:i});return{namesToDisplay:a,isSeenByEveryone:a.length===t.length-1}},Ri=({entryId:e,participants:t,user:i})=>t.reduce(((t,a)=>{const{join_conversation_event_id:n,last_read_event_id:s,user:{name:r}}=a,o=a.user_id!==i.id_str,c=s&&1!==Object(Ei.a)(e,s),l=!n||1!==Object(Ei.a)(n,e);return o&&c&&l&&t.push(r),t}),[]);var Ci=i("IMYl"),wi=i("21zW"),xi=i("gmpV");const Ai=Ee.a.fad48ee9,Ti=Ee.a.ba60339a,Ii=Ee.a.d338f53e,Oi=Ee.a.ae7d7a24,Mi=Ee.a.d725a288,ki=Ee.a.bbe74f3f,Pi=Ee.a.h0e4cdf4,Di=Ee.a.bfbc051c;class Li extends s.a.PureComponent{constructor(...e){super(...e),this._handleRemove=()=>{const{conversationId:e,entryId:t,removeEntry:i}=this.props;i(e,null,{id:t})},this._handleTryAgain=()=>{const{conversationId:e,entryText:t,localMediaId:i,sendMessage:a,user:n}=this.props;a({tweetAttachment:void 0,senderId:n.id_str,conversationId:e,text:t,localMediaId:i}),this._handleRemove()}}render(){const{isSent:e,onPress:t}=this.props,i=this._renderSending(),a=this._renderError(),n=this._renderTimestamp(),r=this._renderReadReceipt(),o=this._renderSentCheckmark(),c=this._renderReactions(),l=n||r||o,d=i||a||c||l,h=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_chat_p0_enabled");return d&&s.a.createElement(B.a,{style:[Fi.root,h&&Fi.vdlRootMargin,e&&Fi.sentMessage]},i,a,c,l?s.a.createElement(C.a,{interactiveStyles:null,onPress:t,style:e&&Fi.sentContainer},s.a.createElement(B.a,{style:e&&Fi.groupedItems},n,o),r):null)}_renderError(){const{isError:e}=this.props;return e&&s.a.createElement(B.a,null,s.a.createElement(N.b,{align:"right",color:"gray700",size:"subtext2"},Oi),s.a.createElement(B.a,{style:Fi.groupedItems},s.a.createElement(N.b,{accessibilityRole:"button",color:"magenta500",onPress:this._handleRemove,size:"subtext2",withInteractiveStyling:!0},Ti),s.a.createElement(wi.a,null),s.a.createElement(N.b,{accessibilityRole:"button",color:"primary",onPress:this._handleTryAgain,size:"subtext2",withInteractiveStyling:!0},Ii)))}_renderReactions(){const{conversationId:e,entryId:t,isLastRapidFire:i,isRapidFire:a,isSent:n,withUserAvatar:r}=this.props,o=!a||i;return e?s.a.createElement(B.a,{style:r&&Fi.footerPadderWithAvatar},s.a.createElement(pi,{conversationId:e,entryId:t,isEndOfDM:o,isSent:n})):null}_renderReadReceipt(){const{entryId:e,isActive:t,isDraft:i,isError:a,isGroupDM:n,isSent:r,participants:o,user:c}=this.props;return t&&r&&!i&&!a?s.a.createElement(yi,Mt()({isGroupDM:n},Si({entryId:e,participants:o,user:c}))):null}_renderSending(){const{isDraft:e,isError:t}=this.props;return e&&!t&&s.a.createElement(N.b,{align:"right",color:"gray700",size:"subtext2"},Ai)}_renderSentCheckmark(){const{entryId:e,isDraft:t,isError:i,isLastRapidFire:a,isRapidFire:n,isSent:r,participants:o,user:c}=this.props,{isSeenByEveryone:l}=Si({entryId:e,participants:o,user:c});return!r||t||i||n&&!a?null:s.a.createElement(N.b,{color:l?"primary":"gray700",style:Fi.checkmarkContainer},s.a.createElement(Ci.a,{style:Fi.checkmark}))}_renderTimestamp(){const{entryTime:e,isDraft:t,isError:i,isGroupDM:a,isLastRapidFire:n,isRapidFire:r,isSent:o,user:{name:c},withUserAvatar:l}=this.props;if(t||i||r&&!n)return null;const d=new Date(Number(e));let h;h=Object(xi.c)(d)?Mi(d):Object(xi.d)(d)?ki({time:Mi(d)}):Object(xi.e)(d)?Pi(d):Di(d);const p=a&&!o,u=o?"right":"left";return s.a.createElement(B.a,{style:[l&&Fi.footerPadderWithAvatar,o&&Fi.timestamp]},s.a.createElement(N.b,{align:u,color:"gray700",size:"subtext2",withInteractiveStyling:o||!Ke.a.isEnabled},p&&s.a.createElement(Ee.a.I18NFormatMessage,{$i18n:"c8b914d4"},s.a.createElement(N.b,null,c)),p&&" ",h))}}Li.contextType=f.a;const Fi=S.a.create((e=>({root:{marginTop:e.spaces.space2,overflow:"hidden",width:Dt},vdlRootMargin:{marginTop:`calc(${e.spaces.space8} - ${e.spaces.space2})`},sentMessage:{alignSelf:"flex-end",justifyContent:"flex-end"},sentContainer:{flexDirection:"column"},groupedItems:{justifyContent:"flex-end",flexDirection:"row"},timestamp:{cursor:"pointer"},checkmark:{cursor:"pointer",flexShrink:0,height:"1rem",paddingLeft:e.spaces.space2},checkmarkContainer:{lineHeight:"1"},footerPadderWithAvatar:{marginLeft:`calc(${e.spaces.space40} + ${e.spaces.space12})`}})));var Bi=Pt(Li),Ni=i("jtO7");const ji=S.a.create((e=>({root:{borderColor:e.colors.gray50,borderStyle:"solid",borderWidth:e.borderWidths.small,borderBottomWidth:e.borderWidths.none,boxSizing:"border-box",overflow:"hidden"},isLast:{borderBottomWidth:e.borderWidths.small},insideTopRoundedSent:{borderTopLeftRadius:e.borderRadii.xLarge},insideTopRoundedReceived:{borderTopRightRadius:e.borderRadii.xLarge},outsideTopRoundedSent:{borderTopRightRadius:e.borderRadii.xLarge},outsideTopRoundedReceived:{borderTopLeftRadius:e.borderRadii.xLarge},sentLast:{borderBottomLeftRadius:e.borderRadii.xLarge},receivedLast:{borderBottomRightRadius:e.borderRadii.xLarge}})));var Ui=({insideTopRounded:e,isLast:t,isSent:i,label:a,onClick:n,outsideTopRounded:r,tcoUrl:o})=>{const c=[ji.root,t&&ji.isLast,t&&i&&ji.sentLast,t&&!i&&ji.receivedLast,e&&i&&ji.insideTopRoundedSent,e&&!i&&ji.insideTopRoundedReceived,r&&i&&ji.outsideTopRoundedSent,r&&!i&&ji.outsideTopRoundedReceived];return s.a.createElement(B.a,{style:c},s.a.createElement(Ni.a,{align:"center",color:"primary",label:a,link:o,onClick:n}))},Hi=i("fs1G");class Wi extends s.a.Component{componentDidMount(){this.props.onImpression()}render(){const{callToActions:e,isSent:t,onCtaClick:i,withSticker:a,withUserText:n}=this.props,r=e.map(((r,o)=>{const c=0===o;return s.a.createElement(Ui,{insideTopRounded:c&&(a||!n),isLast:o===e.length-1,isSent:t,key:o,label:r.label,onClick:i,outsideTopRounded:c&&a,tcoUrl:r.tco_url})}));return s.a.createElement(B.a,null,r)}}Wi.defaultProps={onCtaClick:Hi.a,onImpression:Hi.a};var Vi=Wi,zi=i("vjRr"),qi=i("EGrD");const Gi=(e,t)=>zi.a.createManyHydratedSelector([t.cardUrl])(e)[0];var Yi=Object(me.a)().propsFromState((()=>({adFreeArticleDomains:qi.c,card:Gi}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(ge.createLocalApiErrorHandlerWithContextFactory)("DM_CARD_MESSAGE"),fetchAdFreeToken:qi.a,loadAdFreeArticleDomainsFromPersistence:qi.b,popOutConversation:b.popOutConversation})));const $i=S.a.create((e=>({root:{width:"100%"},invisible:{opacity:0},visible:{opacity:1}})));var Ki=({attachmentContent:e,attachmentHeader:t,isVisible:i=!0,textContent:a})=>s.a.createElement(B.a,{style:[i?$i.visible:$i.invisible,$i.root]},t,e,a),Qi=i("cTG8");const Xi=({excludeCardUrl:e,isActive:t=!1,isFailedDraft:i,isFirstRapidFire:a=!1,isRapidFire:n=!1,isSent:r,hasAssociatedAttachment:o,messageData:c={},rootStyle:l,tweetId:d,withCta:h,withMediaLinks:p,withMessageBubble:u})=>{const{featureSwitches:m}=s.a.useContext(f.a),g=m.isTrue("dm_vdl_enabled")&&m.isTrue("dm_vdl_chat_p0_enabled"),_=[l,u&&Ji.messageTextContainer,u&&r&&Ji.sent,u&&!r&&Ji.received,i&&Ji.failedDraft,n&&!a&&!r&&Ji.rapidFireReceived,n&&!a&&r&&Ji.rapidFireSent,o&&r&&Ji.hasAssociatedAttachmentSent,o&&!r&&Ji.hasAssociatedAttachmentReceived,u&&g&&r&&Ji.vdlSent,u&&t&&r&&Ji.activeSent,u&&g&&t&&r&&Ji.vdlActiveSent,u&&t&&!r&&!Ke.a.isEnabled&&Ji.activeReceived,h&&Ji.withCta],b=[Ji.tweetText,u&&Ji.textAlignLeft,!u&&r&&Ji.textAlignRight],{gray0:v,magenta500:y,primary:R,text:w,white:x}=S.a.theme.colors,A=E.a.generate({color:r?x:w,backgroundColor:i?y:r?R:v}),T=c.text&&c.text.length||0;return s.a.createElement(C.a,{accessibilityRole:"none",interactive:r,interactiveStyles:u?A:null,style:_},s.a.createElement(Qi.a,{color:S.a.isDarkMode()||r?"whiteOnColor":void 0,displayTextRange:[0,T],entities:c.entities,excludeCardUrl:e,linkColor:u&&r||S.a.isDarkMode()?"whiteOnColor":"link",linkify:!0,quotedTweetId:d,size:u?void 0:"title2",style:b,text:c.text||"",underlineLinks:!0,withMediaLinks:p}))},Ji=S.a.create((e=>({tweetText:{overflow:"hidden",wordBreak:"break-word"},messageTextContainer:{borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",maxWidth:"100%",paddingVertical:e.spaces.space12,paddingHorizontal:e.spaces.space16},textAlignLeft:{textAlign:"left"},textAlignRight:{textAlign:"right"},sent:{alignSelf:"flex-end",backgroundColor:e.colors.primary,borderBottomRightRadius:e.borderRadii.none,borderColor:e.colors.primary},received:{alignSelf:"flex-start",backgroundColor:e.colors.dmReceivedBubbleBackground,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200},vdlSent:{backgroundColor:e.colors.blue600},activeSent:{backgroundColor:e.colors.lightPrimary},activeReceived:{backgroundColor:e.colors.gray200},vdlActiveSent:{backgroundColor:e.colors.blue700},failedDraft:{backgroundColor:e.colors.magenta500},rapidFireReceived:{borderTopLeftRadius:e.borderRadii.none},rapidFireSent:{borderTopRightRadius:e.borderRadii.none},withCta:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},hasAssociatedAttachmentSent:{borderTopRightRadius:e.borderRadii.none},hasAssociatedAttachmentReceived:{borderTopLeftRadius:e.borderRadii.none}})));Xi.defaultProps={withMediaLinks:!1};var Zi=Xi;var ea=({isActive:e=!1,isFailedDraft:t,isFirstRapidFire:i=!1,isRapidFire:a=!1,isSent:n,messageData:r,withCta:o,withMessageBubble:c})=>s.a.createElement(Zi,{isActive:e,isFailedDraft:t,isFirstRapidFire:i,isRapidFire:a,isSent:n,messageData:r,withCta:o,withMediaLinks:!0,withMessageBubble:c}),ta=i("LSr9"),ia=i("aX4+"),aa=i("/Ikv");const{CardNames:na}=aa.a;class sa extends s.a.Component{constructor(...e){var t;super(...e),this.state={attachmentWidth:void 0,textContentWidth:void 0},this._hasClaimsForAdFreeArticles=null==(t=this.context.userClaims)?void 0:t.isTrueAndEnabled("subscriptions_feature_1006"),this._handleAttachmentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;if(i!==t){const e={attachmentWidth:t};this.setState(e)}},this._handleOnClick=e=>{const{card:{binding_values:t},conversationId:i,popOutConversation:a}=this.props;if(i&&a(i),this._hasClaimsForAdFreeArticles){const{adFreeArticleDomains:i,createLocalApiErrorHandler:a,fetchAdFreeToken:n}=this.props,[s,r]=new ta.a(n,a()).getAdFreeArticlesClickHandler({destinationUrl:aa.a.getBindingValue(t,"card_url"),linkDomain:aa.a.getBindingValue(t,"domain"),adFreeArticleDomains:i});s&&r(e)}},this._handleTextContentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;if(i!==t){const e={textContentWidth:t};this.setState(e)}}}componentDidMount(){this._hasClaimsForAdFreeArticles&&this.props.loadAdFreeArticleDomainsFromPersistence()}render(){const{card:e,hasUserText:t,isActive:i,isFailedDraft:a,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:h,textContentWidth:p}=this.state,u=!!Object.values(na).includes(e.name),m=at(t,h,p),g=m.isAttachmentSquared?"both":o?"right":"left",_=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_chat_p0_enabled"),b=s.a.createElement(B.a,{onClick:this._handleOnClick,onLayout:this._handleAttachmentLayout},s.a.createElement(ia.a,{card:{name:e.name,url:e.url,binding_values:e.binding_values,users:e.users},cardContext:{tweetUserId:c.sender_id},dmSentOrReceived:o?"sent":"received",withBorderShadow:_,withSquareBottomBorderRadius:g})),f=t?s.a.createElement(B.a,{onLayout:this._handleTextContentLayout,style:o?ra.sentMessageWrapper:ra.receivedMessageWrapper},s.a.createElement(Zi,{excludeCardUrl:e.url,hasAssociatedAttachment:!0,isActive:i,isFailedDraft:a,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,rootStyle:m.isTextSquared?o?ra.textSentSquared:ra.textReceivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return u?s.a.createElement(Ki,{attachmentContent:b,isVisible:m.compositeRendered,textContent:f}):s.a.createElement(ea,{isActive:i,isFailedDraft:a,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,withCta:l,withMessageBubble:d})}}sa.defaultProps={hasUserText:!1},sa.contextType=f.a;const ra=S.a.create((e=>({attachmentReceivedSquared:{borderBottomRightRadius:e.borderRadii.none},attachmentSentSquared:{borderBottomLeftRadius:e.borderRadii.none},card:{marginBottom:e.spaces.space2},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:e.borderRadii.none},sent:{borderBottomRightRadius:e.borderRadii.none},textReceivedSquared:{borderTopRightRadius:e.borderRadii.none},textSentSquared:{borderTopLeftRadius:e.borderRadii.none}})));var oa=Yi(sa);const ca=Ee.a.f720438f;class la extends s.a.Component{constructor(...e){super(...e),this.state={attachmentWidth:void 0,textContentWidth:void 0},this._getSquareBottomStyles=e=>{const{isSent:t}=this.props;let i="left";return e?i="both":t&&(i="right"),da[i]},this._handleAttachmentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;i!==t&&this.setState({attachmentWidth:t})},this._handleTextContentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;i!==t&&this.setState({textContentWidth:t})}}render(){const{hasUserText:e,isActive:t,isFailedDraft:i,isFirstRapidFire:a,isRapidFire:n,isSent:r,messageData:o,withCta:c,withMessageBubble:l}=this.props,{attachmentWidth:d,textContentWidth:h}=this.state;if(!o||!o.attachment||!o.attachment.fleet)return null;const{compositeRendered:p,isAttachmentSquared:u,isTextSquared:m}=at(e,d,h),g=[ha.tombstoneWrapper,r?ha.sentMessageWrapper:ha.receivedMessageWrapper,this._getSquareBottomStyles(u)],_=s.a.createElement(B.a,{onLayout:this._handleAttachmentLayout,style:g},s.a.createElement(N.b,{color:"gray700"},ca)),b=e?s.a.createElement(B.a,{onLayout:this._handleTextContentLayout,style:[r?ha.sentMessageWrapper:ha.receivedMessageWrapper,!l&&ha.fleetReactionSpacing]},s.a.createElement(Zi,{hasAssociatedAttachment:!0,isActive:t,isFailedDraft:i,isFirstRapidFire:a,isRapidFire:n,isSent:r,messageData:o,rootStyle:m?r?ha.sentSquared:ha.receivedSquared:void 0,withCta:c,withMessageBubble:l})):null;return s.a.createElement(Ki,{attachmentContent:_,isVisible:p,textContent:b})}}const da=S.a.create((e=>({both:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},left:{borderBottomLeftRadius:e.borderRadii.none},right:{borderBottomRightRadius:e.borderRadii.none}}))),ha=S.a.create((e=>({fleetReactionSpacing:{marginTop:e.spaces.space4},receivedMessageWrapper:{alignSelf:"flex-start"},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sentMessageWrapper:{alignSelf:"flex-end"},sentSquared:{borderTopLeftRadius:e.borderRadii.none},tombstoneWrapper:{backgroundColor:e.colors.gray0,borderColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",flexDirection:"row",borderWidth:e.borderWidths.small,paddingHorizontal:e.spaces.space16,paddingVertical:e.spaces.space12,overflow:"auto"}})));var pa=la,ua=(i("849X"),i("prG5")),ma=i("RCZO"),ga=i("A91F");const _a=Ee.a.b327c129,ba=e=>{e.stopPropagation()};var fa=({media:e,mediaUrl:t})=>{const i=e.ext_alt_text||_a,a=e.media_url_https,{height:n,width:r}=e.original_info||{},o=Object(ma.b)(e).rgb,c=s.a.createElement(ua.a,{accessibilityLabel:i,aspectMode:ga.a.withinRange(9/16,10),backgroundColor:o,image:{url:a,width:r,height:n},shouldShowAltLabel:!!e.ext_alt_text});return t?s.a.createElement(C.a,{interactiveStyles:null,link:t,onPress:ba},c):c},va=i("Modb"),ya=i("lklz"),Ea=i("XrEN"),Sa=i("ZvMt");var Ra=({media:e,messageId:t})=>{const i=e&&Ea.a.extractVideoProps(ya.b.forDm(t),e);return i?s.a.createElement(va.a,Mt()({},i,{aspectRatio:Sa.a.getAspectRatio(e.video_info),withPostPlayback:!0})):null},Ca=Object(me.a)().withAnalytics();class wa extends s.a.PureComponent{constructor(e,t){super(e,t),this._handleLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e;this.state.width!==t&&this.setState({width:t})},this._getElement=()=>{const{contentType:e,isSensitive:t}=this.props;return`${t?"sensitive":"untrusted"}_${e}_interstitial`},this._handleClick=()=>{const{analytics:e}=this.props;this.setState({hide:!1}),e.scribe({element:this._getElement(),action:"reveal"})},this.state={hide:!0,width:0}}componentDidMount(){const{analytics:e}=this.props;e.scribe({element:this._getElement(),action:"impression"})}render(){const{children:e,ctaText:t,description:i,withSquareBottomBorderRadius:a}=this.props,{hide:n,width:r}=this.state,o=r<S.a.theme.breakpoints.micro;return n?s.a.createElement(B.a,{focusable:!0,onLayout:this._handleLayout,style:[Aa.root,o?{flexDirection:"column"}:{flexDirection:"row",alignItems:"center"},a&&xa[a]]},s.a.createElement(B.a,{style:Aa.description},s.a.createElement(N.b,null,i)),s.a.createElement(B.a,{style:[Aa.button,o?Aa.breakButtonWrapper:void 0]},s.a.createElement($e.a,{onClick:this._handleClick,size:"small",style:Aa.buttonElement,type:"brandText"},t))):e}}wa.defaultProps={isSensitive:!1};const xa=S.a.create((e=>({both:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},left:{borderBottomLeftRadius:e.borderRadii.none},right:{borderBottomRightRadius:e.borderRadii.none}}))),Aa=S.a.create((e=>({breakButtonWrapper:{marginTop:S.a.theme.spaces.space4,marginLeft:`calc(-1 * ${e.spaces.space12})`},button:{flexGrow:1,alignItems:"flex-start"},buttonElement:{paddingHorizontal:e.spaces.space12},description:{flexGrow:1,flexShrink:1},root:{backgroundColor:e.colors.gray0,borderColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",borderWidth:e.borderWidths.small,maxWidth:"100%",paddingLeft:e.spaces.space16,paddingTop:e.spaces.space16,paddingBottom:e.spaces.space16,paddingRight:e.spaces.space4,overflow:"auto",display:"flex"}})));var Ta=Object(Fe.a)(Ca(wa)),Ia=i("CoGJ");const Oa=s.a.createElement(Ia.a,null),Ma=Ee.a.d9de7b57,ka=Ee.a.f2879f4d,Pa=Ee.a.b518221e,Da=Ee.a.eeaa9f90,La=Ee.a.g2b43663,Fa=Ee.a.f277e949;class Ba extends s.a.Component{constructor(...e){super(...e),this.state={attachmentWidth:void 0,textContentWidth:void 0},this._renderAttachment=()=>{const{entry:e,hasUserText:t,isFirstRapidFire:i,isRapidFire:a,isSent:n,isTrusted:r,messageData:o}=this.props,{attachmentWidth:c,textContentWidth:l}=this.state,{attachment:d}=o||{},h=e.is_draft,p=at(t,c,l),m=[Na.mediaAttachment,n&&Na.isSent,!n&&Na.received,n&&p.isAttachmentSquared&&Na.equalComponentDimensionsSent,!n&&p.isAttachmentSquared&&Na.equalComponentDimensionsReceived,a&&!i&&n&&Na.rapidFireSent,a&&!i&&!n&&Na.rapidFireReceived];let g,_,b=null;if(!h&&e.conversation_id&&(b=`/messages/${e.conversation_id}/media/${e.id}`),d)if(d.photo)g=d.photo,_=s.a.createElement(fa,{media:g,mediaUrl:b});else if(d.animated_gif)g=d.animated_gif,_=s.a.createElement(Ra,{media:g,messageId:e.id});else if(d.video){if(g=d.video,Object(u.l)(d,this.context.featureSwitches))throw new Error("DMMediaMessage should not be used to render voice messages");_=s.a.createElement(Ra,{media:g,messageId:e.id})}const f=p.isAttachmentSquared?"both":n?"right":"left",v=g&&_&&(n?_:this._getMediaContentWithGuard(g,r,_,f));return{attachmentContent:s.a.createElement(B.a,{onLayout:this._handleAttachmentLayout,style:m},v),media:g}},this._handleAttachmentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;if(i!==t){const e={attachmentWidth:t};this.setState(e)}},this._handleTextContentLayout=e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;if(i!==t){const e={textContentWidth:t};this.setState(e)}}}render(){const{entry:e,hasUserText:t,isActive:i,isFailedDraft:a,isFirstRapidFire:n,isRapidFire:r,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:h,textContentWidth:p}=this.state,u=e.is_draft,m=at(t,h,p),{attachmentContent:g,media:_}=this._renderAttachment(),b=t?s.a.createElement(B.a,{onLayout:this._handleTextContentLayout,style:o?Na.sentMessageWrapper:Na.receivedMessageWrapper},s.a.createElement(Zi,{hasAssociatedAttachment:!0,isActive:!!i,isFailedDraft:a,isFirstRapidFire:!!n,isRapidFire:!!r,isSent:o,messageData:u?c:this._parseMessageData(c,_),rootStyle:m.isTextSquared?o?Na.sentSquared:Na.receivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return s.a.createElement(Ki,{attachmentContent:g,isVisible:m.compositeRendered,textContent:b})}_getMediaContentWithGuard(e,t,i,a){const{displaySensitiveMedia:n,isDmNsfwMediaFilterEnabled:r}=this.props;if(e.possibly_sensitive&&this.context.featureSwitches.isTrue("dm_conversations_nsfw_media_filter_enabled")){if(r){const t="animated_gif"===e.type&&La||"video"===e.type&&Da||Pa;return s.a.createElement(Ta,{contentType:e.type,ctaText:t,description:ka,isSensitive:!0,withSquareBottomBorderRadius:a},i)}}else if(!n&&e.possibly_sensitive)return s.a.createElement(Ta,{contentType:e.type,ctaText:Fa,description:Oa,isSensitive:!0,withSquareBottomBorderRadius:a},i);return t?i:s.a.createElement(Ta,{contentType:e.type,ctaText:Fa,description:Ma,withSquareBottomBorderRadius:a},i)}_parseMessageData(e,t){var i;const a=null!=e&&null!=(i=e.entities)&&i.urls&&t?e.entities.urls.filter((e=>e.display_url!==t.display_url)):null;return e&&a?{...e,entities:{...e.entities,urls:a,media:t?[t]:[]}}:void 0}}Ba.contextType=f.a,Ba.defaultProps={hasUserText:!1};const Na=S.a.create((e=>({equalComponentDimensionsSent:{borderBottomLeftRadius:e.borderRadii.none},equalComponentDimensionsReceived:{borderBottomRightRadius:e.borderRadii.none},invisible:{opacity:0},isSent:{borderBottomRightRadius:e.borderRadii.none},mediaAttachment:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},rapidFireReceived:{borderTopLeftRadius:e.borderRadii.none},rapidFireSent:{borderTopRightRadius:e.borderRadii.none},received:{borderBottomLeftRadius:e.borderRadii.none},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sentSquared:{borderTopLeftRadius:e.borderRadii.none},visible:{opacity:1}})));var ja=Ba,Ua=Object(me.a)().propsFromActions((()=>({markSpamStatus:b.markSpamStatus})));const Ha=Ee.a.fd07947f,Wa=Ee.a.c7a92dc9,Va=Ee.a.f277e949,za=Ee.a.fb3ccb55;class qa extends s.a.PureComponent{constructor(...e){super(...e),this._handlePress=e=>()=>{const{conversationId:t,dmId:i,markSpamStatus:a}=this.props;a({conversationId:t,dmId:i,markSpam:e})}}render(){const{children:e}=this.props;return s.a.createElement(Ta,{contentType:"dm",ctaText:Va,description:za},e,this._renderButtons())}_renderButtons(){return s.a.createElement(B.a,{style:Ya.buttons},s.a.createElement($e.a,{onPress:this._handlePress(!1),style:Ya.leftButton,type:"brandOutlined"},Wa),s.a.createElement($e.a,{onPress:this._handlePress(!0),type:"brandOutlined"},Ha))}}var Ga=Ua(qa);const Ya=S.a.create((e=>({buttons:{flexDirection:"row",paddingTop:e.spaces.space4},leftButton:{marginRight:e.spaces.space12}})));var $a=i("U+bB");const Ka=e=>{const t=e.images,i=t.svg||t.size_1x;if(i)return i.url},Qa=S.a.create((e=>({stickerItem:{height:`calc(3 * ${e.fontSizes.title2})`,width:`calc(3 * ${e.fontSizes.title2})`}})));var Xa=({sticker:e})=>s.a.createElement($a.a,{accessibilityLabel:e.display_name,source:Ka(e),style:Qa.stickerItem}),Ja=i("XOJV");const Za=(e,t)=>{var i;const a=null==(i=t.messageData)?void 0:i.attachment;if(a&&a.tweet)return a.tweet.status};var en=Object(me.a)().propsFromState((()=>({tweet:Ja.a.createHydratedTweetSelector(Za)}))).propsFromActions((()=>({popOutConversation:b.popOutConversation}))),tn=i("b5s6");const an=s.a.createElement(N.b,{link:"/settings/safety"});var nn=e=>s.a.createElement(Ee.a.I18NFormatMessage,{$i18n:"j3c7dd33"},s.a.cloneElement(an,null,Ee.a.adcf07b5));const sn=Ee.a.e4df0ad7,rn=Ee.a.f277e949,on=Ee.a.b5b91d58,cn=Ee.a.bb594d7b,ln=s.a.createElement(nn,null);const dn=S.a.create((e=>({attachment:{marginBottom:0},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200},receivedAttachmentSquared:{borderBottomRightRadius:e.borderRadii.none},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sent:{borderBottomRightRadius:e.borderRadii.none,borderColor:e.colors.primary},sentAttachmentSquared:{borderBottomLeftRadius:e.borderRadii.none},sentSquared:{borderTopLeftRadius:e.borderRadii.none}})));var hn=en((function(e){const{featureSwitches:t}=s.a.useContext(f.a),{conversationId:i,displaySensitiveMedia:a,hasUserText:n=!1,isActive:r=!1,isDmNsfwMediaFilterEnabled:o,isFailedDraft:c,isFirstRapidFire:l=!1,isRapidFire:d=!1,isSent:h,isTrusted:p,messageData:u,popOutConversation:m,tweet:g,withCta:_,withMessageBubble:b}=e,[v,y]=s.a.useState(void 0),[E,S]=s.a.useState(void 0),R=s.a.useMemo((()=>function(){i&&m(i)}),[i,m]),C=s.a.useMemo((()=>function(e){const{nativeEvent:{layout:{width:t}}}=e;v!==t&&y(t)}),[v]),w=s.a.useMemo((()=>function(e){const{nativeEvent:{layout:{width:t}}}=e;E!==t&&S(t)}),[E]);if(!u||!u.attachment||!u.attachment.tweet)return null;const x=u.attachment.tweet,A=h?"sent":"received",T=at(n,v,E),I=s.a.createElement(tn.a,{onPress:R,style:[dn[A],n&&dn.attachment,T.isAttachmentSquared?h?dn.sentAttachmentSquared:dn.receivedAttachmentSquared:void 0],tweetId:x.status}),O=T.isAttachmentSquared?"both":h?"right":"left",M=(()=>{if(!g)return null;if(h)return I;if(g.possibly_sensitive&&t.isTrue("dm_conversations_nsfw_media_filter_enabled")){if(o||void 0===o)return s.a.createElement(Ta,{contentType:"photo",ctaText:cn,description:on,withSquareBottomBorderRadius:O},I)}else if(!a&&g.possibly_sensitive)return s.a.createElement(Ta,{contentType:"photo",ctaText:rn,description:ln,withSquareBottomBorderRadius:O},I);return p?I:s.a.createElement(Ta,{contentType:"tweet",ctaText:rn,description:sn,withSquareBottomBorderRadius:O},I)})(),k=s.a.createElement(B.a,{onLayout:C,style:dn.attachment},M),P=n?s.a.createElement(B.a,{onLayout:w,style:h?dn.sentMessageWrapper:dn.receivedMessageWrapper},s.a.createElement(Zi,{hasAssociatedAttachment:!0,isActive:r,isFailedDraft:c,isFirstRapidFire:l,isRapidFire:d,isSent:h,messageData:u,rootStyle:T.isTextSquared?h?dn.sentSquared:dn.receivedSquared:void 0,tweetId:x.status,withCta:_,withMediaLinks:!0,withMessageBubble:b})):null;return s.a.createElement(Ki,{attachmentContent:k,isVisible:T.compositeRendered,textContent:P})})),pn=i("htvZ"),un=i("MH+I"),mn=i("5Ixf"),gn=i("AtEG");function _n(e){var t,i;const a=s.a.useContext(pn.a),{isLowQuality:n,isSent:r,isTrusted:o}=e;if(null==(t=e.media)||!t.video_info)return null;const[c,l]=a.activeVoiceMessage,[d]=a.playerApi,[h]=a.playerState,{scribeAction:p}=a,[u]=c,m=e.messageId===u;if(!p)return null;const g=fn(h),_=(null==(i=e.media)?void 0:i.video_info.duration_millis)||0,b={durationMs:_,isActive:m,isSent:r,playerApi:null,playerState:null,onImpression:()=>p.impression({isLowQuality:n,isTrusted:o}),onPlayRequest:()=>l([e.messageId,e.media]),onPlay:()=>p.play({data:{duration_ms:_}}),onPause:()=>p.pause()};return m&&g&&g.contentId===e.media.id_str&&(b.playerApi=d,b.playerState=h,null!=g&&g.durationMs&&(b.durationMs=null==g?void 0:g.durationMs)),s.a.createElement(bn,b)}function bn(e){const{isActive:t,isSent:i,playerApi:a,playerState:n}=e,r=null==n?void 0:n.isPlaying,o=fn(n),c=(null==o?void 0:o.currentTimeMs)||0,l=(null==o?void 0:o.durationMs)||e.durationMs,d=Math.max(t?l-c:l,0);s.a.useLayoutEffect((()=>{e.onImpression()}),[]),s.a.useEffect((()=>{a&&0===c&&(a.play(),e.onPlay())}),[a]);const h=S.a.isDarkMode()||i,p={color:h?"whiteOnColor":"text"},u=[En.voiceMessage,Sn({isSent:i,squared:t}),i?En.voiceMessageSent:En.voiceMessageReceived,Q(S.a.theme.scale).voiceMessage({isVoiceMessageActive:t,isSent:i})],m=r?mn.a:gn.a;return s.a.createElement(B.a,{style:[En.container,Q(S.a.theme.scale).voiceMessageContainer({isVoiceMessageActive:t,isSent:i})]},s.a.createElement(B.a,{style:u},s.a.createElement(B.a,{style:En.startSpacer}),s.a.createElement($e.a,{accessibilityLabel:r?yn:vn,icon:s.a.createElement(m,{style:h?En.iconColorDark:En.iconColorDefault}),onPress:()=>{a?r?(a.pause(),e.onPause()):(a.play(),e.onPlay()):e.onPlayRequest()},type:"onMediaText"}),s.a.createElement(B.a,{style:En.durationSpacer}),s.a.createElement(B.a,{style:i?En.durationOpacity:void 0},s.a.createElement(un.a,Mt()({countdown:!0,timeMs:d},p,{color:"gray700",size:"subtext2",style:i?En.durationDark:void 0,weight:"bold",withCountdownSymbol:t}))),s.a.createElement(B.a,{style:En.endSpacer})))}const fn=e=>e?e.tracks[e.currentTrackId]:null,vn=Ee.a.c94b7d89,yn=Ee.a.eb6f9582,En=S.a.create((e=>({displayNone:{display:"none"},container:{flexDirection:"row",alignSelf:"flex-end",alignItems:"center",justifyContent:"center"},voiceMessage:{alignSelf:"flex-end",flexDirection:$.a.getConstants().isRTL?"row-reverse":"row",alignItems:"center",justifyContent:"center"},voiceMessageSent:{backgroundColor:e.colors.primary},voiceMessageReceived:{backgroundColor:e.colors.dmReceivedBubbleBackground},durationSpacer:{width:e.spaces.space4},durationOpacity:{opacity:.75},durationDark:{color:e.colors.whiteOnColor},iconColorDark:{color:e.colors.whiteOnColor},iconColorDefault:{color:e.colors.alwaysBaseGray1100},startSpacer:{width:e.spaces.space4},endSpacer:{width:e.spaces.space16}})));function Sn({isSent:e,squared:t}){return[Rn.base,e?Rn.sent:Rn.received,t?e?Rn.sentSquared:Rn.receivedSquared:void 0]}const Rn=S.a.create((e=>({base:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},sent:{borderBottomRightRadius:e.borderRadii.none},sentSquared:{borderTopRightRadius:e.borderRadii.none},received:{borderBottomLeftRadius:e.borderRadii.none},receivedSquared:{borderTopLeftRadius:e.borderRadii.none}})));class Cn extends s.a.Component{render(){const{entry:e,isSent:t,onCtaClick:i,onCtaImpression:a}=this.props,{message_data:n}=e,r=n&&n.attachment?n.attachment:{},o=e.marked_as_spam,c=tt(e),l=!!n&&!!n.ctas,d=et(e),h=(e=>{const{message_data:t}=e;if(!t)return!1;if(tt(e)&&!it(e))return!1;if(!t.text)return!1;const i=Object(Je.parse)(t.text);if(!i||0===i.length)return!1;const a=i.sort(((e,t)=>t.indices[1]-e.indices[1])).reduce(((e,t)=>`${e.slice(0,t.indices[0])}${e.slice(t.indices[1])}`),t.text).trim();return i.length<=10&&0===a.length})(e),p=!(d&&h),m=it(e);let g;g=r.sticker?s.a.createElement(Xa,{sticker:r.sticker}):this._renderDMMessage(d,l,p);const _=o?s.a.createElement(Ga,{conversationId:e.conversation_id,dmId:e.id},g):g,b=c&&!m&&!Object(u.l)(null==n?void 0:n.attachment,this.context.featureSwitches),f=[t?wn.isSent:wn.isReceived,l&&wn.withCta,b?wn.mediaRoot:wn.flexShrink,this.props.style];return s.a.createElement(B.a,{style:f},_,n&&n.ctas?s.a.createElement(Vi,{callToActions:n.ctas,isSent:t,onCtaClick:i,onImpression:a,withSticker:!!r.sticker||h,withUserText:d}):null)}_renderDMMessage(e,t,i){const{displaySensitiveMedia:a,entry:n,isActive:r,isDmNsfwMediaFilterEnabled:o,isFirstRapidFire:c,isLowQuality:l,isRapidFire:d,isSent:h,isTrusted:p}=this.props,{error:m,message_data:g}=n,_=g&&{...g,entities:g&&g.entities||void 0,error:m},b=null==_?void 0:_.attachment,f={isActive:r,isFailedDraft:!!m,isFirstRapidFire:c,isRapidFire:d,isSent:h,withCta:t,withMessageBubble:i};if(_&&b){if(b.tweet)return s.a.createElement(hn,Mt()({conversationId:n.conversation_id,displaySensitiveMedia:a,hasUserText:e,isDmNsfwMediaFilterEnabled:o,isTrusted:p,messageData:_},f));if(b.photo||b.animated_gif||b.video)return b.video&&Object(u.l)(b,this.context.featureSwitches)?s.a.createElement(_n,{isLowQuality:l,isSent:!!h,isTrusted:p,media:b.video,messageId:n.id}):s.a.createElement(ja,Mt()({displaySensitiveMedia:a,entry:n,hasUserText:e,isDmNsfwMediaFilterEnabled:o,isTrusted:p,messageData:_},f));if(b.card)return s.a.createElement(oa,Mt()({cardUrl:b.card,conversationId:n.conversation_id,hasUserText:e,messageData:_},f));if(b.fleet)return s.a.createElement(pa,Mt()({entry:n,hasUserText:e,messageData:_},f))}return s.a.createElement(ea,Mt()({},f,{messageData:_}))}}Cn.contextType=f.a;const wn=S.a.create((e=>({flexShrink:{flexShrink:1},mediaRoot:{flex:1},isSent:{alignItems:"flex-end"},isReceived:{alignItems:"flex-start"},withCta:{alignItems:"stretch"}})));var xn=Cn;const An=S.a.create((e=>({avatar:{borderRadius:e.borderRadii.infinite}})));var Tn=({showAvatar:e,size:t="xLarge",user:i})=>e?s.a.createElement(j.a,{accessibilityLabel:i.name,link:{pathname:`/${i.screen_name}`},size:t,uri:i.profile_image_url_https}):s.a.createElement(B.a,{style:[An.avatar,j.a.getSizeStyle(t)]}),In=i("B3eJ");function On({color:e,isActive:t,size:i,...a}){const n=s.a.useContext(pn.a),[r,o]=s.a.useState(.5),[c]=n.playerState;s.a.useEffect((()=>{t&&c&&c.isPlaying&&o(Math.random())}),[t,c]);const l=t&&(null==c?void 0:c.isPlaying),d=i+2*Mn,h=[kn.container,a.style,{width:i,height:i}];return s.a.createElement(B.a,{style:h},s.a.createElement(B.a,{style:[kn.container,kn.transitionOpacity,l?kn.show:kn.hide]},K.a.reducedMotionEnabled?null:s.a.createElement(In.a,{audioLevel:r,color:e,paused:!l,size:i})),s.a.createElement(B.a,{style:[kn.border,{width:d,height:d},kn.transitionOpacity,t?kn.show:kn.hide]}))}const Mn=parseInt(S.a.theme.spaces.space2,10),kn=S.a.create((e=>({container:{alignItems:"center",justifyContent:"center",pointerEvents:"none"},border:{position:"absolute",top:-1*Mn,left:-1*Mn,backgroundColor:e.colors.navigationBackground,borderRadius:e.borderRadii.infinite},transitionOpacity:{transition:"opacity 0.2s 0s ease-in-out"},hide:{opacity:0},show:{opacity:1}})));var Pn=i("uArA"),Dn="messageEntry";const Ln={element:"cta_dm"},Fn={viewType:"message"},Bn={isGroupDM:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1};class Nn extends s.a.Component{constructor(...e){super(...e),this.state={shouldFadeHighlight:!1},this._handleClick=Object(Pn.a)((()=>{const{entry:{error:e,id:t,is_draft:i},isActive:a,setActiveEntry:n}=this.props;i||e||(n(a?null:t),this._handleScribeMessageEntryClick())})),this._handleScribeMessageEntryClick=()=>{const{isActive:e}=this.props;if(!Ke.a.isEnabled&&!e){const{entry:e}=this.props,t={component:"message",element:Object(u.c)(e),action:"click"};this._scribeAction(t)}},this._handleCtaImpression=()=>{this._scribeAction({...Ln,action:"show"})},this._handleCtaClick=()=>{this._scribeAction({...Ln,action:"click"})},this._isDMVoiceMessage=()=>{var e;return Object(u.l)(null==(e=this.props.entry.message_data)?void 0:e.attachment,this.context.featureSwitches)}}componentDidMount(){this.props.isHighlightedMessageSearchEntry&&this.setState({shouldFadeHighlight:!0})}shouldComponentUpdate(e,t){return!Object(F.a)(this.props,e)||!Object(F.a)(this.state.shouldFadeHighlight,t.shouldFadeHighlight)}render(){const{isActive:e,isGroupDM:t,isHighlightedMessageSearchEntry:i,isSent:a,user:n}=this.props,r=this._getRapidFireProps(),o=!r.isRapidFire||r.isLastRapidFire,c=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_chat_p0_enabled"),l=[Un.root.base,c&&Un.root.vdlPadding,o&&Un.root.contentSpacing,o&&c&&Un.root.vdlContentSpacing,i&&Un.root.highlightableEntry,i&&this.state.shouldFadeHighlight&&Un.root.remove],d=this._isDMVoiceMessage(),h=c?t&&!a:!a||d;if(!n)return null;const p=!Ke.a.isEnabled||a;return s.a.createElement(ae.a,{behavioralEventContext:Fn},s.a.createElement(B.a,{style:l},s.a.createElement(C.a,{accessibilityExpanded:!(!p||!e),focusable:!0,interactiveStyles:null,onPress:p?this._handleClick:void 0,style:a?Un.root.sent:Un.root.received,testID:Dn},(({isFocused:e,isHovered:t})=>this._renderMessage({isFocused:e,isHovered:t,rapidFireProps:r,withVDLRefresh:c,withUserAvatar:h}))),this._renderFooter(r,h)))}_renderMessage({isFocused:e,isHovered:t,rapidFireProps:i,withUserAvatar:a,withVDLRefresh:n}){const{displaySensitiveMedia:r,entry:o,inboxType:c,isActive:l,isDmNsfwMediaFilterEnabled:d,isGroupDM:h,isLowQuality:p,isReadOnly:u,isSent:m,isTrusted:g,isVoiceMessageActive:_,isWide:b,participants:f,perspective:v,scribeVoiceMessage:y,setShouldFreezeUpdates:E}=this.props,{isFirstRapidFire:R,isRapidFire:C}=i,w=[m?Un.messageContainer.sent:Un.messageContainer.received,b?Un.messageContainer.wide:Un.messageContainer.narrow,m&&b&&Un.messageContainer.sentWide,!m&&b&&Un.messageContainer.receivedWide],x=g&&!u,A=this._isDMVoiceMessage(),T=(null==f?void 0:f.length)||0;return s.a.createElement(B.a,{style:w},o.error?null:s.a.createElement(At,{containerIsActive:l,containerIsFocused:e,containerIsHovered:t,entry:o,featureSwitches:this.context.featureSwitches,inboxType:c,isDraft:!!o.is_draft,isGroupDM:h,isSent:m,onReportMessage:A&&y?()=>y.report({isLowQuality:p,isTrusted:g}):void 0,participantsCount:T,perspective:v,setShouldFreezeUpdates:E,shouldShowReactionButton:x,style:A&&Q(S.a.theme.scale).actionsContainer({isSent:m,isVoiceMessageActive:_}),withVDLRefresh:n}),s.a.createElement(xn,{displaySensitiveMedia:r,entry:o,isActive:l,isDmNsfwMediaFilterEnabled:d,isFirstRapidFire:R,isLowQuality:p,isRapidFire:C,isSent:m,isTrusted:g,key:o.id,onCtaClick:this._handleClick,onCtaImpression:this._handleCtaImpression,style:A&&Q(S.a.theme.scale).messageContainer({isSent:m,isVoiceMessageActive:_})}),this._possiblyRenderUserAvatar(i,a))}_renderFooter({isLastRapidFire:e,isRapidFire:t},i){var a,n;const{entry:r,isActive:o,isGroupDM:c,isSent:l,participants:d,user:h}=this.props;return h?s.a.createElement(Bi,{conversationId:r.conversation_id,entryId:r.id,entryText:null==(a=r.message_data)?void 0:a.text,entryTime:r.time,isActive:o,isDraft:!!r.is_draft,isError:!!r.error,isGroupDM:c,isLastRapidFire:e,isRapidFire:t,isSent:l,localMediaId:null==(n=r.message_data)?void 0:n.localMediaId,onPress:this._handleClick,participants:d,user:h,withUserAvatar:i}):null}_possiblyRenderUserAvatar({isLastRapidFire:e,isRapidFire:t},i){const{isSent:a,isVoiceMessageActive:n,user:r}=this.props,o=this._isDMVoiceMessage();if(!r||!i&&!n)return null;const{DMUserAvatarSizePx:c,DMUserAvatarSizeType:l}=Y(S.a.theme.scale),d={showAvatar:!!o||(!t||!!e),size:l,user:r},h=[Un.userAvatar.base,a?Un.userAvatar.sent:Un.userAvatar.received,o&&Q(S.a.theme.scale).userAvatar({isVoiceMessageActive:n,isSent:a})];return s.a.createElement(B.a,{style:Un.userAvatar.container},a?null:s.a.createElement(B.a,{style:Un.userAvatar.spacer}),o?s.a.createElement(On,{color:a?S.a.theme.colors.primary:S.a.theme.colors.text,isActive:!!n,size:c,style:h}):null,s.a.createElement(B.a,{style:h},s.a.createElement(Tn,d)))}_scribeAction(e){const{analytics:t}=this.props;t.scribe({...e})}_getRapidFireProps(){return{isFirstRapidFire:this.props.isFirstRapidFire,isLastRapidFire:this.props.isLastRapidFire,isRapidFire:this.props.isRapidFire}}}Nn.contextType=f.a,Nn.defaultProps=Bn;var jn=Object(Fe.a)(pe(function(e){function t(t){const{entry:i}=t,a=s.a.useContext(pn.a),[n]=a.activeVoiceMessage,{scribeAction:r}=a,[o]=n,c=o===i.id,l={...t,isVoiceMessageActive:c,scribeVoiceMessage:r};return s.a.createElement(e,l)}return t.defaultProps=Bn,t}(Nn)));const Un={root:S.a.create((e=>({base:{flexDirection:"column",paddingBottom:e.spaces.space2},vdlPadding:{paddingBottom:"0px"},received:{cursor:"default",alignItems:"flex-start"},sent:{cursor:"pointer",alignItems:"flex-end"},contentSpacing:{paddingBottom:e.spaces.space20},vdlContentSpacing:{paddingBottom:e.spaces.space24},highlightableEntry:{marginHorizontal:`calc(-${e.spaces.space16})`,paddingHorizontal:e.spaces.space16,transition:"background-color 3s ease-in",backgroundColor:e.colors.unreadCellBackground},remove:{backgroundColor:e.colors.cellBackground}}))),messageContainer:S.a.create((e=>({sent:{flexDirection:"row",justifyContent:"flex-end"},received:{flexDirection:"row-reverse",justifyContent:"flex-end"},narrow:{width:"100%"},wide:{width:Dt},receivedWide:{paddingRight:e.spaces.space12},sentWide:{paddingLeft:e.spaces.space12}}))),userAvatar:S.a.create((e=>({container:{flexDirection:"row",alignItems:"flex-end"},base:{position:"absolute"},sent:{right:0},received:{left:0},spacer:{width:Y(e.scale).DMUserAvatarSpacerPx}})))};var Hn=i("H4nC");const Wn=e=>{const{conversation:t,entry:i,inboxType:a,isActive:n,isFirstRapidFire:r,isHighlightedMessageSearchEntry:o,isLastRapidFire:c,isRapidFire:l,isWide:d,perspective:h,scribeNamespace:p,setActiveEntry:u,setShouldFreezeUpdates:g}=e;if(Object(m.b)(i)||Object(m.e)(i)){const{conversation_id:e,low_quality:m,participants:_,read_only:f,trusted:v,type:y}=t,{message_data:{sender_id:E}={}}=i,S=void 0===e||v;return s.a.createElement(jn,{entry:i,inboxType:a,isActive:n,isFirstRapidFire:r,isGroupDM:y===b.CONVERSATION_TYPE.GROUP,isHighlightedMessageSearchEntry:o,isLastRapidFire:c,isLowQuality:!!m,isRapidFire:l,isReadOnly:f,isSent:E===h,isTrusted:!!S,isWide:d,participants:_,perspective:h,scribeNamespace:p,senderId:E,setActiveEntry:u,setShouldFreezeUpdates:g})}return Object(m.a)(i)?s.a.createElement(q,{conversation:t,entry:i,entryType:i.type,perspective:h}):Object(m.d)(i)?s.a.createElement(Hn.a,{entry:i,isCompact:!1}):null};var Vn=i("0JOx");const zn=Object(ne.createSelector)(((e,t)=>{const i=Object(xe.o)(e,t.conversationId),a=i&&Object(_.a)(i);return a&&Object(b.selectEntry)(e,a)}),(e=>({lastEntry:e})));var qn=Object(se.c)(zn),Gn=i("uDfI");const Yn=Object(ne.createSelector)(((e,t)=>ce.e.selectMany(e,t.userIds||[])),(e=>({users:e})));var $n=Object(Gn.b)(Yn),Kn=i("Enqy"),Qn=i("+/1j");const Xn="overflow",Jn=(e,t)=>e.id_str<t.id_str?-1:e.id_str>t.id_str?1:0,Zn={stiffness:1e3,damping:70},es=140,ts={scale:Object(Kn.spring)(1,Zn),translateY:Object(Kn.spring)(0,Zn)},is=(e,t)=>({key:e.id_str,data:e,style:ts}),as=Object(c.a)({translateY:es,scale:0}),ns=Object(c.a)({scale:Object(Kn.spring)(1,Zn),translateY:Object(Kn.spring)(es,Zn)}),ss=[{key:"bubble",style:{scale:Object(Kn.spring)(1,Zn),translateY:Object(Kn.spring)(0,Zn)}}],rs=Object(c.a)({translateY:es,scale:0}),os=Object(c.a)({scale:Object(Kn.spring)(1,Zn),translateY:Object(Kn.spring)(es,Zn)}),cs=e=>[isFinite(e.scale)&&{scale:e.scale.toFixed(3)},isFinite(e.translateY)&&{translateY:`${Math.round(e.translateY)}%`}].filter(Boolean);class ls extends s.a.Component{constructor(...e){super(...e),this.state={isHidden:!0},this._afterLeave=()=>{const{users:e}=this.props;this.setState((t=>({isHidden:0===e.length})))}}componentDidUpdate(e,t){this.state.isHidden&&this.props.users&&this.props.users.length&&this.setState({isHidden:!1})}shouldComponentUpdate(e,t){return!Object(F.a)(this.props,e)||!Object(F.a)(this.state,t)}render(){const{isHidden:e}=this.state,{users:t}=this.props,i=t.sort(Jn).slice(0,5).map(is);return t.length>5&&i.push({key:Xn,style:ts}),s.a.createElement(B.a,{style:[ds.root,e&&ds.hidden]},s.a.createElement(B.a,{style:ds.avatarRow},s.a.createElement(Kn.TransitionMotion,{styles:i,willEnter:as,willLeave:ns},(e=>s.a.createElement(s.a.Fragment,null,e.map(((e,i)=>{if(e.style.scale<=.05)return null;const a=cs(e.style);return e.key===Xn?s.a.createElement(B.a,{key:e.key,style:[ds.avatar,ds.avatarSpacer,ds.overflowAvatar,{transform:a}]},s.a.createElement(Qn.a,{style:ds.overflowAvatarText},"+",t.length-5)):s.a.createElement(B.a,{key:e.key,style:[ds.avatar,{transform:a}]},s.a.createElement(j.a,{accessibilityLabel:e.data&&e.data.name,size:"xLarge",uri:e.data&&e.data.profile_image_url_https}))})))))),s.a.createElement(Kn.TransitionMotion,{didLeave:this._afterLeave,styles:t.length>0?ss:[],willEnter:rs,willLeave:os},(e=>s.a.createElement(s.a.Fragment,null,e.map((e=>s.a.createElement(B.a,{key:e.key,style:[ds.messageBubble,{transform:cs(e.style)}]},s.a.createElement(B.a,{style:ds.dot}),s.a.createElement(B.a,{style:[ds.dot,ds.dot1]}),s.a.createElement(B.a,{style:[ds.dot,ds.dot2]}))))))))}}const ds=S.a.create((e=>({root:{flexDirection:"row",paddingBottom:e.spaces.space20,paddingRight:e.spaces.space12,width:"calc(100% * 7/8)",position:"relative",transitionProperty:"height, padding-bottom",transitionDuration:"0.2s",overflow:"hidden"},hidden:{paddingBottom:0,paddingRight:0,height:0,width:0},avatarRow:{display:"inline-flex",alignItems:"flex-start",flexDirection:"row"},avatar:{marginEnd:e.spaces.space12,transformOrigin:"50% 100%"},avatarSpacer:{height:e.spaces.space40,width:e.spaces.space40},overflowAvatar:{borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.primary,alignItems:"center",justifyContent:"center"},overflowAvatarText:{color:"white"},messageBubble:{alignItems:"center",borderRadius:e.borderRadii.infinite,maxWidth:"100%",paddingVertical:e.spaces.space12,paddingHorizontal:e.spaces.space16,backgroundColor:e.colors.gray50,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200,flexDirection:"row",height:e.spaces.space40,overflow:"hidden",transformOrigin:"0% 100%"},dot:{display:"flex-inline",position:"relative",width:e.spaces.space12,height:e.spaces.space12,overflow:"hidden",borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.gray700,marginEnd:e.spaces.space4,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationKeyframes:[{"15%":{transform:[{scale:1.4}],backgroundColor:e.colors.primary},"30%":{transform:[{scale:1}]}}]},dot1:{animationDelay:"0.1s"},dot2:{animationDelay:"0.2s"}})));var hs=$n(ls),ps=i("tn7R");class us extends s.a.PureComponent{constructor(...e){super(...e),this._timers={},this.state={forceHide:!1,userIds:[]},this._handleLivePipelineUpdate=e=>{const{user_id:t}=e.dm_typing;t!==this.context.loggedInUserId&&(this._timers[t]&&clearTimeout(this._timers[t]),this._timers[t]=setTimeout((()=>this._removeAvatar(t)),4e3),this.setState((e=>({forceHide:!1,userIds:[...e.userIds.filter((e=>e!==t)),t]}))))},this._removeAvatar=(e,t=!1)=>{this.setState((i=>{const a=i.userIds.filter((t=>t!==e));return{forceHide:t&&0===a.length,userIds:a}}))}}componentDidMount(){this._initializeLivePipeline()}componentDidUpdate(e,t){if(this.props.lastEntry){const{lastEntry:t={}}=e||{},{lastEntry:i}=this.props;t&&t.id!==i.id&&i.message_data&&this._removeAvatar(i.message_data.sender_id,!0)}e.conversationId!==this.props.conversationId&&(this._teardownLivePipeline(),this._initializeLivePipeline())}componentWillUnmount(){this._teardownLivePipeline()}render(){const{forceHide:e,userIds:t}=this.state;return!e&&s.a.createElement(hs,{userIds:t})}_teardownLivePipeline(){Object(ps.a)(this._timers).forEach((e=>clearTimeout(e))),this._livePipelineSubscription&&this._livePipelineSubscription.teardown()}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(Vn.h)().then((({LivePipeline:t})=>{t.isSupportedAndReady(this.context.featureSwitches)&&this.context.featureSwitches.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic(`/dm_typing/${e}`,this._handleLivePipelineUpdate))}))}}us.contextType=f.a;var ms=qn(us),gs=i("3AAD"),_s=i("iBK2"),bs=i("Fz18"),fs=i("RJrc"),vs=i("yw4N"),ys=i("dPJJ"),Es=i("zrc3"),Ss=i("pQ3Z"),Rs=i.n(Ss),Cs=i("VY6S"),ws=i("c/W/");class xs{constructor(e){this._trackScroll=()=>{this._programmaticScroll?this._programmaticScroll=!1:this._lastScrollTs=Date.now()},this._normalize=()=>{this._wrapperNode&&0!==this._transform&&this._viewport&&(this._wrapperNode.style.transform="",this._viewport.scrollBy(-1*this._transform),this._transform=0)},this._normalizeIfNeeded=()=>{if(!this._wrapperNode||!this._viewport||0===this._transform)return;const e=this._viewport,{height:t,top:i}=this._wrapperNode.getBoundingClientRect(),a=new ws.a(i,t),n=a.translateBy(-1*this._transform),s=e.getRect();s.contains(n.getTop())||s.contains(n.getBottom())||s.contains(a.getTop())||s.contains(a.getBottom())?this._normalize():this._debouncedNormalize()},this._transform=0,this._viewport=e,this._lastScrollTs=0,this._debouncedNormalize=Object(Cs.a)(this._normalize,500),this._removeScrollListener=e.addScrollListener(this._normalizeIfNeeded),this._removeScrollTracker=e.addScrollListener(this._trackScroll)}setWrapperNode(e){this._wrapperNode=e}teardown(){this._removeScrollListener(),this._removeScrollTracker(),delete this._viewport}offsetBy(e){if(Math.abs(e)<=.5)return;const t=this._wrapperNode,i=Date.now()-this._lastScrollTs;!t||i>=500?(this._programmaticScroll=!0,this._viewport&&this._viewport.scrollBy(e)):(this._transform=this._transform-e,t.style.transform=`translateY(${this._transform}px)`,this._normalizeIfNeeded())}}class As extends s.a.Component{constructor(e,t){super(e,t),this._updatesSuspended=!1,this._handleHeightsUpdate=(e,t)=>{const{anchoring:i}=this.props;this._scrollBy(i.offsetCorrection(e,t))},this._receiveWrapperNode=e=>this._offsetHandler.setWrapperNode(e),this._handleRefUpdate=e=>{this._ref=e},this._handleEnterFullscreen=()=>{this._updatesSuspended=!0,this._ref&&this._ref.freezeUpdates()},this._handleExitFullscreen=()=>{this._updatesSuspended=!1,this.forceUpdate(),this._ref&&this._ref.resumeUpdates()};const i=this._findInitialAnchor(e.initialAnchors||[]);this._initialItemIndex=i?i.anchorIndex:0,this._initialAnchor=i&&i.anchor,this._offsetHandler=new xs(e.viewport)}UNSAFE_componentWillMount(){const{anchoring:e,viewport:t}=this.props;this.setState({scrollHeadroom:e.initialScrollHeadroom(t)})}shouldComponentUpdate(e,t){const i=!Rs()(this.props,e)||!Rs()(this.state,t);return!this._updatesSuspended&&i}componentDidMount(){this._initialAnchor&&this._scrollToAnchor(this._initialAnchor),this._requestAnimationFrame((()=>{const{list:e,onPositionRestored:t,retryPositionRestoration:i}=this.props;if(i&&this._initialAnchor){!!e.find((({id:e})=>this._initialAnchor&&e===this._initialAnchor.id))&&this._initialAnchor&&this._scrollToAnchor(this._initialAnchor)}t(),this._requestAnimationFrame((()=>{this._relaxScrollHeadroom()}))})),this._unlistenFullscreenEnter=ys.a(this._handleEnterFullscreen),this._unlistenFullscreenExit=ys.b(this._handleExitFullscreen)}getAnchors(e){const t=e||this._ref&&this._ref.getPositioning();return t?this.props.anchoring.anchorCandidates(t):[]}getPositioning(){return this._ref&&this._ref.getPositioning()}componentWillUnmount(){this._unmounted=!0,this._offsetHandler.teardown(),this._unlistenFullscreenEnter&&this._unlistenFullscreenEnter(),this._unlistenFullscreenExit&&this._unlistenFullscreenExit()}render(){const{list:e,renderItem:t,renderList:i}=this.props,{scrollHeadroom:a}=this.state;return s.a.createElement("div",{ref:this._receiveWrapperNode,style:{paddingBottom:a}},i({initialItemIndex:this._initialItemIndex,list:e,renderItem:t,ref:this._handleRefUpdate,onHeightsUpdate:this._handleHeightsUpdate}))}_scrollToAnchor(e){const{anchoring:t}=this.props,i=this._ref&&this._ref.getPositioning();i&&this._scrollBy(t.offsetToAnchor(i,e))}_findInitialAnchor(e){const{list:t}=this.props;return e.map((e=>{const i=Object(Es.a)(t,(({id:t})=>t===e.id));return i>=0?{anchorIndex:i,anchor:e}:null})).find((e=>e))}_relaxScrollHeadroom(){const e=this._ref&&this._ref.getPositioning();if(e){const{anchoring:t}=this.props,i=t.scrollHeadroom(e),{scrollHeadroom:a}=this.state;i<a&&this.setState({scrollHeadroom:i})}}_scrollBy(e){this._offsetHandler.offsetBy(e)}_requestAnimationFrame(e){return window.requestAnimationFrame((()=>{this._unmounted||e()}))}}As.defaultProps={anchoring:gs.a};var Ts=i("AOWc"),Is=i("180P"),Os=i("Ey+e"),Ms=i("SrIh"),ks=i("E6XO"),Ps=i("06eB"),Ds=i.n(Ps),Ls=i("aITJ");const Fs=()=>window.performance?window.performance.now():Date.now();class Bs extends s.a.Component{constructor(e,t){super(e,t),this._perfReported=!1,this._observeElement=e=>{const t=this._resizeObserver;t&&(t.disconnect(),t.observe(e))},this._handleResize=e=>{const{id:t,onHeightChanged:i}=this.props,[a]=e;this._isResizeObserverHeightUpdatesEnabled&&a&&a.contentRect.height!==this._currentHeight&&(this._currentHeight=a.contentRect.height,i(t,a.contentRect.height)),this._perfReported||(this.props.onVisible(t,Fs()-this._perfStart),this._perfReported=!0)},this._setRef=e=>{const{id:t,setAPI:i}=this.props;e?(this._element=e,i(t,this),this._observeElement(e)):(i(t,void 0),this._element=void 0)},this._isResizeObserverHeightUpdatesEnabled=this.context.featureSwitches.isTrue("responsive_web_vs_config_resize_observer_enabled")&&Ls.b.isDesktopOS()&&Ls.b.isSafari(),this._resizeObserver=new window.ResizeObserver(this._handleResize),this._perfStart=Fs()}shouldComponentUpdate(e){const{data:t,render:i}=this.props;return i!==e.render||!Ds()(t,e.data)}componentWillUnmount(){this._resizeObserver&&this._resizeObserver.disconnect()}componentDidUpdate(e){const{id:t,setAPI:i}=this.props;e.id!==t&&(i(e.id,void 0),i(t,this))}measureHeight(){return this._currentHeight=this._element?this._element.getBoundingClientRect().height:0,this._currentHeight}render(){const{data:e,render:t}=this.props;return s.a.createElement("div",{ref:this._setRef},t(e))}}Bs.contextType=f.a;var Ns=i("+d3d"),js=i("iChn");class Us extends s.a.PureComponent{constructor(...e){super(...e),this._cells=new Map,this._heightUpdates={},this._visibilityMeasurements=new Map,this._handleItemVisible=(e,t)=>{this._visibilityMeasurements.has(e)||this._visibilityMeasurements.set(e,t)},this._reportVisibilityMeasurements=()=>{if(!this._visibilityMeasurements.size)return;let e=0;this._visibilityMeasurements.forEach((t=>e+=t));const t=Math.round(e/this._visibilityMeasurements.size),i=Ls.b.isDesktopOS()?"scroller_legacy":"scroller_legacy_mobile";ks.c(`scroller:ttfv:${i}`,{duration_ms:t}),this._visibilityMeasurements.clear()},this._handleCellHeightChanged=(e,t)=>{this._heightUpdates[e]=t,this._flushHeightUpdates()},this._flushHeightUpdates=Object(Ns.a)((()=>{const{onHeightsChange:e}=this.props;e(this._heightUpdates),this._heightUpdates={}}),100,{trailing:!0}),this._setCellRef=(e,t)=>{t?this._cells.set(e,t):this._cells.delete(e)},this._handleDivRefUpdate=e=>{this._div=e}}getWrapperNode(){return this._div}getItemHeights(){const{list:e}=this.props;return Object(js.a)(e,(e=>e.id),(e=>{const t=this._cells.get(e.id);return t?t.measureHeight():0}))}componentWillUnmount(){this._reportVisibilityMeasurements()}render(){const{blankSpaceAbove:e,blankSpaceBelow:t}=this.props;return s.a.createElement("div",{ref:this._handleDivRefUpdate,style:{paddingTop:e,paddingBottom:t}},this._renderContent())}_renderContent(){const{list:e,renderItem:t}=this.props;return e.map((({data:e,id:i})=>s.a.createElement(Bs,{data:e,id:i,key:i,onHeightChanged:this._handleCellHeightChanged,onVisible:this._handleItemVisible,render:t,setAPI:this._setCellRef})))}}var Hs=i("oi7R"),Ws=i("aWzz"),Vs=i("JD1h"),zs=i("OeMK"),qs=i("0zXz"),Gs=i("jHwr"),Ys=i("qdp+");class $s{constructor({list:e,rectangles:t,sliceEnd:i,sliceStart:a,viewportRectangle:n}){this._viewportRectangle=n,this._list=e,this._rectangles=t,this._sliceStart=a,this._sliceEnd=i}getForViewport(){return this._viewportRectangle}getForList(){const e=this._list;if(0===e.length)return new ws.a(0,0);{const t=this._rectangles,i=e[0].id,a=e[e.length-1].id,n=t[i].getTop(),s=t[a].getBottom()-n;return new ws.a(n,s)}}getForAllItems(){return this._list.map((({id:e})=>({id:e,rectangle:this._rectangles[e]})))}getList(){return this._list}getListLength(){return this._list.length}getForItem(e){return this._rectangles[e]}findVisibleItems(){const e=this._viewportRectangle,t=this._rectangles,i=Object(Es.a)(this._list,(({id:i})=>t[i].doesIntersectWith(e)));if(i<0)return[];let a=Object(Es.a)(this._list,(({id:i})=>!t[i].doesIntersectWith(e)),i);return-1===a&&(a=this._list.length),this._list.slice(i,a).filter((({id:e})=>this.isRendered(e))).map((({id:e})=>({id:e,rectangle:t[e]})))}getRenderedItems(){const e=this._rectangles;return this._list.slice(this._sliceStart,this._sliceEnd).map((({id:t})=>({id:t,rectangle:e[t]})))}findTopmostVisibleId(){return Object(Ys.a)(this.getRenderedItems(),(e=>e.rectangle.getTop()>=this._viewportRectangle.getTop()?e.id:void 0))}isRendered(e){return this._getRenderedIdSet().hasOwnProperty(e)}_getRenderedIdSet(){if(!this._renderedIdSet){const e={};for(let t=this._sliceStart;t<this._sliceEnd;t++)e[this._list[t].id]=!0;this._renderedIdSet=e}return this._renderedIdSet}}var Ks=i("64vW");const Qs=(e,t,i)=>{if(t<0||t>=e.length)return-1;if(i(e[t]))return t;for(let a=1;;a++){const n=t-a,s=t+a,r=n<0,o=s>=e.length;if(r&&o)break;if(!o&&i(e[s]))return s;if(!r&&i(e[n]))return n}return-1};var Xs=({list:e,nextList:t,sliceEnd:i,sliceStart:a})=>{const n=t.reduce(((e,{id:t})=>(e[t]=!0,e)),{}),s=Qs(e,a,(({id:e})=>!Object(zs.a)(e)&&n.hasOwnProperty(e)&&n[e]));if(-1===s)return null;let r=Object(Es.a)(t,(({id:t})=>e[s].id===t));Object(Ts.a)(r>=0,"newSliceStart should be defined if we found a common item");return s>0&&Object(zs.a)(e[s-1].id)&&r>0&&Object(zs.a)(t[r-1].id)&&(r-=1),{sliceStart:r,sliceEnd:Math.min(t.length,r+i-a)}};const Js={heightsReady:!0};class Zs extends s.a.PureComponent{constructor(e,t){super(e,t),this._updatesSuspended=!1,this.freezeUpdates=()=>{this._updatesSuspended=!0},this.resumeUpdates=()=>{this._updatesSuspended=!1,this._scheduleUpdate()},this._handleHeightsChange=e=>{this._postRenderProcessing({hasListChanged:!1,newHeights:e})},this._handleRefUpdate=e=>{this._ref=e},this._setNecessarySlice=(e,t)=>{const{sliceEnd:i,sliceStart:a}=this.state,n={start:a,end:i},s={start:e,end:t},{end:r,start:o}=((e,t)=>{if(t.start>=e.start&&t.end<=e.end)return e;if(t.start>=e.end||t.end<=e.start)return t;{const i=Math.max(e.start-t.start,t.end-e.end);return{start:Math.min(e.start+i,t.start),end:Math.max(e.end-i,t.end)}}})(n,s);this._setSlice(o,r)},this._setSlice=(e,t)=>{if(this._updatesSuspended)return;const{sliceEnd:i,sliceStart:a}=this.state;e===a&&t===i||this.setState({sliceStart:e,sliceEnd:t})};const{initialItemIndex:i,list:a}=this.props;this._assumedItemHeight=e.assumedItemHeight,this._getSlice=()=>{const{list:e}=this.props,{sliceEnd:t,sliceStart:i}=this.state;return this._getMemoizedSlice(e,i,t)},this._getMemoizedSlice=Object(G.a)(((e,t,i)=>e.slice(t,i))),this._getRectangles=e=>{const t=e||this,{_assumedItemHeight:i,_heights:a}=t,{list:n}=t.props;return t._getMemoizedRectangles(n,a,i)},this._getMemoizedRectangles=Object(G.a)(((e,t,i)=>er(e,t,i))),this._heights={};const{cacheKey:n,heightCache:s}=this.props;n&&s.hasOwnProperty(n)&&(this._heights=s[n]),this.state=this._getDefaultSlice(a,i);const r=Object(Gs.a)((()=>this._criticalUpdate()),window.requestAnimationFrame);this._scheduleUpdate=window.requestIdleCallback?Object(Gs.a)((()=>this._criticalUpdate()),window.requestIdleCallback):r,this._schedulePositioningNotification=Object(Gs.a)((()=>this._notifyPositioning()),window.requestIdleCallback?e=>window.requestIdleCallback(e,{timeout:500}):window.requestAnimationFrame),this._handleScroll=Object(Ns.a)(r,100,{trailing:!0}),this._scheduleDebouncedUpdate=Object(Cs.a)((()=>{window.requestAnimationFrame((()=>{this._debouncedUpdate()}))}),500),this._removeDebouncedListener=e.viewport.addScrollListener(this._scheduleDebouncedUpdate)}componentDidMount(){this._unlistenScroll=this.props.viewport.addScrollListener(this._handleScroll),this._postRenderProcessing({hasListChanged:!0})}componentWillUnmount(){this._unmounted=!0,this._unlistenScroll&&this._unlistenScroll(),this._removeDebouncedListener();const{cacheKey:e,heightCache:t}=this.props;e&&(t[e]=this._heights)}componentDidUpdate(e){this._postRenderProcessing({hasListChanged:e.list!==this.props.list})}UNSAFE_componentWillReceiveProps(e){const{list:t}=this.props,{sliceEnd:i,sliceStart:a}=this.state,n=e.list;if(n!==t){const e=Xs({list:t,nextList:n,sliceStart:a,sliceEnd:i})||this._getDefaultSlice(n);this._setSlice(e.sliceStart,e.sliceEnd)}}UNSAFE_componentWillUpdate(){this._prevPositioning=this.getPositioning()}getPositioning(){const{sliceEnd:e,sliceStart:t}=this.state;return new $s({viewportRectangle:this._getRelativeViewportRect(),list:this.props.list,rectangles:this._getRectangles(),sliceStart:t,sliceEnd:e})}render(){const{renderItem:e,renderList:t}=this.props,{blankSpaceAbove:i,blankSpaceBelow:a}=this._computeBlankSpace();return s.a.createElement(Ks.a.Provider,{value:Js},t({ref:this._handleRefUpdate,list:this._getSlice(),blankSpaceAbove:i,blankSpaceBelow:a,renderItem:e,onHeightsChange:this._handleHeightsChange}))}_computeBlankSpace(){const{list:e}=this.props,{sliceEnd:t,sliceStart:i}=this.state,a=this._getRectangles(),n=0===e.length?0:a[e[i].id].getTop()-a[e[0].id].getTop(),s=Object(_.a)(e);return{blankSpaceAbove:n,blankSpaceBelow:t>=e.length||!s?0:a[s.id].getBottom()-a[e[t].id].getTop()}}_postRenderProcessing({hasListChanged:e,newHeights:t}){const{wasHeightChange:i}=this._recordHeights(t);if(i||e){const e=this._prevPositioning;if(e){const{onHeightsUpdate:t}=this.props;t(e,this.getPositioning())}}const{minimumOffscreenToViewportRatio:a,preferredOffscreenToViewportRatio:n}=this.props;e||!this._sliceIncludesScaledViewport(a)?this._scheduleUpdate():this._sliceIncludesScaledViewport(n)||this._scheduleDebouncedUpdate(),this._schedulePositioningNotification()}_sliceIncludesScaledViewport(e){const{sliceEnd:t,sliceStart:i}=this._computeSlice({offscreenToViewportRatio:e});return i>=this.state.sliceStart&&t<=this.state.sliceEnd}_recordHeights(e){if(!this._ref)return{heightDelta:0,wasHeightChange:!1};const t=e||this._ref.getItemHeights();let i=!1;const a=Object.keys(t).reduce(((e,a)=>{const n=this._heights.hasOwnProperty(a)?this._heights[a]:this._assumedItemHeight,s=t[a];return i=i||n!==s,e+(s-n)}),0);return i&&(this._heights=Object.assign({...this._heights},t)),{wasHeightChange:i,heightDelta:a}}_criticalUpdate(){const{sliceEnd:e,sliceStart:t}=this._computeSlice({offscreenToViewportRatio:this.props.minimumOffscreenToViewportRatio});"number"==typeof t&&"number"==typeof e&&this._setNecessarySlice(t,e)}_debouncedUpdate(){const{sliceEnd:e,sliceStart:t}=this._computeSlice({offscreenToViewportRatio:this.props.preferredOffscreenToViewportRatio});"number"==typeof t&&"number"==typeof e&&this._setSlice(t,e)}_computeSlice({offscreenToViewportRatio:e}){const{list:t}=this.props;if(this._unmounted||0===t.length)return{};const i=this._getRelativeViewportRect(),a=i.getHeight()*e,n=i.getTop()-a,s=i.getBottom()+a,r=this._getRectangles(),o=Object(Es.a)(t,(({id:e})=>r[e].getBottom()>n)),c=o>=0?o:t.length-1,l=Object(Es.a)(t,(({id:e})=>r[e].getTop()>=s),c),d=l>=0?l:t.length;return this._schedulePositioningNotification(),{sliceStart:c,sliceEnd:d}}_notifyPositioning(){if(!this._unmounted){const{onPositioningUpdate:e}=this.props;e(this.getPositioning())}}_getRelativeViewportRect(){if(!this._ref)return new ws.a(0,0);const e=this._ref.getWrapperNode();if(!e)return new ws.a(0,0);const t=Math.ceil(e.getBoundingClientRect().top);return this.props.viewport.getRect().translateBy(-t)}_getDefaultSlice(e,t=0){const{viewport:i}=this.props,a=i.getRect().getHeight(),n={...this,props:{...this.props,list:e},state:{...this.state},context:{...this.context},refs:null},s=this._getRectangles(n),{id:r}=e[t],o=s[r].getBottom(),c=Object(Es.a)(e,(({id:e})=>s[e].getTop()-o>=a),t),l=c>=0?c:e.length;return{sliceStart:t,sliceEnd:Math.min(e.length,l)}}}Zs.defaultProps={assumedItemHeight:400,heightCache:{},initialItemIndex:0,minimumOffscreenToViewportRatio:.5,preferredOffscreenToViewportRatio:2.5};const er=(e,t,i)=>{const a={};return e.reduce(((e,{id:n})=>{const s=t.hasOwnProperty(n)?t[n]:i,r=new ws.a(e,s);return a[n]=r,r.getBottom()}),0),a};var tr=Zs;const ir=e=>(Object(Ms.a)(`Fallback to slow hashing in VirtualScroller (type = ${e?e.type:""})`),Object(Is.a)(e));class ar extends s.a.Component{constructor(e,t){super(e,t),this._onDemandRenderer=e=>{const{assumedItemHeight:t,minimumOffscreenToViewportRatio:i,preferredOffscreenToViewportRatio:a}=this.props,n="function"==typeof t?t(""):t;return s.a.createElement(tr,Mt()({},e,{assumedItemHeight:n,cacheKey:this.props.cacheKey,minimumOffscreenToViewportRatio:i,onPositioningUpdate:this._handlePositioningUpdate,preferredOffscreenToViewportRatio:a,renderList:this._viewRenderer,viewport:this._viewport}))},this._viewRenderer=e=>s.a.createElement(Us,e),this._getItemRenderer=()=>this._getMemoizedItemRenderer(this.props.renderer),this._getMemoizedItemRenderer=Object(G.a)((e=>t=>t?t.presentational?t.renderNode():e(t.data):null)),this._handleAnchorRendererRefUpdate=e=>{this._anchorRenderer=e},this._handlePositionRestored=()=>{const{onPositionRestored:e}=this.props;e(),this._edgeProximity=this._createEdgeProximity();const t=this._anchorRenderer&&this._anchorRenderer.getPositioning();t&&this._edgeProximity.handlePositioningUpdate(t)},this._handlePositioningUpdate=e=>{this._edgeProximity&&this._edgeProximity.handlePositioningUpdate(e);const{onItemsRendered:t}=this.props;t&&t({positions:e.getRenderedItems(),viewport:e.getForViewport()})},this._getList=()=>{const{footer:e,header:t,identityFunction:i,items:a}=this.props;return this._getMemoizedList(i,a,t,e)},this._getMemoizedList=Object(G.a)(((e,t,i,a)=>{const n={},s=t.reduce(((t,i)=>{const a=e(i)||i.id||ir(i);return Object(Ts.a)("number"==typeof a||"string"==typeof a,"Item id must not be falsy"),n.hasOwnProperty(a)?Object(Ms.a)("Duplicate item id generated in VirtualScroller. Latter item will be discarded",{extra:{id:a}}):(t.push({data:{data:i},id:a}),n[a]=!0),t}),[]),r=i?{id:zs.c,data:{presentational:!0,renderNode:()=>i}}:null,o=a?{id:zs.b,data:{presentational:!0,renderNode:()=>a}}:null;return s.length?[...r?[r]:[],...s,...o?[o]:[]]:[]})),this._viewport=e.viewport||t.viewport||Hs.a.root()}scrollToNewest(e){this._viewport.scrollToTop()}isAtNewest(){const e=this._anchorRenderer&&this._anchorRenderer.getPositioning();return(e&&e.getForViewport().getTop()||0)<50}adjustFocusBy(e){}UNSAFE_componentWillMount(){this._isManualScrollRestoration=window.history&&"manual"===window.history.scrollRestoration,this._loadStoredPosition(this.props)}UNSAFE_componentWillReceiveProps(e){const{cacheKey:t}=this.props;t!==e.cacheKey&&(this._preservePosition(this._customLocation),this._loadStoredPosition(e))}componentWillUnmount(){this._preservePosition(this._customLocation)}render(){const{anchoring:e,cacheKey:t,items:i,noItemsRenderer:a}=this.props;return i.length?s.a.createElement(As,{anchoring:e,initialAnchors:this._initialAnchors||[],key:t,list:this._getList(),onPositionRestored:this._handlePositionRestored,ref:this._handleAnchorRendererRefUpdate,renderItem:this._getItemRenderer(),renderList:this._onDemandRenderer,retryPositionRestoration:!this._isManualScrollRestoration,viewport:this._viewport}):a()}_preservePosition(e){if(this._anchorRenderer&&e){const t=this._anchorRenderer.getAnchors();e.savePosition(t)}}_createEdgeProximity(){const{nearEndProximityRatio:e,nearStartProximityRatio:t}=this.props;return new Vs.b([{condition:Vs.a.nearTop(5),callback:e=>this.props.onAtStart(e)},{condition:Vs.a.nearTopRatio(t),callback:e=>this.props.onNearStart(e)},{condition:Vs.a.nearBottomRatio(e),callback:e=>this.props.onNearEnd(e)},{condition:Vs.a.nearBottom(5),callback:e=>this.props.onAtEnd(e)}])}_loadStoredPosition(e){const{getCustomLocation:t}=this.context,{initialAnchor:i}=e;if(this._customLocation=t&&t(),this._initialAnchors=i?[i]:[],this._customLocation){const e=this._customLocation.getSavedPosition();e&&e.length?this._initialAnchors=e:this._initialAnchors=i?[i]:[],this._initialAnchors.length>0&&this._customLocation&&this._customLocation.claimScrollRestoration()}}}ar.displayName="VirtualScroller",ar.contextTypes={viewport:Ws.object,getCustomLocation:Ws.func},ar.defaultProps={anchoring:As.defaultProps.anchoring,assumedItemHeight:tr.defaultProps.assumedItemHeight,identityFunction:ir,minimumOffscreenToViewportRatio:tr.defaultProps.minimumOffscreenToViewportRatio,nearEndProximityRatio:1.75,nearStartProximityRatio:.25,noItemsRenderer:qs.a,onPositionRestored:Hi.a,onAtEnd:Hi.a,onAtStart:Hi.a,onNearEnd:Hi.a,onNearStart:Hi.a,onScrollEnd:Hi.a,preferredOffscreenToViewportRatio:tr.defaultProps.preferredOffscreenToViewportRatio,withKeyboardShortcuts:!1};var nr=Object(Os.a)(ar),sr=i("mw9i");const rr=Ee.a.i859a9d3,or=Ee.a.i8ecae5b,cr=e=>e.entry.id,lr=e=>e.entry.type===L.b.MESSAGE;class dr extends s.a.Component{constructor(e,t){super(e,t),this._shouldUseNewScroller=this.context.featureSwitches.isTrue("responsive_web_dm_new_scroller_enabled")||this.context.featureSwitches.isTrue("dm_inbox_search_message_results_enabled")&&this.context.featureSwitches.isTrue("direct_messages_incremental_holdback_2022h1"),this._handleScrollEnd=()=>{this.setState({didRenderMessageSearchEntry:!0})},this._renderItem=e=>{const{conversation:t}=this.props,i=t.conversation_id;switch(e.type){case L.b.TYPING_INDICATOR:return i?s.a.createElement(ms,{conversationId:i}):null;case L.b.READ_ONLY_INDICATOR:return i?s.a.createElement(B.a,{style:hr.readOnly},s.a.createElement(N.b,{align:"center",color:"gray700",size:"subtext2"},or,"",s.a.createElement(N.b,{link:"https://support.twitter.com/articles/14606#faq"},rr))):null;case L.b.CONVERSATION_PROFILE_INFO_HEADER:return s.a.createElement(O,{conversation:t});default:return this._renderDMEntry(e)}},this._setActiveEntry=e=>{this.setState({activeEntryId:e})},this._setShouldFreezeUpdates=e=>{this.setState({shouldFreezeUpdates:e})},this._anchoring=h({isOwnMessage:e=>{var t,i;return(null==(t=e.entry)||null==(i=t.message_data)?void 0:i.sender_id)===this.props.perspective||!1},typingIndicatorId:p.a}),this.state={activeEntryId:null,didRenderMessageSearchEntry:!1,shouldFreezeUpdates:!1}}shouldComponentUpdate(e,t){return!1===t.shouldFreezeUpdates}render(){const{conversation:e,drawerHeader:t,isWide:i,messageSearchEntryId:n,onForwardRequest:r,onHistoryRequest:o,shouldScrollToCenter:c,style:l}=this.props,{activeEntryId:d}=this.state,h=(({activeEntryId:e,canInjectConversationProfileInfoHeader:t,conversation:i,footer:a,messageSearchEntryId:n,readOnlyEntry:s})=>{const r=i&&i.entries||[],o=null==i?void 0:i.max_search_entry_id,c=null==i?void 0:i.min_search_entry_id,l=(null==i?void 0:i.status)===b.PAGINATION_STATUS.AT_END,d=o?Object(u.d)(r,o):r.length-1,h=c?Object(u.d)(r,c):-1,m=n&&-1===h?Object(u.d)(r,n):h,f=r.slice(l?0:m,d+1),v=(n?f:r).reduce(((a,s,o)=>{t&&0===o&&a.push(p.b);const c=Object(_.a)(a),l=o===r.length-1;if(a.push({isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,entry:s,isActive:n===s.id||e===s.id,isTrusted:!(null==i||!i.trusted),messageSearchEntryId:n}),c){const e=g(c.entry,s),t=a[a.length-2];e?(a[a.length-1].isRapidFire=!0,t.isRapidFire||(t.isFirstRapidFire=!0,t.isRapidFire=!0),l&&(a[a.length-1].isLastRapidFire=!0)):t.isRapidFire&&(t.isLastRapidFire=!0)}return a}),[]);return a&&!n&&v.push(a),i.read_only&&s&&!n&&v.push(s),v})({conversation:e,footer:p.d,readOnlyEntry:p.c,canInjectConversationProfileInfoHeader:e.status===L.c.AT_END&&e.type===L.a.ONE_TO_ONE,activeEntryId:d,messageSearchEntryId:n}),m=e.conversation_id,f=e=>e[e.length-1],v=e=>{for(let t=e.length-1;t>=0;t--){const i=e[t];if(i&&lr(i))return i}return f(e)},y=n?`dm-activity-${m}-${n}`:`dm-activity-${m}`,E=this.state.didRenderMessageSearchEntry&&(null==e?void 0:e.min_search_entry_id)&&e.status!==L.c.AT_END;return s.a.createElement(M.a.Consumer,null,(({isDrawer:d})=>{const p=d?k.b.drawerHeaderRadius:hr.scrollSpace;return s.a.createElement(B.a,{style:[hr.scrollContainer,p]},s.a.createElement(vs.a,{style:[hr.scrollContainer,i&&hr.conversationsPadding,p,l]},t||null,e.status&&e.status!==L.c.AT_END&&!n||E?s.a.createElement(fs.a,null):null,s.a.createElement(sr.a,{style:[hr.content,hr.alignTop],withGutter:!0},this._shouldUseNewScroller?s.a.createElement(_s.b,{anchoring:gs.a,assumedItemHeight:50,cacheKey:y,canBeAnchorFunction:lr,centerInitialAnchor:n&&c,hasNewContentAtBottom:!0,identityFunction:cr,initialAnchor:h.length>0?a.a(n&&c?n:cr(v(h))):void 0,items:h,nearStartProximityRatio:2,onAtEnd:n&&this.state.didRenderMessageSearchEntry?r:void 0,onAtStart:n&&this.state.didRenderMessageSearchEntry?o:void 0,onNearStart:n?void 0:o,onScrollEnd:n&&!this.state.didRenderMessageSearchEntry?this._handleScrollEnd:void 0,renderer:this._renderItem,withoutHeadroom:!1}):s.a.createElement(bs.a,{identifier:y},s.a.createElement(nr,{anchoring:this._anchoring,assumedItemHeight:50,cacheKey:y,centerInitialAnchor:!1,hasNewContentAtBottom:!1,identityFunction:cr,initialAnchor:h.length>0?a.a(cr(f(h))):void 0,items:h,nearStartProximityRatio:2,onNearStart:o,renderer:this._renderItem,withoutHeadroom:!0}))),this.state.didRenderMessageSearchEntry&&n&&e.max_search_entry_id&&e.search_status!==L.c.AT_END?s.a.createElement(fs.a,null):null))}))}_renderDMEntry({entry:e,isActive:t,isFirstRapidFire:i,isLastRapidFire:a,isRapidFire:n}){const{conversation:r,inboxType:o,isWide:c,messageSearchEntryId:l,perspective:d,scribeNamespace:h}=this.props,p=e.id===l;return e&&o?s.a.createElement(Wn,{conversation:r,entry:e,inboxType:o,isActive:t,isFirstRapidFire:i,isHighlightedMessageSearchEntry:p,isLastRapidFire:a,isRapidFire:n,isWide:c,key:e.id,perspective:d,scribeNamespace:h,setActiveEntry:this._setActiveEntry,setShouldFreezeUpdates:this._setShouldFreezeUpdates}):null}}dr.contextType=f.a;const hr=S.a.create((e=>({spinner:{alignItems:"center",marginVertical:"30px"},scrollContainer:{backgroundColor:e.colors.cellBackground,flexGrow:1,height:"100%",overflowX:"hidden",WebkitOverflowScrolling:"touch"},scrollSpace:{paddingTop:e.componentDimensions.appBarHeightPx,marginTop:-e.componentDimensions.appBarHeightPx},conversationsPadding:{paddingTop:e.spaces.space20},content:{flexGrow:1,transform:[{translate3d:"0,0,0"}]},alignTop:{justifyContent:"flex-start"},readOnly:{paddingBottom:e.spaces.space20}})))},"4n2h":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return n}));const a=e=>e?"medium":"normal",n=(e,t)=>e||t?"text":"gray700"},"64vW":function(e,t,i){"use strict";var a=i("ERkP");const n=i.n(a).a.createContext({heightsReady:!0});t.a=n},"883S":function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"c",(function(){return E})),i.d(t,"b",(function(){return S}));var a=i("k49u"),n=i("3XMw"),s=i.n(n),r=i("fs1G");const o=s.a.c3752568,c=s.a.f78aa3e9,l=s.a.f9690dc0,d=s.a.i859a9d3,h=s.a.b1d35407,p=s.a.g539cca6,u=s.a.bbac0019,m=s.a.a1d2a68d,g=s.a.d4f2d9d8,_=s.a.hf383be4,b=s.a.b25c5b2a,f=s.a.c4fdbd16,v=s.a.hf3e7e38,y={[a.a.DirectMessageConversationNotFound]:{customAction:()=>!1}},E={defaultToast:{text:c},showToast:!0},S={defaultToast:{text:o},[a.a.CurrentUserSuspended]:{toast:{text:p,action:{label:d,link:"https://support.twitter.com/articles/15790"}}},[a.a.DirectMessageCannotDmOtherUser]:{toast:{text:l}},[a.a.DirectMessageDuplicate]:{toast:{text:b}},[a.a.DirectMessageOtherUserNotFollowing]:{toast:{text:m,action:{label:d,link:"https://support.twitter.com/articles/14606"}}},[a.a.DirectMessagesSenderBlocksRecipient]:{toast:{text:f}},[a.a.DirectMessageTooLongError]:{toast:{text:u}},[a.a.DirectMessageTweetNotFound]:{toast:{text:g}},[a.a.GenericBadRequest]:{customAction:r.a},[a.a.MessageSendError]:{toast:{text:v}},[a.a.OverStatusUpdateLimit]:{toast:{action:{label:d,link:"https://support.twitter.com/articles/15364"},text:h}},[a.a.TargetUserNotFound]:{toast:{text:_}},showToast:!0}},"8W85":function(e,t,i){"use strict";i("kYxP"),i("ERkP");var a=i("zb92");t.a=Object(a.a)({loader:()=>Promise.all([i.e(23),i.e(170)]).then(i.bind(null,"u2Vg")).then((e=>({default:e.__DANGEROUS_IMPORT__})))})},AOWc:function(e,t,i){"use strict";i("849X");function a(e){this.name="AssertionError",this.message=e,this.stack=(new Error).stack}a.prototype=Object.create(Error.prototype),a.prototype.constructor=a;t.a=(e,t)=>{if(!e)throw new a(t?`Assertion failed: ${t}`:"Assertion failed (also, no message was provided)")}},AQOc:function(e,t,i){"use strict";i.d(t,"b",(function(){return l})),i.d(t,"a",(function(){return d}));i("kYxP");var a=i("lnti"),n=i("aWyx"),s=i("Yatk");const r={entries:{},entryIdsByConversationId:{},reactionsByMessageId:{}},o=(e=[],t={})=>e.map((e=>({...e,user:Object(s.a)(t[e.user_id])||{created_at:"",description:"",entities:{},followed_by:!1,followers_count:0,following:!1,friends_count:0,id:parseInt(e.user_id,10),id_str:e.user_id,name:"",profile_image_url_https:"",protected:!1,screen_name:"",verified:!1}})));function c(e,t){const{entries:i,entryIdsByConversationId:a}=t;return(a[e]||[]).map((e=>i[e]&&i[e].data)).filter(Boolean)}const l=(e,t=r,i)=>{const{conversation_id:a,participants:n,...s}=e;return{conversation_id:a,...s,entries:t.entryIdsByConversationId[a]||[],participants:o(n,i)}},d=(e,t,i)=>{const{conversation_id:r,participants:l,social_proof:d,...h}=e,p={conversation_id:r,...h,entries:c(r,t),participants:o(l,i),social_proof:void 0};return d&&(p.social_proof=((e=[],t={})=>e.map((e=>{if(e.proof_type===n.d.MUTUAL_FRIENDS){const{users:i,...n}=e;return{...n,users:Object(a.a)(i.map((e=>Object(s.a)(t[e]))))}}return e})))(d,i)),p}},"Ey+e":function(e,t,i){"use strict";i("kYxP"),i("ERkP");var a=i("AOWc"),n=i("6/RC"),s=i("E6XO"),r=i("sXY3"),o=i("tn7R"),c=i("+d3d"),l=i("oECP"),d=i("fs1G");let h={},p=0;const u={mount:["didMount","willMount"],update:["didUpdate","willUpdate"]},m=()=>{Object(r.a)(h).forEach((([e,t],i)=>{const a=Object(o.a)(t),n=a.length;a.forEach((t=>{Object(r.a)(u).map((([i,[a,r]])=>{(e=>1===e||Math.random()<=.01)(n)&&a in t&&r in t&&Object(s.c)(((e,t)=>`lifecycle:${e.toLowerCase()}:${t}`)(e,i),{duration_ms:t[a]-t[r]})}))}))})),Object(s.a)(),h={}},g=Object(c.a)(m,2e4)||m,_=(e,t=!1)=>{const i=e.constructor.displayName;Object(a.a)(i,`${e.constructor.name} component has "displayName" set.`);let n=e.__lifecycleIdentifier;return!n&&t&&(p+=1,n=e.__lifecycleIdentifier=p),h[i]&&h[i][n]||(h[i]={...h[i],[n]:{}}),[i,n]},b=(e,t,i,a)=>{h[e][t][i]=a};t.a=n.canUseDOM?function(e){const t={UNSAFE_componentWillMount:e.prototype.UNSAFE_componentWillMount||d.a,componentDidMount:e.prototype.componentDidMount||d.a,UNSAFE_componentWillUpdate:e.prototype.UNSAFE_componentWillUpdate||d.a,componentDidUpdate:e.prototype.componentDidUpdate||d.a,componentWillUnmount:e.prototype.componentWillUnmount||d.a};return e.prototype.UNSAFE_componentWillMount=function(...e){const[i,a]=_(this,!0);t.UNSAFE_componentWillMount.apply(this,e),b(i,a,"willMount",Date.now())},e.prototype.componentDidMount=function(...e){const[i,a]=_(this);t.componentDidMount.apply(this,e),b(i,a,"didMount",Date.now()),g()},e.prototype.UNSAFE_componentWillUpdate=function(...e){const[i,a]=_(this,!0);t.UNSAFE_componentWillUpdate.apply(this,e),b(i,a,"willUpdate",Date.now())},e.prototype.componentDidUpdate=function(...e){const[i,a]=_(this);t.componentDidUpdate.apply(this,e),b(i,a,"didUpdate",Date.now()),g()},e.prototype.componentWillUnmount=function(...e){t.componentWillUnmount.apply(this,e),g()},e}:l.a},GSsg:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var a=i("B5iK");class n{constructor(e,t=Object.freeze({})){const{interval:i=6e4,burstInterval:n=3e3,burstDuration:s=3e5}=t;this.pollTimer=new a.b(i).interval(e),this.burstTimer=new a.a(this.pollTimer,n,s)}start(e){return this.pollTimer.start(),e&&this.burstTimer.requestBurst(),this}stop(){return this.burstTimer.stopBurst(),this.pollTimer.stop(),this}restart(){return this.stop(),this.start(),this}}},H4nC:function(e,t,i){"use strict";var a=i("ERkP"),n=i.n(a),s=i("3XMw"),r=i.n(s),o=i("MWbm"),c=i("rHpw"),l=i("t62R"),d=i("4n2h");const h=c.a.create((e=>({root:{paddingBottom:e.spaces.space20}}))),p=r.a.d84b485d,u=r.a.be0c83d7;t.a=({entry:e,isCompact:t,isSelected:i=!1,unread:a=!1})=>{const s="follow"===e.reason?p:u,r=Object(d.b)(a),c=Object(d.a)(a,i);return t?n.a.createElement(l.b,{color:c,weight:r},s):n.a.createElement(o.a,{style:h.root},n.a.createElement(l.b,{align:"center",color:c,size:"subtext2",weight:r},s))}},"I2k/":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a=i("k49u"),n=i("lRnM"),s=i("LVU8");const r=e=>({[a.a.ClientNotPermitted]:{customAction:()=>(Object(s.d)("/messages/",{statusCode:401}),Object(n.v)(e))}})},J2UM:function(e,t,i){"use strict";var a=i("0JOx");t.a=()=>Object(a.h)().then((({inputDetect:e})=>e))},JD1h:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o}));var a=Object.freeze({MOVEMENT:"movement",LIST_UPDATE:"list_update",INITIAL_POSITION:"initial_position"});const n={nearTop:e=>(t,i)=>i.getTop()-t.getTop()<=e,nearBottom:e=>(t,i)=>t.getBottom()-i.getBottom()<=e,nearTopRatio:e=>(t,i)=>{const a=i.getHeight()*e;return i.getTop()-t.getTop()<=a},nearBottomRatio:e=>(t,i)=>{const a=i.getHeight()*e;return t.getBottom()-i.getBottom()<=a}},s=Object.freeze({INSIDE:"inside",OUTSIDE:"outside"}),r=(e,t,i,n)=>((e,t)=>!e&&t===s.INSIDE)(e,i)?a.INITIAL_POSITION:((e,t)=>e===s.OUTSIDE&&t===s.INSIDE)(e,i)?a.MOVEMENT:((e,t)=>e===s.INSIDE&&t===s.INSIDE)(e,i)&&n!==t?a.LIST_UPDATE:null;class o{constructor(e){this._handlers=e.map((e=>({zone:e,state:{}})))}handlePositioningUpdate(e){this._handlers.forEach((({state:t,zone:i})=>{const{callback:a,condition:n}=i,{listLength:o,proximity:c}=t,l=((e,t)=>e(t.getForList(),t.getForViewport())?s.INSIDE:s.OUTSIDE)(n,e),d=e.getListLength(),h=r(c,o,l,d);t.proximity=l,t.listLength=d,h&&a({triggerCause:h})}))}}},OhSZ:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));i("kYxP");var a=i("ERkP"),n=i.n(a),s=i("aWyx"),r=i("XnpN"),o=i("3XMw"),c=i.n(o),l=i("MWbm"),d=i("jV+4"),h=i("pjBI"),p=i("t62R"),u=i("rHpw"),m=i("p9G8");const g=c.a.cfd94063,_=c.a.b93ba92c,b=(e=[])=>e.map((({data:e})=>e)),f=u.a.create((e=>({title:{maxWidth:"50%"},dmGroup:{display:"flex",flexDirection:"column"}}))),v=({conversation:e,newConversationParticipants:t,perspective:i})=>{if(e){if(e.type===s.a.ONE_TO_ONE){const[t]=Object(r.a)(e,i).map((({user:e})=>e));return t.name}return Object(m.a)(e,i)}{const e=b(t);return Object(m.b)(e,i)}};t.b=({conversation:e,isConversationSearchTitle:t=!1,isMessageSearchTitle:i=!1,newConversationParticipants:a,perspective:o,renderTimestamp:c,textColor:u="text",titleWeight:v="bold",withParticipantsCount:y=!1,withScreenName:E=!0,withVDLRefresh:S=!1})=>{if(e){const a=c?c():null;if(e.type===s.a.ONE_TO_ONE){const[s]=Object(r.a)(e,o).map((({user:e})=>e)),c=n.a.createElement(d.a,{color:u,isProtected:s.protected,isVerified:s.verified,name:s.name,screenName:s.screen_name,weight:v,withLink:!1,withScreenName:E});return S&&!t||i?n.a.createElement(h.a,null,c,a):c}{const{participants:s}=e,r=s.length+(S?-1:0);if(t)return n.a.createElement(h.a,{color:u},n.a.createElement(p.b,{color:u,numberOfLines:1,style:f.title,weight:v},Object(m.a)(e,o,t)),S?null:n.a.createElement(p.b,{color:"gray700",numberOfLines:1,weight:"normal"},g({peopleCount:r})));const c=n.a.createElement(p.b,{color:u,numberOfLines:1,weight:v},Object(m.a)(e,o,t));return S&&!t||i?n.a.createElement(l.a,{style:f.dmGroup},n.a.createElement(h.a,null,c,a),y&&n.a.createElement(p.b,{color:"gray700",numberOfLines:1},_({peopleCount:r}))):c}}{const e=b(a);return n.a.createElement(p.b,{color:u,numberOfLines:1,weight:v},Object(m.b)(e,o))}}},Oi4X:function(e,t,i){"use strict";i("Qavd"),i("MvUL"),i("kYxP");var a=i("ERkP"),n=i.n(a),s=i("0JOx"),r=i("zh9S"),o=i("MMRb"),c=i("CDB5"),l=i("RqPI"),d=i("1YZw"),h=i("hqKg"),p=i("kGix"),u=i("AQOc"),m=i("UhuB"),g=i("pNZL"),_=i("G6rE"),b=i("oEGd"),f=i("X/yg"),v=i("0KEI"),y=i("P1r1");const E=(e,t)=>t.conversationId,S=Object(h.createSelector)(o.selectFetchStatus,((e,t)=>o.selectConversationFetchStatus(e,E(0,t))),((e,t)=>e===p.a.LOADED?t:e)),R=Object(h.createSelector)(((e,t)=>o.selectEntriesForConversation(e,E(0,t))),l.q,((e,t)=>t?Object(f.e)(e,t):void 0)),C=Object(h.createSelector)(((e,t)=>o.selectConversation(e,E(0,t))),o.selectEntries,f.m,l.q,f.n,f.o,_.e.selectAll,S,((e,t)=>c.g(e,E(0,t))),((e,t)=>c.j(e,E(0,t))),((e,t)=>c.i(e,E(0,t))),((e,t)=>c.k(e,E(0,t))),((e,t)=>c.h(e,E(0,t))),((e,t)=>c.l(e,E(0,t))),y.j,m.n,R,y.m,((e,t)=>{const i=E(0,t);return o.selectInboxTypeByConversation(e,i)}),((e,t,i,a,n,s,r,o,c,l,d,h,p,m,g,_,b,f,v)=>{const y=e&&e.data;return{conversation:y&&Object(u.a)(y,t,r)||void 0,dataSaverMode:g,draftText:m,dtabBarInfo:f,fetchStatus:o,gifMetadata:p,inboxType:v,isDmReceiptSettingEnabled:_,cardUrl:c,isNewGroupConversation:i,isUploading:l,media:d,mediaUploadProgress:h,newConversationParticipants:n,perspective:a,quickReplyOptions:b,tweetAttachment:s}}));var w=Object(b.d)(C,(e=>{return{acceptConversation:o.acceptConversation,addMedia:(t=e.conversationId,(e,i)=>c.a(t,e,i)),saveText:c.f,addToast:d.b,addWelcomeMessageToConversation:o.addWelcomeMessageToConversation,cancelUpload:Object(f.a)(e.conversationId),createLocalApiErrorHandler:Object(v.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationFuture:o.fetchConversationFuture,fetchConversationHistoricalSnapshot:o.fetchConversationHistoricalSnapshot,fetchConversationHistory:o.fetchConversationHistory,fetchConversationIfNeeded:o.fetchConversationIfNeeded,fetchInboxIfNeeded:o.fetchInboxIfNeeded,fetchUpdatesIfNeeded:o.fetchUpdatesIfNeeded,googleAnalyticsPageView:r.a,leaveConversation:o.leaveConversation,removeMedia:Object(f.b)(e.conversationId),removeText:c.d,scribeAction:r.c,scribePageImpression:r.d,sendMessage:c.m,updateConversationReadState:o.updateConversationReadState,updateTweetDetailNav:g.b,updateTyping:o.updateTyping,removeConversation:o.removeConversation,popOutConversation:o.popOutConversation};var t})),x=i("I2k/"),A=i("4AMG"),T=i("uB9N"),I=i("htvZ"),O=i("v//M"),M=i("3XMw"),k=i.n(M),P=i("UgB4"),D=i("J2UM"),L=i("07FG"),F=i("I8M8"),B=i("7myi"),N=i("pHkl"),j=i("883S"),U=i("z0MJ"),H=i.n(U),W=i("Es6L"),V=i("LsPn"),z=i("sl05"),q=i("GSsg"),G=i("v6aA"),Y=i("EbOo"),$=i("rxPX");var K=Object($.a)().propsFromActions((()=>({addToast:d.b,block:_.e.block,createLocalApiErrorHandler:Object(v.createLocalApiErrorHandlerWithContextFactory)("UNTRUSTED_CONVERSATION_ACTIONS"),muteDMUser:o.muteDMUser,unmuteDMUser:o.unmuteDMUser,unblock:_.e.unblock}))),Q=(i("AQ79"),i("u0B7")),X=i("97Jx"),J=i.n(X),Z=i("tZH3"),ee=i("/yvb"),te=i("efqG");const ie=k.a.ccf2f24e,ae=k.a.ib3fe8a9;var ne=({isGroup:e,onBlockClick:t,onReportClick:i,requestorScreenName:a})=>{const s={type:"destructiveOutlined"},r=n.a.createElement(ee.a,J()({},s,{accessibilityRole:"button"}),ae),o=n.a.createElement(ee.a,J()({},s,{onPress:i}),ie),c=n.a.useCallback(((e,s)=>n.a.createElement(Z.a,{dismiss:e,flatBorders:"sheet"===s,onBlockClick:t,onReportClick:i,requestorScreenName:a,showBlock:!0,showCancel:"sheet"===s})),[t,i,a]);return e?o:n.a.createElement(te.a,{renderContent:c},r)},se=i("MWbm"),re=i("cHvH"),oe=i("rHpw");const ce=e=>{const t=n.a.useContext(G.a),i=t.featureSwitches.isTrue("dm_vdl_enabled")&&t.featureSwitches.isTrue("dm_vdl_chat_p0_enabled"),{loggedInUserId:a}=t,s=()=>e.onAccept(),r=()=>e.onBlock(),o=()=>e.onReport(),c=()=>e.onLeave();return n.a.createElement(re.a,null,(({windowWidth:t})=>{const l=t<=oe.a.theme.breakpoints.small;return n.a.createElement(se.a,{style:le.actionsContainer},i&&n.a.createElement(ee.a,{onPress:s,size:"medium",style:[le.actionFullWidth,le.actionMarginBottom],type:"primaryOutlined"},e.acceptButtonText),n.a.createElement(se.a,{style:l?le.actionFullWidth:[le.actionHalfWidth,le.actionMarginRight]},n.a.createElement(ne,{isGroup:e.isGroup,onBlockClick:r,onReportClick:o,requestorScreenName:Object(f.j)(e.conversation,a).screenName})),n.a.createElement(ee.a,{onPress:c,size:"medium",style:l?[le.actionFullWidth,le.actionMarginTop]:[le.actionHalfWidth,le.actionMarginLeft],type:"destructiveOutlined"},e.declineButtonText),!i&&n.a.createElement(ee.a,{onPress:s,size:"medium",style:[le.actionFullWidth,le.actionMarginTop],type:"primaryOutlined"},e.acceptButtonText))}))},le=oe.a.create((e=>({actionsContainer:{display:"flex",flexWrap:"wrap",flexDirection:"row"},actionFullWidth:{width:"100%"},actionHalfWidth:{width:`calc(50% - ${e.spaces.space4})`},actionMarginRight:{marginRight:e.spaces.space4},actionMarginLeft:{marginLeft:e.spaces.space4},actionMarginTop:{marginTop:e.spaces.space12},actionMarginBottom:{marginBottom:e.spaces.space12}})));var de=i("aITJ"),he=i("t62R"),pe=i("eb3s"),ue=i("vMjK"),me=i("7JQg"),ge=i("24HD"),_e=i("zCf4");const be=k.a.da878dcf,fe=k.a.d96cf7cd,ve=(k.a.gde6b424,k.a.e308019b,k.a.gf5e9ea6,k.a.hc52446b),ye=k.a.f7e1ad65,Ee={headline:k.a.gdf4b79f,text:k.a.bbf83d83,confirmButtonLabel:k.a.bb1d57b6},Se=oe.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderTopStyle:"solid",borderTopWidth:"1px",paddingVertical:e.spaces.space20,paddingHorizontal:e.componentDimensions.gutterHorizontal},copy:{paddingBottom:e.spaces.space20}})));var Re=Object(me.a)({element:"untrusted_interstitial"})(K((e=>{const{conversation:t,scribeAction:i,scribeNamespace:a}=e,s=n.a.useContext(G.a),r=Object(_e.f)(),c=Object(_e.g)(),[l,d]=n.a.useState(!1),[h,p]=n.a.useState(!1),u=n.a.useCallback((()=>({items:[{conversation_type:t.type===o.CONVERSATION_TYPE.GROUP?N.i.GROUP:N.i.ONE_TO_ONE}]})),[t.type]),m=n.a.useCallback(((e,t)=>{i({...a,action:e},t||u())}),[u,i,a]);n.a.useEffect((()=>{m("impression")}),[m]);const g=()=>{d(!0),p(!1)},_=()=>{d(!1)},b=()=>{p(!1)},v=()=>{var i;const{conversationId:a,inboxType:n,leaveConversation:s}=e,r=t.type===o.CONVERSATION_TYPE.GROUP?"leave_group":"delete_thread",l=(null==t?void 0:t.participants.length)||0,h=(null==c||null==(i=c.state)?void 0:i.position)||0,p={conversation_type:(null==t?void 0:t.type)===o.CONVERSATION_TYPE.GROUP?N.i.GROUP:N.i.ONE_TO_ONE,conversation_id:a,conversation_participant_count:l,position:h,inbox_type:Object(f.i)(n),entry_point:N.c.REQUEST_ACTION_SHEET};d(!1),s({conversationId:a}),m(r,p),y()},y=()=>{const{inboxType:t}=e;r.push(Object(f.f)(t))},E=()=>{(()=>{var i;const{acceptConversation:a,conversationId:n,inboxType:s,scribeAction:r,scribeNamespace:l}=e,d=(null==t?void 0:t.participants.length)||0,h=(null==c||null==(i=c.state)?void 0:i.position)||0;n&&(a(n),r({...l,action:"accept"},{conversation_id:n,conversation_type:t.type===o.CONVERSATION_TYPE.GROUP?N.i.GROUP:N.i.ONE_TO_ONE,conversation_participant_count:d,entry_point:N.c.REQUEST_ACTION_SHEET,inbox_type:Object(f.i)(s),position:h}))})()},S=t=>()=>{const{addToast:i,block:a,createLocalApiErrorHandler:n}=e;p(!1),a(t).then((()=>{i({action:{label:ue.c,onAction:R(t)},text:ue.a})}),n(Y.a)),m("block")},R=t=>()=>{const{createLocalApiErrorHandler:i,unblock:a}=e;a(t).catch(i(Q.a)),m("unblock")},C=(t&&t.type)===o.CONVERSATION_TYPE.GROUP;return n.a.createElement(n.a.Fragment,null,n.a.createElement(se.a,{style:Se.root},(e=>{const{loggedInUserId:i}=s;return n.a.createElement(he.b,{style:Se.copy},e?ve:ye({senderName:Object(f.j)(t,i).name}))})(C),n.a.createElement(ce,{acceptButtonText:be,conversation:t,declineButtonText:fe,isGroup:C,onAccept:E,onBlock:()=>{d(!1),p(!0)},onLeave:g,onReport:()=>{const{conversationId:t,inboxType:i}=e;t&&(m("report"),r.push(Object(f.g)(t,window.location.pathname,a,i)))}})),de.b.isKaiOS()?n.a.createElement(V.a,{leftText:fe,onLeftClick:g,onRightClick:E,rightText:be}):null,l?n.a.createElement(pe.a,{confirmButtonLabel:Ee.confirmButtonLabel,confirmButtonType:"destructiveFilled",headline:Ee.headline,onCancel:_,onConfirm:v,text:Ee.text}):null,h?(()=>{const{loggedInUserId:e}=s,{idStr:i,screenName:a}=Object(f.j)(t,e);return Object(ge.j)({confirmation:Object(ge.f)(a),onClose:b,handleConfirm:S(i)})})():null)}))),Ce=i("yw4N"),we=i("rFBM"),xe=i("mw9i"),Ae=i("jTgF"),Te=i("+d3d"),Ie=i("mN6z");const Oe=n.a.createElement(P.a,null),Me=k.a.badb01a0,ke=k.a.e3275464,Pe=k.a.d6b11d9c,De=k.a.i7ca1446,Le=e=>e&&(e.tweet||e.media),Fe=({gifMetadata:e={},tweetAttachment:t,media:i})=>{let a;return t?a={tweet:t}:i?i.mediaFile?a={media:i}:i.externalMediaDetails&&(a={media:i,provider:e.provider,gifUrl:e.url}):a=null,a};class Be extends n.a.PureComponent{constructor(e,t){super(e,t),this._composer=n.a.createRef(),this._handleLivePipelineUpdate=()=>{this._fetchUpdatesIfNeeded(),this._updatePolling&&this._updatePolling.restart()},this._fetchUpdatesIfNeeded=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:i,isDmReceiptSettingEnabled:a}=this.props;i(a?{active_conversation_id:e,dm_users:!0}:{}).catch(t())},this._handleInitialFetch=()=>{this._initialFetch()},this._initialFetch=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchInboxIfNeeded:i,fetchUpdatesIfNeeded:a}=this.props;return i().then((()=>{if(e)return this._fetchConversation(e).then((()=>this._requestWelcomeMessage(e)))})).then((()=>a())).catch(t()).finally((()=>{this._updatePolling&&this._updatePolling.start()}))},this._isUntrustedConversation=e=>{const{isNewGroupConversation:t}=this.props;return!(null!=e&&e.trusted||t)},this._leaveConversation=e=>{const{createLocalApiErrorHandler:t,leaveConversation:i}=this.props;i(e).catch(t({showToast:!0}))},this._acceptConversation=e=>{const{acceptConversation:t,createLocalApiErrorHandler:i}=this.props;t(e).then((()=>{de.b.isMobileOS()&&this._fetchConversation(e)})).catch(i({showToast:!0}))},this._renderActions=()=>{const{conversation:e,conversationId:t,inboxType:i,scribeAction:a}=this.props;return e&&this._isUntrustedConversation(e)?e.read_only?null:t&&n.a.createElement(Re,{acceptConversation:this._acceptConversation,conversation:e,conversationId:t,inboxType:i,leaveConversation:this._leaveConversation,scribeAction:a}):n.a.createElement(n.a.Fragment,null,this._renderComposerBar(),de.b.isKaiOS()?n.a.createElement(V.a,{leftText:De,onLeftClick:this._handleInfoClick,onRightClick:this._handleComposeClick,rightText:Me}):null)},this._render=()=>{var e,t,i;const{conversation:a,conversationId:s,drawerHeader:r,inboxType:o,isWide:c,location:l,perspective:d,scribeNamespace:h}=this.props,{attachment:p,composerHeight:u}=this.state;return n.a.createElement(I.b,{key:s},n.a.createElement(we.a,{allowDragDrop:!Le(p),onFilesAdded:this._handleDragDrop,style:z.a.dragDrop},n.a.createElement(Ce.a,{style:[z.a.scrollView,!Object(W.a)()&&!this._isUntrustedConversation(a)&&{paddingBottom:u}]},d&&a&&(null==l||null==(e=l.state)||!e.entryPoint||this.state.hasLoadedSnapshot)?n.a.createElement(A.a,{conversation:a,drawerHeader:r,inboxType:o,isWide:c,messageSearchEntryId:null==l||null==(t=l.state)?void 0:t.entryPoint,onForwardRequest:this._handleForwardRequest,onHistoryRequest:null!=l&&null!=(i=l.state)&&i.entryPoint?this._handleRelativeHistoryRequest:this._handleHistoryRequest,perspective:d,scribeNamespace:h,shouldScrollToCenter:this.state.shouldScrollToCenter,style:z.a.activity}):null),this._renderActions()))},this._handleNavHeightChange=e=>{this.setState({composerHeight:`${e}px`})},this._handleTyping=()=>{this._throttleSaveDraftText(),this._throttleUpdateTyping()},this._throttleUpdateTyping=Object(Te.a)((()=>{const{conversationId:e,createLocalApiErrorHandler:t,updateTyping:i}=this.props;e&&i({conversationId:e}).catch(t())}),2e3,{trailing:!1}),this._throttleSaveDraftText=Object(Te.a)((()=>{const{conversationId:e}=this.props;e&&this._handleSaveDraftText()}),1e3,{leading:!1}),this._handleDragDrop=e=>{this._currentComposer&&this._currentComposer.handleAddMediaFiles(e)},this._handleForwardRequest=()=>{const{conversation:e,conversationId:t,createLocalApiErrorHandler:i,fetchConversationFuture:a}=this.props;this.setState({shouldScrollToCenter:!1}),null!=e&&e.max_search_entry_id&&a({conversationId:t}).catch(i())},this._handleHistoryRequest=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchConversationHistory:i}=this.props;i({conversationId:e}).catch(t())},this._handleRelativeHistoryRequest=()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchConversationHistory:i}=this.props;this.setState({shouldScrollToCenter:!1}),i({conversationId:e,isSearch:!0}).catch(t())},this._handleSendMessage=(e,t)=>{var i,a;const{addToast:n,cardUrl:s,conversation:r,conversationId:c,createLocalApiErrorHandler:l,gifMetadata:d,history:h,location:p,newConversationParticipants:u,perspective:m,scribeAction:g,scribeNamespace:_,sendMessage:b,tweetAttachment:f}=this.props,{attachment:v}=this.state,y=v&&v.media,E=null!=r&&r.participants?r.participants.length:0,S=(null==r?void 0:r.type)===o.CONVERSATION_TYPE.GROUP;let R="unknown";if(e.quickReply||y||(this._currentComposer&&this._currentComposer.clear(),this._currentComposer&&this._currentComposer.focus()),d)R="gif";else if(s)R="card";else if(f)R="tweet";else{var C;const e=null==v||null==(C=v.media)?void 0:C.mediaFile,i=null!=e&&e.isVideo?"video":null!=e&&e.isGif?"gif":"photo",a=t?"text":"unknown";R=e?i:a}if(c&&g({..._,element:R,action:"send_dm"},{conversation_id:c,conversation_participant_count:E,conversation_type:S?N.i.GROUP:N.i.ONE_TO_ONE}),this.setState({isSending:!0}),!c){return b({senderId:m,recipients:u&&u.map((({data:e})=>e.id_str)),text:t,tweetAttachment:f}).then((e=>{g({..._,element:R,action:"send_dm"},{conversation_id:e,conversation_participant_count:u?u.length+1:0,conversation_type:N.i.GROUP}),this.setState({attachment:null,isSending:!1}),h.replace(`/messages/${e}`)}),l(j.b)),Promise.resolve()}return!this.state.attachment||null!=(i=this.state.attachment)&&null!=(a=i.media)&&a.uploading||(this.setState({attachment:null}),h.replace(p.pathname)),b({senderId:m,cardUrl:s,conversationId:c,text:t,tweetAttachment:f,...e&&e.quickReply&&{quickReply:e.quickReply}}).then((()=>{!e.quickReply&&y&&(this._currentComposer&&this._currentComposer.clear(),this._currentComposer&&this._currentComposer.focus()),this.setState({isSending:!1})})).catch((e=>{if(this.setState({isSending:!1}),!Object(Ae.d)(e)||e.code!==F.b.CANCELED)if(Object(Ae.d)(e)){const t=Object(Ae.b)(e,Pe);t&&n(t)}else l(j.b)(e)}))},this._handlePopOutConvo=()=>{const{conversationId:e,popOutConversation:t}=this.props;t(e)},this._handleInfoClick=()=>{const{conversationId:e,history:t}=this.props;e&&t.push(`/messages/${e}/info`)},this._handleComposeClick=()=>{this._currentComposer&&this._currentComposer.focus()},this._handleSaveDraftText=()=>{const{conversationId:e,saveText:t}=this.props;e&&this._currentComposer&&t(e,this._currentComposer.value())},this.state={attachment:Fe(e),composerHeight:oe.a.theme.componentDimensions.appBarHeight,hasLoadedSnapshot:!1,isSending:!1,shouldScrollToCenter:!1}}componentDidMount(){var e,t;const{googleAnalyticsPageView:i,scribeNamespace:a,scribePageImpression:n,updateTweetDetailNav:s}=this.props;return n(a),s(a),i(a),this._initializePolling({interval:3e3}),this._initializeLivePipeline(),this._focusComposerIfNeeded(),null!=(e=this.props.location)&&null!=(t=e.state)&&t.entryPoint&&this.setState({shouldScrollToCenter:!0}),this._initialFetch()}_focusComposerIfNeeded(){H()((()=>Object(D.a)().then((({KEYBOARD:e,MOUSE:t,detectedType:i})=>{const a=this.props.quickReplyOptions;(i(e)||i(t))&&!a&&this._currentComposer&&this._currentComposer.focus()}))))}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(s.h)().then((({LivePipeline:t})=>{e&&t.isSupportedAndReady(this.context.featureSwitches)&&this.context.featureSwitches.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic(`/dm_update/${e}`,this._handleLivePipelineUpdate),this._initializePolling({interval:1e4}))}))}_initializePolling({interval:e}){this._updatePolling&&this._updatePolling.stop(),this._updatePolling=new q.a(this._fetchUpdatesIfNeeded,{interval:e})}componentWillUnmount(){const{conversation:e,conversationId:t,removeConversation:i}=this.props,a=(null==e?void 0:e.entries)||[];this._updatePolling&&this._updatePolling.stop(),this._updatePolling=void 0,this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),0===a.length&&i(t),1===a.length&&"welcome_message_create"===a[0].type&&i(t)}componentDidUpdate(e,t){var i,a,n;const{conversation:s,conversationId:r,fetchStatus:o,isUploading:c,location:l,quickReplyOptions:d,updateConversationReadState:h}=this.props;var u;((null==l||null==(i=l.state)?void 0:i.entryPoint)!==(null==(a=e.location)||null==(n=a.state)?void 0:n.entryPoint)&&r&&this._fetchConversation(r),r!==e.conversationId)?(r&&this._fetchConversation(r),this._focusComposerIfNeeded(),this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),this._initializeLivePipeline()):((null==s?void 0:s.sort_event_id)!==(null==(u=e.conversation)?void 0:u.sort_event_id)&&h(r),c||!e.isUploading||d||this._currentComposer&&this._currentComposer.focus(),e.fetchStatus===p.a.LOADED&&o!==p.a.LOADED&&r&&this._fetchConversation(r))}UNSAFE_componentWillReceiveProps(e){const{media:t}=this.props,{media:i}=e;Object(Ie.a)(t,i)||this.setState({attachment:Fe(e)})}render(){const{fetchStatus:e}=this.props;return n.a.createElement(xe.a,{style:[z.a.root,de.b.isKaiOS()&&z.a.kaiOSFix]},n.a.createElement(O.a,{fetchStatus:e,onRequestRetry:this._handleInitialFetch,render:this._render}))}_renderComposerBar(){const{addMedia:e,cardUrl:t,conversation:i,conversationId:a,dataSaverMode:s,draftText:r,dtabBarInfo:o,history:c,isUploading:l,mediaUploadProgress:d,quickReplyOptions:h,removeMedia:p,richTextInputContext:u,scribeNamespace:m,typeaheadWrapper:g}=this.props,{attachment:_,isSending:b}=this.state,f=this.props.prefillText||r;return null!=i&&i.read_only?null:n.a.createElement(T.a,{attachment:_,conversationId:a,disabled:l,dtabBarInfo:o,history:c,isCardPreviewTombstoned:Object(L.a)(t),isSending:b,isUploading:l,key:a,mediaUploadProgress:d,onAddMedia:e,onBlur:this._handleSaveDraftText,onHeightChange:this._handleNavHeightChange,onPrimaryAction:this._handleSendMessage,onTyping:s?this._throttleSaveDraftText:this._handleTyping,prefillText:"string"==typeof f?f:void 0,primaryActionIcon:Oe,primaryActionLabel:ke,quickReplyOptions:h,ref:this._composer,removeMedia:p,richTextInputContext:u,scribeNamespace:m,typeaheadWrapper:g})}get _currentComposer(){return this._composer.current}_fetchConversation(e){var t;const{createLocalApiErrorHandler:i,fetchConversationHistoricalSnapshot:a,fetchConversationIfNeeded:n,location:s,updateConversationReadState:r}=this.props;var c;return null!=s&&null!=(t=s.state)&&t.entryPoint?(this.setState({hasLoadedSnapshot:!1}),a({conversationId:e,entryId:null==s||null==(c=s.state)?void 0:c.entryPoint}).then((e=>{var t,i;let a=!0;(null==e||null==(t=e.result)||null==(i=t.conversation_timeline)?void 0:i.status)===o.PAGINATION_STATUS.AT_END&&(a=!1),this.setState({hasLoadedSnapshot:!0,shouldScrollToCenter:a})})).catch((e=>(this.setState({hasLoadedSnapshot:!0}),i(e))))):n({conversationId:e}).then((()=>r(e))).catch(i(Object(x.a)(e)))}_requestWelcomeMessage(e){var t;const{addWelcomeMessageToConversation:i,conversation:a,createLocalApiErrorHandler:n,location:s}=this.props,{text:r}=s.query,c=Array.isArray(s.query.welcome_message_id)?s.query.welcome_message_id[0]:s.query.welcome_message_id,l=!!this.state.attachment||!(!r||c),d=!a||!a.type||a.type===o.CONVERSATION_TYPE.GROUP,h=a&&(null==a||null==(t=a.participants)?void 0:t.length)<=1;return l||d||h?Promise.resolve():i(e,c).catch(n({showToast:!1}))}}Be.contextType=G.a,Be.defaultProps={isNewGroupConversation:!1,typeaheadWrapper:B.a};t.a=Object(me.a)()(w(Be))},RJrc:function(e,t,i){"use strict";var a=i("ERkP"),n=i.n(a),s=i("3XMw"),r=i.n(s),o=i("MWbm"),c=i("Qwev"),l=i("rHpw");const d=r.a.ffde2fdb,h=l.a.create((e=>({spinner:{alignItems:"center",marginVertical:"30px"}})));t.a=()=>n.a.createElement(o.a,{style:h.spinner},n.a.createElement(c.a,{accessibilityLabel:d}))},"V/6K":function(e,t,i){"use strict";var a=i("ERkP");const n=i.n(a).a.createContext({isDrawer:!1});t.a=n},"X/yg":function(e,t,i){"use strict";i.d(t,"o",(function(){return c})),i.d(t,"n",(function(){return l})),i.d(t,"m",(function(){return d})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return p})),i.d(t,"i",(function(){return u})),i.d(t,"k",(function(){return m})),i.d(t,"l",(function(){return g})),i.d(t,"g",(function(){return _})),i.d(t,"j",(function(){return b})),i.d(t,"h",(function(){return f})),i.d(t,"f",(function(){return v})),i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return E})),i.d(t,"e",(function(){return S}));var a=i("CDB5"),n=i("Myq3"),s=i("XnpN"),r=i("AQ79"),o=i("pHkl");const c=(e,t)=>t.location&&t.location.state&&t.location.state.tweetAttachment,l=(e,t)=>t.location&&t.location.state&&t.location.state.participants,d=(e,t)=>t.location&&t.location.state&&t.location.state.isNewGroupConversation,h=e=>{const{message_data:t}=e;let i=o.e.UNKNOWN;const a=t&&t.attachment||{};return a.tweet?i=o.e.TWEET:a.photo?i=o.e.PHOTO:a.animated_gif?i=o.e.GIF:a.video?i=a.video.audio_only?o.e.VOICE:o.e.VIDEO:a.card?i=o.e.CARD:null!=t&&t.text&&(i=o.e.TEXT),i};function p(e,t){return e.findIndex((e=>e.id===t))}function u(e){return e===r.d.SECONDARY?o.d.REQUESTS:e===r.d.TERTIARY?o.d.LOW_QUALITY:o.d.PRIMARY}function m(e){return e.isTrue("dm_voice_rendering_enabled")}function g(e,t){return!!(e&&e.video&&m(t))&&!!e.video.audio_only}function _(e,t,i,a){return{pathname:`/i/report/dm_conversation/${e}`,state:{clientReferer:t,inboxType:a,scribeNamespace:i}}}function b(e,t){if(!e)return{name:"",screenName:"",idStr:""};const i=Object(s.a)(e,t).map((({user:e})=>e)),a=i&&i[0];return{name:a&&a.name||"",screenName:a&&a.screen_name||"",idStr:a&&a.id_str||""}}const f=e=>e===r.d.TERTIARY?"low_quality_timeline":e===r.d.SECONDARY?"requests_timeline":"inbox_timeline",v=e=>e===r.d.TERTIARY?"/messages/requests/additional":e===r.d.SECONDARY?"/messages/requests":"/messages",y=e=>()=>a.b(e),E=e=>t=>a.c(e,t),S=(e,t)=>{const i=Object(n.a)(e,(e=>!!e.message_data&&(e.message_data&&e.message_data.recipient_id===t)));return i&&i.message_data&&i.message_data.quick_reply&&i.message_data.quick_reply&&"options"===i.message_data.quick_reply.type?i.message_data.quick_reply:void 0}},XnpN:function(e,t,i){"use strict";i("kYxP");var a=i("aWyx"),n=i("t0aI");const s=(e=0)=>new Date(Number(e)),r=(e,t)=>s(e.join_time)-s(t.join_time),o=({user:e},{user:t})=>Object(n.a)(e.id_str,t.id_str);var c=i("VIKJ");t.a=(e,t)=>{const{created_by_user_id:i,participants:n,type:s}=e,[l,d]=Object(c.a)(n,(({user:e})=>e.id_str===t));return d.length?s===a.a.GROUP&&1===d.length?[...l,...d]:i?d.sort(((...e)=>(t,i)=>e.map((e=>e(t,i))).filter((e=>!!e))[0]||0)((e=>({user:t},{user:i})=>{switch(e){case t.id_str:return-1;case i.id_str:return 1;default:return 0}})(i),r,o)):d:l}},Yatk:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));const a=e=>{if(e)return{blocking:e.blocking,can_dm:e.can_dm,can_media_tag:e.can_media_tag,created_at:e.created_at,description:e.description,entities:e.entities,followed_by:e.followed_by,followers_count:e.followers_count,following:e.following,friends_count:e.friends_count,id:e.id,id_str:e.id_str,name:e.name,profile_image_url_https:e.profile_image_url_https,protected:e.protected,screen_name:e.screen_name,verified:e.verified}}},aA19:function(e,t,i){"use strict";var a=i("ERkP"),n=i.n(a),s=i("aWyx"),r=i("XnpN"),o=i("3XMw"),c=i.n(o),l=i("aI6n"),d=i("rHpw"),h=i("TIdA"),p=i("A91F"),u=i("jhWN"),m=i("9Xij"),g=i("Znyr"),_=i("cm6r"),b=i("U+bB"),f=i("MWbm");const v=c.a.fd48249b,y=d.a.create((e=>({circle:{borderRadius:e.borderRadii.infinite,overflow:"hidden"},container:{height:"auto",width:"100%"},itemAccessory:{top:-e.spacesPx.space24+e.spacesPx.space1,right:-e.spacesPx.space16-e.spacesPx.space1},userDecoration:{fontSize:e.fontSizes.subtext3,position:"absolute",backgroundColor:e.colors.gray100,marginLeft:e.spaces.space8,boxSizing:"border-box",width:e.spaces.space24,height:e.spaces.space24}}))),E=d.a.create((e=>({container:{flexDirection:"row"},left:{flex:1},right:{flex:1,marginLeft:e.borderWidths.small,marginRight:`calc(-1 * ${e.borderWidths.small})`}}))),S=d.a.create((e=>({container:{flexDirection:"column"},top:{flex:1,marginBottom:e.borderWidths.small},bottom:{flex:1}}))),R=({left:e,right:t})=>n.a.createElement(f.a,{style:E.container},n.a.createElement(f.a,{style:E.left},e),n.a.createElement(f.a,{style:E.right},t)),C=({bottom:e,top:t})=>n.a.createElement(f.a,{style:S.container},n.a.createElement(f.a,{style:S.top},t),n.a.createElement(f.a,{style:S.bottom},e));t.a=e=>{const t=t=>{const{size:i}=e;return n.a.createElement(f.a,{key:t.id_str,style:y.container},n.a.createElement(u.a,{size:i||"xxLarge",uri:t.profile_image_url_https}))},i=e=>{const t=e.length,i=e.map(((e,i)=>{const a=2===t||3===t&&0===i?.5:1;return n.a.createElement(f.a,{key:e.id_str,style:y.container},n.a.createElement(u.a,{aspectRatio:a,shape:"none",size:"custom",uri:e.profile_image_url_https}))}));if(2===t)return n.a.createElement(m.a,{ratio:1},n.a.createElement(R,{left:i[1],right:i[0]}));{const e=n.a.createElement(C,{bottom:i[2],top:i[1]}),t=i[0];return n.a.createElement(R,{left:e,right:t})}},{conversation:a,link:o,perspective:c,withBadge:E}=e,S=a&&a.avatar_image_https,w=a?Object(r.a)(a,c).map((({user:e})=>e)):[],x=w.slice(0,3),A=(e=>{const t=e&&e.avatar&&e.avatar.image&&e.avatar.image.original_info;return t?n.a.createElement(h.a,{accessibilityLabel:"",aspectMode:p.a.SQUARE,backgroundColor:d.a.theme.colors.gray50,image:t,rounded:!0}):null})(a)||(e=>e?n.a.createElement(b.a,{source:e}):null)(S)||(e=>{const a=e.length;return 0===a?null:1===a?t(e[0]):n.a.createElement(f.a,{style:y.circle},i(e))})(x),T=o||((e,t)=>{if(e)return e.type===s.a.GROUP?`/messages/${e.conversation_id}/participants`:e.type===s.a.ONE_TO_ONE?`/${t[0].screen_name}`:void 0})(a,w),I=E&&null!=a&&a.participants?a.participants.length-1:0;return A?n.a.createElement(n.a.Fragment,null,n.a.createElement(m.a,{ratio:1},T?n.a.createElement(_.a,{interactiveStyles:null,link:T,testID:l.a.conversationAvatar},A):A),I?(({badgeCount:e})=>n.a.createElement(f.a,{style:y.itemAccessory},n.a.createElement(g.a,{count:e,standalone:!0,style:y.userDecoration,textColor:"text",truncatedCountFormatter:()=>"",unreadCountLabel:v,withTruncatedCount:!1})))({badgeCount:I}):null):null}},aI6n:function(e,t,i){"use strict";t.a={conversationAvatar:"DM_Conversation_Avatar",newDM:"NewDM_Button",untrustedThumbnail:"DM_Untrusted_Thumbnail"}},b9JY:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"e",(function(){return s})),i.d(t,"d",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return l}));var a=i("aWyx");const n=e=>e&&e.type===a.b.MESSAGE,s=e=>e&&e.type===a.b.WELCOME_MESSAGE,r=e=>e&&e.type===a.b.TRUST_CONVERSATION,o=e=>e&&e.type===a.b.REACTION_CREATE,c=[a.b.CONVERSATION_AVATAR_UPDATE,a.b.CONVERSATION_NAME_UPDATE,a.b.JOIN_CONVERSATION,a.b.PARTICIPANTS_JOIN,a.b.PARTICIPANTS_LEAVE],l=e=>e&&c.indexOf(e.type)>-1},dPJJ:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));i("kYxP");var a=i("6/RC");const n=new Set,s=new Set;let r=!1;function o(){if(a.canUseDOM&&!r){const e=["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"];["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","msfullscreenchange"].forEach((t=>{document.addEventListener(t,(()=>{const t=e.map((e=>document[e])).filter(Boolean)[0];t?n.forEach((e=>e(t))):s.forEach((e=>e()))}))}))}r=!0}const c=e=>(r||o(),n.add(e),()=>n.delete(e)),l=e=>(r||o(),s.add(e),()=>s.delete(e))},"ejT/":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return n}));const a=e=>({id:e,distanceToViewportTop:0}),n=e=>({id:e,distanceToViewportBottom:0})},g54k:function(e,t,i){"use strict";i.d(t,"b",(function(){return c}));var a=i("hqKg"),n=i("s1N3");var s=e=>{const{sender_id:t,by_user_id:i,participants:a=[]}=e;return Object(n.a)(a.map((({user_id:e})=>e)).concat([t,i]).filter(Boolean))},r=i("G6rE"),o=i("oEGd");const c=(e,t)=>({users:s(t).reduce(((t,i)=>(t[i]=e[i],t)),{})}),l=Object(a.createSelector)(r.e.selectAll,((e,t)=>t.entry),c);t.a=Object(o.c)(l)},gbD7:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return r})),i.d(t,"d",(function(){return o})),i.d(t,"c",(function(){return c}));i("ERkP");var a=i("aWyx");const n=(e,t)=>({entry:{id:t,time:"",type:e},isActive:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,type:e}),s=n(a.b.CONVERSATION_PROFILE_INFO_HEADER,"conversationProfileInfoHeader"),r="typingIndicator",o=n(a.b.TYPING_INDICATOR,r),c=n(a.b.READ_ONLY_INDICATOR,"readOnlyIndicator")},htvZ:function(e,t,i){"use strict";i.d(t,"b",(function(){return b})),i.d(t,"a",(function(){return f}));var a=i("ERkP"),n=i.n(a),s=i("v6aA"),r=(i("kYxP"),i("8W85"));function o(){const e=n.a.useContext(f),[t,i]=e.activeVoiceMessage,[,a]=e.playerApi,[,s]=e.playerState,[,o]=t;const c={media:o,onEnded:function(){i([null,null]),e.scribeAction&&e.scribeAction.complete()},onPlayerApi:a,onPlayerState:s};return n.a.createElement(r.a,c)}var c=i("X/yg"),l=(i("849X"),i("89tF")),d=i("k89r");function h(e){const t=function(){const e=n.a.useState(m.activeVoiceMessage),t=n.a.useState(m.playerApi),i=n.a.useState(m.playerState),a=function(){const e=Object(d.a)();return n.a.useMemo((()=>{const t={page:"messages",section:"thread",component:"message",element:"voice"};function i({action:e,component:i=t.component}){const{element:a,page:n,section:s}=t;return{page:n,section:s,component:i,element:a,action:e}}const a=(t,a)=>a?a.data?e.scribe({...i({action:t}),data:a.data}):e.scribe({...i({action:t,component:u(a)})}):e.scribe({...i({action:t})});return{impression:e=>a("impression",e),report:e=>a("report",e),play:e=>a("play",e),pause:()=>a("pause"),complete:()=>a("complete")}}),[e])}();return{activeVoiceMessage:e,playerApi:t,playerState:i,scribeAction:a}}();return n.a.createElement(g.Provider,{value:t},e.children)}const p={Timelines:Object(l.a)({message:!0,inbox_timeline:!0,low_quality_timeline:!0,requests_timeline:!0})};function u({isLowQuality:e,isTrusted:t}){return t?p.Timelines.inbox_timeline:e?p.Timelines.low_quality_timeline:p.Timelines.requests_timeline}const m={activeVoiceMessage:[null,null],playerApi:null,playerState:null,scribeAction:null},g=n.a.createContext({activeVoiceMessage:[m.activeVoiceMessage,_],playerApi:[m.playerApi,_],playerState:[m.playerState,_],scribeAction:null});function _(){throw new Error("DMVoiceContext is not initialized")}function b(e){const{featureSwitches:t}=n.a.useContext(s.a);return Object(c.k)(t)?n.a.createElement(h,null,e.children,n.a.createElement(o,null)):e.children}const f=g},jHwr:function(e,t,i){"use strict";t.a=(e,t)=>{let i=null;const a=()=>{i=null,e()};return()=>(i||(i=t(a)),i)}},kgfz:function(e,t){function i(e){var t=[];for(var i in e)t.push(i);return t}(e.exports="function"==typeof Object.keys?Object.keys:i).shim=i},p9G8:function(e,t,i){"use strict";i.d(t,"b",(function(){return h}));i("kYxP");var a=i("Xrkv"),n=i("aWyx"),s=i("XnpN"),r=i("3XMw"),o=i.n(r);const c=o.a.b5b7fb93,l=o.a.g755fcde,d=o.a.f6b1ff81;t.a=(e,t,i)=>{const{type:a,name:r,participants:o={}}=e;if(a===n.a.GROUP&&r)return r;if(!o.length)return;if(a===n.a.GROUP&&i)return c;const l=Object(s.a)(e,t).map((({user:e})=>e));return h(l,t,a)};const h=(e=[],t,i=n.a.GROUP)=>{const s=e.filter((e=>e.id_str!==t)).map((e=>e.name));switch(s.length){case 0:return l;case 1:{const[e]=s;return i===n.a.GROUP?d({name:e}):e}default:{const e=!0;return Object(a.a)(s,e)}}}},prG5:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var a=i("97Jx"),n=i.n(a),s=(i("kYxP"),i("ERkP")),r=i.n(s),o=i("nT9l"),c=i("3XMw"),l=i.n(c),d="image",h=i("TIdA"),p=i("a6qo");const u=l.a.f93bb3ee;class m extends r.a.Component{constructor(...e){super(...e),this._renderContent=({resourceSelectionHandler:e,useMinimumData:t})=>{const{accessibilityLabel:i,hideAcceptOverlay:a,shouldShowAltLabel:s,...o}=this.props;return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,n()({},o,{accessibilityLabel:i,onVariantSelection:e,previewMode:t,testID:d})),s?r.a.createElement(p.a,{align:"left",altLabel:i}):null)}}render(){const{hideAcceptOverlay:e,image:t}=this.props;return r.a.createElement(o.a,{acceptLabel:u,hideAcceptOverlay:e,renderContent:this._renderContent,resourceId:"string"==typeof t?t:t.url})}}},sl05:function(e,t,i){"use strict";var a=i("rHpw");t.a=a.a.create((e=>({root:{flexGrow:1},activity:{flexBasis:e.spacesPx.space1,flexGrow:1,height:"100%"},kaiOSFix:{paddingBottom:e.spaces.space20},dragDrop:{flexGrow:1},scrollView:{flexGrow:1}})))},tZH3:function(e,t,i){"use strict";var a=i("ERkP"),n=i.n(a),s=i("3XMw"),r=i.n(s),o=i("MWbm"),c=i("CKsB"),l=i("/yvb"),d=i("rHpw"),h=i("hiGS"),p=i("pu5c"),u=i("zIWA");const m=r.a.fcd4d489,g=r.a.gbed8594,_=r.a.g9074da4,b=r.a.ad63377d,f=r.a.h09b49f7,v=r.a.i6b19b07,y=r.a.j7bb1a42,E=r.a.ea200ba6,S=r.a.cfd2f35d,R=({dismiss:e,flatBorders:t,isGroup:i,onBlockClick:a,onDeleteClick:s,onReportClick:r,requestorScreenName:d,showBlock:R,showCancel:w,showDelete:x})=>{const A=n.a.useCallback((()=>{r&&r(),e()}),[e,r]),T=n.a.useCallback((()=>{a&&a(),e()}),[e,a]),I=n.a.useCallback((()=>{s&&s(),e()}),[e,s]);return n.a.createElement(o.a,{accessibilityRole:"dialog",style:t?C.flatCorners:C.roundCorners},x?n.a.createElement(c.a,{Icon:h.a,actionSubText:f,actionText:i?_:b,onClick:I,textColor:"red500"}):null,R?n.a.createElement(c.a,{Icon:p.a,actionSubText:g,actionText:m({screenName:d}),onClick:T}):null,n.a.createElement(c.a,{Icon:u.a,actionSubText:E,actionText:i?v:y({screenName:d}),onClick:A}),w?n.a.createElement(l.a,{onPress:e,style:C.cancelButton,type:"primaryOutlined"},S):null)};R.defaultProps={isGroup:!1,flatBorders:!1,showBlock:!1,showCancel:!1,showDelete:!1};const C=d.a.create((e=>({roundCorners:{borderRadius:e.borderRadii.xLarge},flatCorners:{borderRadius:e.borderRadii.none},cancelButton:{marginHorizontal:e.spaces.space16,marginVertical:e.spaces.space16}})));t.a=R},uB9N:function(e,t,i){"use strict";var a=i("97Jx"),n=i.n(a),s=i("ERkP"),r=i.n(s),o=i("1YZw"),c=i("zh9S"),l=i("P1r1"),d=i("AspN"),h=i("rxPX"),p=Object(h.a)().propsFromState((()=>({dataSaverMode:l.j}))).propsFromActions((()=>({addMedia:d.b,addToast:o.b,processMultipleMedia:d.g,removeMediaUpload:d.i,scribeAction:c.c,preUploadMedia:d.e}))),u=i("wpu3"),m=i("cOB2"),g=i("MWbm"),_=i("0FVZ"),b=i("Oe3h"),f=i("rHpw");var v=function(e){const{accessibilityLabel:t,accessibilityRole:i,children:a,onLayout:s,sideNavPresent:o,style:c}=e,l=r.a.useContext(m.a);return o?r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{accessibilityLabel:t,accessibilityRole:i,onLayout:s,style:c},a)):r.a.createElement(_.a.BottomComposer,null,r.a.createElement(b.a,{id:"DMComposerWrapper"},((e,o)=>r.a.createElement(g.a,n()({ref:e()},o({accessibilityLabel:t,accessibilityRole:i,onLayout:s,style:c})),a,r.a.createElement(g.a,{style:!1===l.keyboardVisible&&y.offsetBottom})))))};const y=f.a.create((()=>({offsetBottom:{paddingBottom:f.a.iPhoneOffsetBottom}})));i("kYxP");var E=i("HPNB"),S=i("htQn"),R=i("t62R");class C extends r.a.Component{constructor(...e){super(...e),this._handleClick=()=>{const{id:e,label:t,onClick:i}=this.props;i({id:e,label:t})}}render(){const{description:e,isWide:t,label:i}=this.props;return r.a.createElement(S.a,{accessibilityRole:"button",onClick:this._handleClick,style:[w.root,t&&w.isWide,!t&&w.isNarrow]},r.a.createElement(R.b,{weight:"bold"},i),r.a.createElement(R.b,{color:"gray700",size:"subtext2"},e))}}const w=f.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderStyle:"solid",paddingLeft:"1rem",paddingVertical:"1rem"},isWide:{borderRadius:e.borderRadii.xLarge,paddingVertical:"0.5rem",borderWidth:e.borderWidths.small},isNarrow:{borderTopWidth:e.borderWidths.small}})));var x=C,A=i("cHvH"),T=i("mw9i");class I extends r.a.Component{constructor(...e){super(...e),this._handleOptionChoose=e=>{const{onOptionChoose:t,quickReplyOptions:{id:i}}=this.props;return t(i,e)}}render(){const{quickReplyOptions:{options:e}}=this.props,t=1===e.length;return r.a.createElement(A.a,null,(({windowWidth:i})=>{const a=E.a.isTwoColumnLayout(i),n=[a&&O.isWide,a&&t&&O.oneButtonOnly,!a&&O.isNarrow];return r.a.createElement(T.a,{style:n,withGutter:a},e.map((e=>this.renderOption(e,a))))}))}renderOption(e,t){return r.a.createElement(x,{description:e.description,id:e.id,isWide:t,key:e.id,label:e.label,onClick:this._handleOptionChoose})}}const O=f.a.create((e=>({oneButtonOnly:{gridTemplateColumns:"1fr"},isWide:{backgroundColor:e.colors.gray0,display:"grid",gridColumnGap:e.spaces.space12,gridRowGap:e.spaces.space12,gridTemplateColumns:"1fr 1fr",paddingVertical:e.spaces.space12},isNarrow:{maxHeight:"168px",overflow:"auto"}})));var M=I,k=i("krmn"),P=i("cIoY"),D=i("w3n3"),L=i("MLl7"),F=i("3XMw"),B=i.n(F),N=i("J2UM"),j=i("VPdC"),U=i("pKoL"),H=i("eyty"),W=i("oQhu"),V=i("JYMr");const z=[{waitMs:1e3,progress:.1},{waitMs:1400,progress:.3},{waitMs:1800,progress:.5},{waitMs:2400,progress:.6},{waitMs:3e3,progress:.9}];class q extends r.a.Component{constructor(...e){super(...e),this.state={currentStepIndex:-1}}componentDidMount(){this._scheduleNextStep(0)}componentWillUnmount(){this._currentTimeoutId&&clearTimeout(this._currentTimeoutId)}render(){const{currentStepIndex:e}=this.state,t=e>=0&&e<z.length?z[e].progress:0;return r.a.createElement(V.a,{progress:t})}_scheduleNextStep(e){e<z.length&&(this._currentTimeoutId=setTimeout((()=>{this._currentTimeoutId=void 0,this.setState({currentStepIndex:e}),this._scheduleNextStep(e+1)}),z[e].waitMs))}}function G({isSending:e,isUploading:t,progress:i}){return e&&!t?r.a.createElement(q,null):r.a.createElement(V.a,{progress:e?Math.max(i,.02):0})}var Y=r.a.memo(G),$=i("Dtul"),K=i("Es6L"),Q="dmComposerAttachments",X="dmComposerTextInput",J="dmComposerSendButton",Z=i("GZwR"),ee=i("aITJ"),te=i("6OUF"),ie=i("9Xij"),ae=i("/yvb"),ne=i("OiMc"),se=i("v6aA"),re=i("gpVt"),oe=i("Lsrn"),ce=i("k/Ka");const le=(e={})=>Object(ce.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[oe.a.root,e.style],viewBox:"0 0 24 24"},r.a.createElement("g",null,r.a.createElement("path",{d:"M19 13.5H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0 6H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0-12H5c-.828 0-1.5-.672-1.5-1.5S4.172 4.5 5 4.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5z"})));le.metadata={width:24,height:24};var de=le;const he=(e={})=>Object(ce.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[oe.a.root,e.style],viewBox:"0 0 24 24"},r.a.createElement("g",null,r.a.createElement("path",{d:"M19 13H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0 6H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0-12H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1z"})));he.metadata={width:24,height:24};var pe=he,ue=i("iySH");const me=B.a.ee230734,ge=B.a.ca0ce0e4,_e=B.a.cdcebd22,be=B.a.ic8c615d,fe=B.a.a04077c4,ve=e=>!(!e||!e.media),ye=Object(u.b)({maxNumberOfPhotos:1});class Ee extends r.a.Component{constructor(e,t){var i;super(e,t),this._handleLayout=e=>{const{onHeightChange:t}=this.props,{mediaButtonsCollapsible:i}=this.state,a=e.nativeEvent.layout;a&&(Object(K.a)()||t&&t(a.height),a.width<=f.a.theme.breakpoints.small&&!i?this.setState({mediaButtonsCollapsible:!0}):a.width>f.a.theme.breakpoints.small&&i&&this.setState({mediaButtonsCollapsible:!1}))},this._renderQuickReplyPicker=()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t}=this.state;return e&&t?r.a.createElement(M,{onOptionChoose:this._handleQROptionSelection,quickReplyOptions:e}):null},this._renderComposeBox=()=>r.a.createElement(g.a,{style:Se.composeBoxContainer},this._renderMainContent()),this._renderMainContent=()=>{const{richTextInputContext:e,typeaheadWrapper:t}=this.props,{value:i}=this.state,a=t;return a?r.a.createElement(a,{contextText:i,isInline:!0,onTextUpdated:e?this._handleRichTextChange:this._handlePlainTextChange,onTypeaheadStateChange:this._handleTypeaheadStateChange,source:Z.d.ComposeMessage},this._renderFieldTextInput):this._renderFieldTextInput()},this._renderFieldTextInput=e=>{const{disabled:t,placeholderText:i,richTextInputContext:a}=this.props,s=ee.b.isKaiOS()?_e:i||ge,{editorState:o,mediaButtonsCollapsible:c,value:l}=this.state,d=!!a,h=a?{editorState:o,element:a.element}:void 0,p=a?{onChange:this._getHandleRichTextChange(e),richTextInputContext:{editorState:o,element:a.element}}:{onChange:this._getHandlePlainTextChange(e),richTextInputContext:void 0};return r.a.createElement(te.a,n()({contentAbove:this._renderAttachments(),editable:!t,emojiPickerButton:this._renderEmojiPicker(),handleReturn:d?this._handleReturn:void 0,isCompact:!0,leftAligned:!0,maxNumberOfLines:d?8:4,multiline:!0,numberOfLines:1,onBlur:this._handleOnBlur,onFilesAdded:this._handleAddMediaFiles,onFocus:this._handleTextInputFocus,onKeyPress:d?void 0:this._handleReturn,placeholder:s,ref:this._setTextInputRef,richTextInputContext:t?void 0:h,style:Se.composeInput,testID:X,useCacheForDOMMeasurements:!this._isSendDisabled()&&!c,value:l},p))},this._getHandleRichTextChange=Object(W.a)((e=>t=>{null==e||e(t),this._handleRichTextChange(t)})),this._getHandlePlainTextChange=Object(W.a)((e=>t=>{null==e||e(t),this._handlePlainTextChange(t)})),this._handleTypeaheadStateChange=e=>{this.setState({isTypeaheadActive:e})},this._renderAttachments=()=>{const{attachment:e,conversationId:t,isCardPreviewTombstoned:i,isShareViaDM:a,isUploading:n}=this.props,{value:s}=this.state,{height:o,width:c}=e&&(e.media&&e.media.mediaFile||e.provider&&e.media&&e.media.externalMediaDetails)||{},l=null==e?void 0:e.media,d=null==l?void 0:l.mediaMetadata,h=null==d?void 0:d.altText,p=null==d?void 0:d.defaultAltText,u=Object(re.b)(s);return r.a.createElement(r.a.Fragment,null,l?r.a.createElement(g.a,{style:Se.attachmentContainer,testID:Q},r.a.createElement(ie.a,{ratio:c/o,style:Se.aspectContainer},r.a.createElement(g.a,{style:Se.mediaPreviewContainer},r.a.createElement(U.a,{accessibilityLabel:h||p,mediaItem:l,onClick:this._canEditImage?this._handleClickMediaDetail:void 0,onEdit:this._canEditImage||this._canEditVideo?this._handleClickMediaDetail:void 0,onRemove:this._handleRemoveMedia(l.id),resizeIfNeeded:"width",style:Se.mediaPreview,withAltTextLabel:!!h,withCloseButton:!n,withEditButton:(this._canEditImage||this._canEditVideo)&&!n,withEditIcon:!0}))),e&&e.provider&&e.gifUrl&&r.a.createElement(g.a,{style:Se.gifAttribution},r.a.createElement(P.a,{gifUrl:e.gifUrl,provider:e.provider}))):u&&!a?r.a.createElement(re.a,{conversationId:t,isCardPreviewTombstoned:i,style:Se.cardPreviewContainer,urls:u}):null)},this._renderEmojiPicker=()=>{const{withEmojiPicker:e}=this.props;return e&&ee.b.isDesktopOS()?r.a.createElement(k.a,{disabled:this.props.disabled,onEmojiSelect:this._handleEmojiSelect,onPress:this._handleTextInputFocus,size:"small",textInputRef:this._textInput||void 0}):null},this._renderPrimaryActionButton=e=>{const{primaryActionIcon:t,primaryActionLabel:i,quickReplyOptions:a}=this.props,n=this._hasMessageText();return!a||n||e?r.a.createElement(ae.a,{accessibilityLabel:i,disabled:this._isSendDisabled(),hoverLabel:{label:i},icon:t||void 0,onPress:this._handlePrimaryAction,size:"medium",style:Se.actionButton,testID:J,type:t?"brandText":"brandFilled"},t?null:i):this._renderQRToggleButton()},this._renderSecondaryActionButton=()=>{const{secondaryActionDisabledPopoverRenderer:e,secondaryActionLabel:t,shouldEnableSecondaryActionFunc:i,shouldShowSecondaryActionFunc:a}=this.props;if(a&&!a()||!t)return null;const n=!i||i(),s=r.a.createElement(ae.a,{accessibilityLabel:t,disabled:!n,onPress:this._handleSecondaryAction,style:Se.actionButton,type:"primaryOutlined"},this.props.secondaryActionLabel);return n||!e?s:r.a.createElement(ne.a,{enableHover:!0,preferredVerticalOrientation:"up",renderContent:e,withArrow:!0},s)},this._renderQRToggleButton=()=>{const{isQuickReplyOpen:e}=this.state;return r.a.createElement(ae.a,{accessibilityLabel:be,icon:e?r.a.createElement(de,null):r.a.createElement(pe,null),onPress:this._handleQuickReplyPickerToggle,size:"medium",style:Se.actionButton,type:"brandText"})},this._renderComposer=()=>{const{attachment:e}=this.props,t=ve(e),i=this._renderComposeBox(),a=this._renderPrimaryActionButton(t),n=this._renderSecondaryActionButton();return r.a.createElement(g.a,{style:[Se.composer,t&&Se.composerWithAttachment]},t?null:this._renderMediaButtons(),i,n,a)},this._renderMediaButtons=()=>{const{withGifPicker:e,withMediaPicker:t}=this.props,{mediaButtonsCollapsed:i,mediaButtonsCollapsible:a}=this.state,n=a&&i;return r.a.createElement(g.a,{style:Se.uploadButtons},n?r.a.createElement(ae.a,{accessibilityLabel:me,icon:r.a.createElement(ue.a,null),onMouseDown:this._handleShowMediaControlsMouseDown,type:"brandText"}):null,t&&!n?this._renderMediaPicker():null,e&&!n?this._renderGifButton():null)},this._handleShowMediaControlsMouseDown=()=>{const{scribeAction:e,scribeNamespace:t}=this.props;this.setState({mediaButtonsCollapsed:!1}),e({...t,component:"dm_composer",element:"toggle",action:"expand"})},this._handleReturn=e=>{const{nativeEvent:{ctrlKey:t,key:i,metaKey:a,shiftKey:n}}=e,s="Enter"===i,{isTypeaheadActive:r}=this.state;return!r&&s&&this._keyboardOrMouseDetected&&!(n||a||t)?(e.preventDefault(),this._handlePrimaryAction(e),"handled"):"not-handled"},this._handleClickMediaDetail=()=>{const{attachment:e,conversationId:t,history:i}=this.props;if(this._canEditImage||this._canEditVideo){const a=e&&e.media?e.media.id:0,n=this._canEditVideo?"trimmer":"crop";i.push("/messages/compose/media",{mediaId:a,conversationId:t,tab:n})}},this._handleAddMediaFiles=e=>{const{addMedia:t,addToast:i,dataSaverMode:a,onAddMedia:n,preUploadMedia:s,processMultipleMedia:r,removeMedia:o,removeMediaUpload:c}=this.props;t(e,{location:H.d.Dm}).then((e=>{const t=e.map((e=>e.id));this._validateMedia(e)?(n&&n(t),r(e,{onFailure:o}).then((e=>{a||s(e.map((e=>e.id)))}))):(i({text:fe}),c(t))}))},this._handleEmojiSelect=e=>{const{editorState:t}=this.state,{richTextInputContext:i}=this.props;if(!i||!t)return;const a=i.insertTextAtCursor(t,e.text);this._handleRichTextChange(a)},this._handleRemoveMedia=e=>()=>{this.props.removeMedia&&this.props.removeMedia(e)},this._handlePrimaryAction=e=>{if(!this._isSendDisabled()){const{onPrimaryAction:e}=this.props;this._textInput&&this._textInput.applyFinalValue((t=>{e({type:"richText"},t)})),this._closeQuickReplyPicker()}},this._handleSecondaryAction=e=>{const{onSecondaryAction:t}=this.props;this._textInput&&this._textInput.applyFinalValue((e=>{t&&t({type:"richText"},e)}))},this._handleRichTextChange=e=>{const{onTyping:t,richTextInputContext:i}=this.props,{value:a}=this.state,n=e.getCurrentContent().getPlainText(),s=i?i.convertEmojiToEntities(e):null;this.setState({editorState:s,value:n}),a!==n&&(null==t||t())},this._handlePlainTextChange=e=>{const{onTyping:t}=this.props,{value:i}=this.state,a=e.target.value;this.setState({value:a}),i!==a&&(null==t||t())},this._handleOnBlur=()=>{const{onBlur:e}=this.props,{mediaButtonsCollapsible:t}=this.state;e&&e(),t&&this.setState({mediaButtonsCollapsed:!1})},this._handleTextInputFocus=()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t,mediaButtonsCollapsible:i}=this.state;e&&t&&this._closeQuickReplyPicker(),i&&this.setState({mediaButtonsCollapsed:!0})},this._handleQROptionSelection=(e,t)=>{const{disabled:i,onPrimaryAction:a}=this.props;i||(a({quickReply:{id:e,selected_id:t.id}},t.label),this._closeQuickReplyPicker())},this._handleQuickReplyPickerToggle=()=>{this.setState({isQuickReplyOpen:!this.state.isQuickReplyOpen})},this._validateMedia=e=>!ve(this.props.attachment)&&ye(e),this._detectKeyboardOrMouse=e=>{const{KEYBOARD:t,MOUSE:i,registerSome:a}=e;a((()=>{this._keyboardOrMouseDetected=!0}),[t,i])},this._isSendDisabled=()=>{const{attachment:e,canSendEmptyMessage:t,disabled:i,isUploading:a}=this.props,n=ve(e),s=this._hasMessageText()||t,r=!(!e||!e.media)&&(e.media.needsProcessing||a);return i||!s&&!n||r||a},this._hasMessageText=()=>!!(this.state.value||"").trim(),this._closeQuickReplyPicker=()=>{this.setState({isQuickReplyOpen:!1})},this.handleAddMediaFiles=e=>this._handleAddMediaFiles(e),this._setTextInputRef=e=>{this._textInput=e};const{prefillText:a,richTextInputContext:s}=e;this.state={isQuickReplyOpen:!0,value:a,editorState:null!=(i=null==s||null==s.initEditorState?void 0:s.initEditorState(a))?i:null,isTypeaheadActive:!1,mediaButtonsCollapsed:!1,mediaButtonsCollapsible:!1}}componentDidMount(){Object(N.a)().then(this._detectKeyboardOrMouse),this._unlockReload=$.a.acquire()}componentWillUnmount(){this._unlockReload&&this._unlockReload()}componentDidUpdate(){this.props.quickReplyOptions&&this.state.isQuickReplyOpen&&this._textInput&&this._textInput.blur()}UNSAFE_componentWillReceiveProps(e){const t=this.props.quickReplyOptions,i=e.quickReplyOptions;t&&!i?this.setState({isQuickReplyOpen:!1}):(!t&&i||t&&i&&t.id!==i.id)&&this.setState({isQuickReplyOpen:!0}),this.props.conversationId!==e.conversationId&&this.clear()}render(){const{dtabBarInfo:e,isSending:t,isUploading:i,mediaUploadProgress:a,placeholderText:n,style:s}=this.props,o=n||ge,c=Object(K.a)(),l=c&&e&&(e.dtabAll||e.ttsToken)&&!e.hide;return r.a.createElement(v,{accessibilityLabel:o,accessibilityRole:"complementary",onLayout:this._handleLayout,sideNavPresent:c,style:[Se.root,l&&Se.dtabOffset,s]},r.a.createElement(Y,{isSending:t,isUploading:i,progress:t?Math.max(a,.02):0}),this._renderComposer(),this._renderQuickReplyPicker())}_renderMediaPicker(){return r.a.createElement(j.a,{onChange:this._handleAddMediaFiles,style:Se.mediaPicker,type:"brandText"})}_renderGifButton(){const{conversationId:e,history:t}=this.props;return r.a.createElement(D.a,{dmConversationId:e,enabled:!0,gifSearchKeySource:L.a.DMComposition,history:t})}get _canEditImage(){var e,t,i;return!(null==(e=this.props.attachment)||null==(t=e.media)||null==(i=t.mediaFile)||!i.isImage)}get _canEditVideo(){var e,t;const{attachment:i}=this.props;let a=null==i||null==(e=i.media)||null==(t=e.mediaFile)?void 0:t.isVideo;return a&&(this._videoTrimmerEnabled=this.context.featureSwitches.isTrue("responsive_web_video_trimmer_enabled"),a=this._videoTrimmerEnabled),!!a}clear(){const{richTextInputContext:e}=this.props;if(e){const{initEditorState:t}=e||{};this.setState({value:"",editorState:t&&t("")})}else this.setState({value:""})}focus(){this._textInput&&this._textInput.focus()}value(){return this.state.value}}Ee.contextType=se.a,Ee.defaultProps={prefillText:"",withEmojiPicker:!0,withGifPicker:!0,withMediaPicker:!0};const Se=f.a.create((e=>({root:{backgroundColor:e.colors.navigationBackground,borderTopColor:e.colors.borderColor,borderTopWidth:e.borderWidths.small},attachmentContainer:{maxHeight:"10rem",margin:e.spaces.space12},aspectContainer:{flexShrink:1},cardPreviewContainer:{margin:e.spaces.space12},dtabOffset:{marginBottom:e.spaces.space40},gifAttribution:{flexDirection:"row",marginVertical:e.spaces.space4,marginHorizontal:0},mediaPicker:{margin:0},icon:{color:e.colors.primary,fontSize:"1.5em"},composeBoxContainer:{flexGrow:1,flexShrink:1,alignSelf:"center"},composeInput:{width:"100%"},mediaPreviewContainer:{flexDirection:"row",height:"100%"},mediaPreview:{borderRadius:e.borderRadii.xLarge,overflow:"hidden",minWidth:"10em"},composer:{alignItems:"center",flexDirection:"row",padding:e.spaces.space4,width:"100%"},composerWithAttachment:{paddingLeft:e.spaces.space12},actionButton:{marginLeft:e.spaces.space4},uploadButtons:{flexDirection:"row",marginRight:e.spaces.space4}})));t.a=p.forwardRef(Ee)},zQEV:function(e,t,i){"use strict";i.d(t,"b",(function(){return u})),i.d(t,"a",(function(){return g}));var a=i("ERkP"),n=i.n(a),s=i("t62R"),r=i("aWyx"),o=i("3XMw"),c=i.n(o);const l=c.a.c1d4ac83,d=c.a.abc7b032,h=c.a.i263b293,p=({children:e,conversationId:t})=>n.a.createElement(s.b,{link:`/messages/${t}/participants`},e),u=(e,t)=>e>=2?n.a.createElement(c.a.I18NFormatMessage,{$i18n:"e3534476"},n.a.createElement(p,{conversationId:t},c.a.d1242bcc({count:e}))):n.a.createElement(c.a.I18NFormatMessage,{$i18n:"b6656850",count:e}),m=({entry:e,users:t})=>e.participants?n.a.createElement("span",null,e.participants.map((({user_id:e},i)=>{const a=t[e];return a?n.a.createElement("span",{key:i},i>0?", ":null,n.a.createElement(s.b,null,a.name)):null}))):null,g=(e,t,i,a)=>{const o=i===e.by_user_id;let p;switch(t){case r.b.CONVERSATION_AVATAR_UPDATE:return p=e.by_user_id&&a[e.by_user_id]&&a[e.by_user_id].name,p?o?l:(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"bff29c94"},n.a.createElement(s.b,null,e)))(p):d;case r.b.CONVERSATION_NAME_UPDATE:{const t=n.a.createElement(s.b,null,e.conversation_name);return p=e.by_user_id&&a[e.by_user_id]&&a[e.by_user_id].name,p?o?(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"b16e4d45"},e))(t):((e,t)=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"c5760698"},n.a.createElement(s.b,null,e),t))(p,t):(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"a72730a0"},e))(t)}case r.b.JOIN_CONVERSATION:return p=e.sender_id&&a[e.sender_id]&&a[e.sender_id].name,p?(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"fa95b019"},n.a.createElement(s.b,null,e)))(p):h;case r.b.PARTICIPANTS_LEAVE:return(e=>n.a.createElement(c.a.I18NFormatMessage,{$i18n:"fc10875e"},e))(n.a.createElement(m,{entry:e,users:a}));case r.b.PARTICIPANTS_JOIN:p=e.sender_id&&a[e.sender_id]&&a[e.sender_id].name;return((e,t)=>e?n.a.createElement(c.a.I18NFormatMessage,{$i18n:"a4bc88c2"},n.a.createElement(s.b,null,e),t):n.a.createElement(c.a.I18NFormatMessage,{$i18n:"bfdff0c3"},t))(p,n.a.createElement(m,{entry:e,users:a}));default:return""}}}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.DMDrawer~bundle.DMRichTextCompose.34a92425.js.map