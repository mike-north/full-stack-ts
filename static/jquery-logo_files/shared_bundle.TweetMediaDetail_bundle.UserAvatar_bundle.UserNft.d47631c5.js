(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"0Ki6":function(t,e,o){"use strict";var s=o("ERkP"),n=o.n(s),i=o("CHgo"),a=o("fs1G"),r=o("rHpw"),l=o("rOXj"),h=o("MWbm"),d=o("Enqy");const c=l.a.isTouchSupported(),m={zoom:1,lastX:0,lastY:0,zoomCenter:{x:0,y:0}},u={height:0,width:0,left:0,right:0,top:0,bottom:0},p=(t,e,o)=>Math.min(e,Math.max(t,o)),_=(t,e)=>Math.sqrt(Math.pow(t.clientY-e.clientY,2)+Math.pow(t.clientX-e.clientX,2));class g extends n.a.Component{constructor(t){super(t),this._itemDimensions=u,this._ref=n.a.createRef(),this._setTouchableNode=t=>{this._touchableNode!==t&&(this._touchableNode=t,this._removeTouchListener&&this._removeTouchListener(),this._touchableNode&&(this._removeTouchListener=Object(i.a)(this._touchableNode,this._handleTouchMove,!1)))},this._handleTouchStart=t=>{this._ref.current&&(this._zoomedDimensions=this._ref.current.getBoundingClientRect()),this._moved=!1;const e=t.touches.length;2===e?(t.preventDefault(),this._handlePinchStart(t)):1===e&&this._handleTapStart(t)},this._handleTouchMove=t=>{const e=t.touches.length;2===e?(t.preventDefault(),this._handlePinchMove(t)):1===e&&(this._moved=!0,this._handlePanMove(t))},this._handleTouchEnd=t=>{const{maxZoom:e,minZoom:o,onTap:s}=this.props,n=p(o,e,this.state.zoom),{zoom:i}=this.state;i!==n&&1===n?this.resetZoom():this.setState({lastX:0,lastY:0,zoom:n}),0===t.touches.length?(this._lastTouchTime&&this._lastTouchTime+300>t.timeStamp?(this._clickTimer&&clearTimeout(this._clickTimer),this._handleDoubleTap(t)):i<=1&&!this._moved&&(this._clickTimer=setTimeout(s,300)),this._lastTouchTime=t.timeStamp):t.preventDefault()},this.state={...m}}static getDerivedStateFromProps(t,e){return c&&t.resetZoom?(t.onZoomed(!1),{...m}):e}render(){if(!c)return this.props.children;const{zoom:t,zoomCenter:e}=this.state,o=this._moved,s={zoom:Object(d.spring)(t),zoomCenterX:Object(d.spring)(e.x),zoomCenterY:Object(d.spring)(e.y)};return n.a.createElement(h.a,{onTouchEnd:this._handleTouchEnd,onTouchStart:this._handleTouchStart,ref:this._setTouchableNode,style:y.fill},n.a.createElement(d.Motion,{style:s},(({zoom:t,zoomCenterX:s,zoomCenterY:i})=>n.a.createElement(h.a,{ref:this._ref,style:[y.fill,{transform:[{scale:t}],transformOrigin:`${o?s:e.x}px ${o?i:e.y}px`}]},this.props.children))))}componentDidMount(){c&&this._updateWindowDimensions()}componentWillUnmount(){this._removeTouchListener&&this._removeTouchListener()}resetZoom(){this.props.onZoomed(!1),this.setState({zoom:m.zoom})}_handlePanMove(t){if(this.state.zoom<=1||!this._zoomedDimensions||!this._windowDimensions)return;const{clientX:e,clientY:o}=t.touches[0];if(!this.state.lastX||!this.state.lastY)return void this.setState({lastX:e,lastY:o});const{lastX:s,lastY:n,zoomCenter:{x:i,y:a}}=this.state,{height:r,width:l}=this._windowDimensions,{height:h,width:d}=this._zoomedDimensions;let c=0,m=0;d-l>0&&(c=e-s),h-r>0&&(m=o-n),this.setState({lastX:e,lastY:o,zoomCenter:{x:Math.min(Math.max(i-c,0),l),y:Math.min(Math.max(a-m,0),r)}})}_handlePinchStart(t){const{touches:e}=t;if(this._updateWindowDimensions(),this._lastDistance=_(e[0],e[1]),1===this.state.zoom){const t=(o=e[0],s=e[1],{x:(o.clientX+s.clientX)/2,y:(o.clientY+s.clientY)/2});this.setState({zoomCenter:this._getZoomCenter(t.x,t.y)}),this.props.onZoomed(!0)}var o,s}_handlePinchMove(t){const{zoom:e,zoomCenter:o}=this.state,{maxZoom:s,maxZoomBounce:n,minZoom:i,minZoomBounce:a}=this.props;if(0===o.x&&0===o.y)return void(2===t.touches.length&&this._handlePinchStart(t));const r=_(t.touches[0],t.touches[1]),l=this._lastDistance?r/this._lastDistance:1,h=p(i-a,s+n,e*l);this._lastDistance=r,this.setState({zoom:h})}_handleTapStart(t){const{touches:e}=t;this._tapCenter=this._getZoomCenter(e[0].clientX,e[0].clientY)}_handleDoubleTap(t){const{maxZoom:e,onZoomed:o}=this.props;1!==this.state.zoom?this.resetZoom():(this._updateWindowDimensions(),this.setState({zoom:e,zoomCenter:this._tapCenter||m.zoomCenter}),o(!0))}_getZoomCenter(t,e){this._ref.current&&(this._itemDimensions=this._ref.current.getBoundingClientRect());const{left:o,top:s}=this._itemDimensions;return{x:t-o,y:e-s}}_updateWindowDimensions(){this._windowDimensions={height:window.innerHeight,width:window.innerWidth}}}g.defaultProps={maxZoom:2.5,maxZoomBounce:.15,minZoom:1,minZoomBounce:.15,onTap:a.a,onZoomed:a.a,resetZoom:!1};const y=r.a.create((t=>({fill:{flex:1}})));e.a=g},"2doW":function(t,e,o){"use strict";var s=o("ERkP"),n=o.n(s),i=o("97Jx"),a=o.n(i),r=(o("kYxP"),o("3XMw")),l=o.n(r),h=o("mN6z"),d=o("U+bB"),c=o("MWbm"),m=o("0Ki6"),u=o("3dad"),p=o("r1lV"),_=o("rHpw"),g=o("JYMr");const y=l.a.b327c129,f=l.a.gff1f69e;class b extends n.a.PureComponent{constructor(...t){super(...t),this.state={loadingVariant:null,imageLoading:!1},this._handleLoadStart=()=>this.setState({imageLoading:!0}),this._handleLoadEnd=()=>this.setState({imageLoading:!1})}componentDidMount(){this._mountPromiseForTesting=b._selectCachedVariant(this.props.photo).then((t=>this.setState({loadingVariant:t})))}componentDidUpdate(t,e){Object(h.a)(t.photo,this.props.photo)||(this.setState({loadingVariant:null}),b._selectCachedVariant(this.props.photo).then((t=>this.setState({loadingVariant:t}))))}render(){const{dataSaver:t,imageStyle:e,onError:o,onLoad:s,onTap:i,onZoomed:a,photo:r,resetZoom:l,style:h,zoomable:u}=this.props,{loadingVariant:p}=this.state,_=(t&&p&&Math.max(p.width,p.height)>=680?p.uri:null)||b._selectSource(r);if(!_||null===p)return null;const g=n.a.createElement(d.a,{accessibilityLabel:r.ext_alt_text?r.ext_alt_text:y,defaultSource:p&&p.uri,draggable:!0,onError:p?void 0:o,onLoad:s,onLoadEnd:this._handleLoadEnd,onLoadStart:this._handleLoadStart,resizeMode:"contain",source:_,style:[v.img,e]});return n.a.createElement(c.a,{style:h},this.state.imageLoading?C:null,u?n.a.createElement(m.a,{onTap:i,onZoomed:a,resetZoom:l},g):g)}static _selectCachedVariant(t){const e=u.a.getOriginalImage(t);return e?p.a.selectLargestCachedVariant(e):Promise.resolve()}static _selectSource(t){const e=u.a.getOriginalImage(t);return e&&p.a.selectLargestUrl(e)}}b.defaultProps={zoomable:!1};const v=_.a.create((t=>({img:{..._.a.absoluteFillObject,height:"auto",margin:"auto",maxHeight:"100%",maxWidth:"100%",width:"auto"},progressBar:{position:"absolute",top:0,zIndex:1}}))),C=n.a.createElement(g.a,{ariaValueText:f,indeterminate:!0,style:v.progressBar});var x=b,w=o("RCZO"),S=o("Modb"),D=o("XrEN");class T extends n.a.PureComponent{constructor(...t){super(...t),this._handlePlaybackStarted=()=>{this._player&&!this.props.isCurrentlyDisplayed&&this._player.pause()},this._setPlayer=t=>{this._player=t,this._player&&this.props.isCurrentlyDisplayed&&this._player.play()}}render(){const{style:t}=this.props;return n.a.createElement(c.a,{style:t},n.a.createElement(c.a,{style:E.root},this._renderVideo()))}componentDidUpdate(t){const{isCurrentlyDisplayed:e}=this.props;this._player&&e!==t.isCurrentlyDisplayed&&(e?this._player.play():this._player.pause())}_renderVideo(){const{promotedContent:t,video:e,videoId:o}=this.props;return n.a.createElement(S.a,a()({},D.a.extractVideoProps(o,e),{onPlaybackStarted:this._handlePlaybackStarted,playbackCoordination:null,promotedContent:t,setPlayer:this._setPlayer,withPostPlayback:!0}))}}const E=_.a.create({root:{flexBasis:0,flexGrow:1,flexShrink:1,justifyContent:"center"}});var P=T;const M={startX:0,startY:0};class I extends n.a.Component{constructor(...t){super(...t),this._pullDistanceY=0,this._pullInfo={...M},this._handleTouchStart=t=>{this._pullInfo.startX=t.touches[0].clientX,this._pullInfo.startY=t.touches[0].clientY},this._handleTouchMove=t=>{if("number"!=typeof this._pullInfo.startX||"number"!=typeof this._pullInfo.startY)return;const e=t.touches[0],o=e.clientX-this._pullInfo.startX,s=e.clientY-this._pullInfo.startY;Math.abs(o)>10||(t.preventDefault(),this._updatePullPosition(s))},this._handleTouchEnd=t=>{Math.abs(this._pullDistanceY)>50?this._handleDismiss():this._resetPullInfo()},this._updatePullPosition=t=>{this._pullDistanceY=t},this._handleDismiss=()=>{const{onDismiss:t}=this.props;t&&t(),this._resetPullInfo()},this._resetPullInfo=()=>{this._updatePullPosition(0),this._pullInfo={...M}}}render(){const{children:t,onDismiss:e,onLayout:o,style:s}=this.props,i=!!e;return n.a.createElement(c.a,{onLayout:o,onTouchEnd:i?this._handleTouchEnd:void 0,onTouchMove:i?this._handleTouchMove:void 0,onTouchStart:i?this._handleTouchStart:void 0,style:s,testID:"swipe-to-dismiss"},t)}}var Z=I,z=o("7N4s"),k=o("q9Zt");const L=l.a.ac85c6b1,B=t=>{const{isAvatar:e,isCurrentlyDisplayed:o,mediaDetail:s,onDismiss:i,onTap:r,promotedContent:l,videoId:h,...d}=t,[m,u]=n.a.useState(null),[p,_]=n.a.useState({width:0,height:0}),{isModal:g}=n.a.useContext(z.b),{height:y,width:f}=s.original_info||{},{height:b,width:v}=p,C=g||e?Object(w.f)({mediaWidth:f,mediaHeight:y,containerWidth:v,containerHeight:b},e):Y.mediaItem;n.a.useEffect((()=>{m&&u(null)}),[t,m]);return n.a.createElement(Z,{onDismiss:i,onLayout:g||e?t=>{const{nativeEvent:{layout:{height:e,width:o}}}=t;o===p.width&&e===p.height||_({width:o,height:e})}:void 0,style:Y.root},m?n.a.createElement(k.a,{onRetry:()=>{u(null)},style:Y.errorDetail,title:L,withLightOnDarkColorScheme:!0}):null,m?null:n.a.createElement(c.a,{onClick:t=>{t.stopPropagation()},style:C},"photo"===s.type?n.a.createElement(x,a()({},d,{imageStyle:e&&Y.avatarImage,onError:t=>{u(t.nativeEvent.error)},onLoad:()=>{u(null)},onTap:r,photo:s,style:Y.container,zoomable:!0})):D.a.isVideo(s)&&h?n.a.createElement(P,{isCurrentlyDisplayed:o,promotedContent:l,style:Y.container,video:s,videoId:h}):null))},Y=_.a.create((t=>({root:{flexGrow:1,justifyContent:"center",alignItems:"center",flexShrink:1},mediaItem:{flexGrow:1,width:"100%",height:"100%"},container:{height:"100%",position:"absolute",width:"100%"},errorDetail:{alignItems:"center",alignSelf:"center",justifyContent:"center",position:"absolute",height:"100%",maxWidth:400},avatarImage:{borderRadius:t.borderRadii.infinite,margin:t.spaces.space16}})));var X=n.a.memo(B,((t,e)=>Object(h.a)(t,e))),O=o("lklz"),V=o("v6aA"),W=o("6iuV"),R=o("uavX"),j=o("fs1G");class N extends n.a.Component{constructor(t,e){super(t,e),this._handleChangeV2=({index:t,intersectionRatio:e})=>{const{onMediaItemChanged:o}=this.props;1===e&&o&&o(t)},this._getItemVideoId=t=>{const{videoId:e}=this.props;return e||(t=>O.b.forTweet(t.expanded_url.split("/")[3]))(t)},this._handleMediaDetailZoomed=t=>{const{onMediaDetailZoomed:e}=this.props;this.state.isZoomed!==t&&this.setState({isZoomed:t}),e&&e(t)},this.state={isZoomed:!1}}shouldComponentUpdate(t,e){return!Object(h.a)(t,this.props)||!Object(h.a)(e,this.state)}render(){const{dataSaver:t,mediaIndex:e,mediaItems:o,onDismiss:s,onTap:i,promotedContent:a}=this.props,{isZoomed:r}=this.state,l=o.map(((l,h)=>{const d=D.a.isVideo(l),c=this._getItemVideoId(l),m=e===h;return d&&c||!d?n.a.createElement(X,{dataSaver:t,isAvatar:this.props.isAvatar,isCurrentlyDisplayed:m,key:h,mediaDetail:o[h],onDismiss:r?void 0:s,onTap:i,onZoomed:m?this._handleMediaDetailZoomed:void 0,promotedContent:a,resetZoom:e!==h,videoId:c}):null}));return n.a.createElement(c.a,{style:A.root},o.length>1?this._renderCarousel(l):l)}_renderCarousel(t){const{dominantColor:e,mediaIndex:o,mediaItems:s,onMediaItemChanged:i}=this.props,{isZoomed:a}=this.state,r=D.a.isVideo(s[o]);return this.context.featureSwitches.isTrue("responsive_web_carousel_v2_media_detail_enabled")?n.a.createElement(W.a,{childrenStyle:[A.dimensions,A.scrollSnap],dominantButtonColor:e,isLocked:a,onVisibleRangeChange:this._handleChangeV2,scrollToCenter:!0,style:A.dimensions,visibleItemIndex:o,withAddedNavButtonClickArea:!r,withGlobalKeyboardNavigation:!0,withWraparound:!1},t):n.a.createElement(R.b,{currentSlide:o,dominantColor:e,locked:a,onChange:i,shouldAlwaysEnableKeyboardNavigation:!0},t)}}N.contextType=V.a,N.defaultProps={mediaIndex:0,onMediaDetailZoomed:j.a,onMediaItemChanged:j.a};const A=_.a.create((t=>({root:{flex:1,zIndex:1},dimensions:{height:"100%",width:"100%"},scrollSnap:{scrollSnapAlign:"center",scrollSnapStop:"always"}})));e.a=N},UPvq:function(t,e,o){"use strict";o.d(e,"a",(function(){return g}));o("kYxP");var s=o("ERkP"),n=o.n(s),i=o("RCZO"),a=o("3XMw"),r=o.n(a),l=o("hOZg"),h=o("MWbm"),d=o("mw9i"),c=o("cm6r"),m=o("/yvb"),u=o("7N4s"),p=o("rHpw");const _=r.a.ia5e7487;class g extends n.a.Component{constructor(...t){super(...t),this._handleCloseButtonPress=t=>{t.stopPropagation();const{onCloseButtonPress:e}=this.props;e()},this._handleBackgroundPress=()=>{const{onCloseButtonPress:t}=this.props,{isModal:e}=this.context;e&&t()}}render(){const{backgroundColor:t,children:e,footerButtons:o,forceModalStyle:s,hideButtons:a,mediaItem:r,mediaUrl:u,overlayFooter:p,topRightButton:g}=this.props,{isModal:f}=this.context,b={backgroundColor:t.rgba,...i.a},v={backgroundColor:t.rgb,...i.a},C=[y.root,f?b:v,{position:f||s?"relative":"fixed"}];return n.a.createElement(n.a.Fragment,null,n.a.createElement(h.a,{onClick:this._handleBackgroundPress,style:C},e,o?n.a.createElement(h.a,{pointerEvents:a?"none":void 0,style:[y.footerButtons,p&&b,p&&y.footerButtonsAbsolute,a&&y.fadeOut]},n.a.createElement(d.a,{withGutter:!0},o)):null),n.a.createElement(c.a,{accessibilityRole:"none",interactiveStyles:null,onClick:this._handleCloseButtonPress,pointerEvents:a?"none":void 0,style:[y.buttonWrapper,y.buttonWrapperLeft,i.a,a&&y.fadeOut]},(e=>n.a.createElement(m.a,{accessibilityLabel:_,dominantColor:t.rgb,hoverLabel:{label:_},icon:n.a.createElement(l.a,null),interactivityState:e,onClick:this._handleCloseButtonPress,type:r||u?"onMediaDominantColorFilled":"onMediaWhiteFilled"}))),g?n.a.createElement(h.a,{pointerEvents:a?"none":void 0,style:[y.buttonWrapper,y.buttonWrapperRight,i.a,a&&y.fadeOut]},g):null)}}g.contextType=u.b,g.defaultProps={hideButtons:!1};const y=p.a.create((t=>({root:{overflowX:"hidden",overflowY:"hidden",height:"100%",width:"100%"},buttonWrapper:{position:"absolute",top:0,padding:t.spaces.space12,alignItems:"center",justifyContent:"center",cursor:"pointer"},buttonWrapperLeft:{left:0},buttonWrapperRight:{right:0},fadeOut:{opacity:0},footerButtons:{width:"100%",alignSelf:"center"},footerButtonsAbsolute:{position:"absolute",bottom:0,paddingBottom:p.a.iPhoneOffsetBottom,zIndex:1}})))}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~bundle.TweetMediaDetail~bundle.UserAvatar~bundle.UserNft.d47631c5.js.map